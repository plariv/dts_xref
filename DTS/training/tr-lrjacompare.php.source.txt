<?php 
function tfm_cleanOrderBy($theValue, $defaultSort) {
	if (preg_match("/^[\w,]{1,50}\s+(asc|desc)\s*$/i",$theValue, $matches)) {
		return $matches[0];
	}
	return $defaultSort;
}
?>
<?php require_once('../Connections/Assessment.php'); ?>
<?php require_once( "../WA_SecurityAssist/Helper_PHP.php" ); ?>
<?php
if (!WA_Auth_RulePasses("Logged in as analyst")){
	WA_Auth_RestrictAccess("../security/logIn.php");
}
?>
<?php
$tfm_orderby =(!isset($_GET["tfm_orderby"]))?"lrjakey":$_GET["tfm_orderby"];
$tfm_order =(!isset($_GET["tfm_order"]))?"ASC":$_GET["tfm_order"];
$sql_orderby = $tfm_orderby." ".$tfm_order;
$sql_orderby = tfm_cleanOrderBy($sql_orderby, "lrjakey");
?>
<?php
if (!function_exists("GetSQLValueString")) {
function GetSQLValueString($theValue, $theType, $theDefinedValue = "", $theNotDefinedValue = "") 
{
  if (PHP_VERSION < 6) {
    $theValue = get_magic_quotes_gpc() ? stripslashes($theValue) : $theValue;
  }

  $theValue = function_exists("mysql_real_escape_string") ? mysql_real_escape_string($theValue) : mysql_escape_string($theValue);

  switch ($theType) {
    case "text":
      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";
      break;    
    case "long":
    case "int":
      $theValue = ($theValue != "") ? intval($theValue) : "NULL";
      break;
    case "double":
      $theValue = ($theValue != "") ? doubleval($theValue) : "NULL";
      break;
    case "date":
      $theValue = ($theValue != "") ? "'" . $theValue . "'" : "NULL";
      break;
    case "defined":
      $theValue = ($theValue != "") ? $theDefinedValue : $theNotDefinedValue;
      break;
  }
  return $theValue;
}
}

$currentPage = $_SERVER["PHP_SELF"];

//TOMLR Special List Recordset
$maxRows_rsLRJA = 20;
$pageNum_rsLRJA = 0;
if (isset($_GET['pageNum_rsLRJA'])) {
  $pageNum_rsLRJA = $_GET['pageNum_rsLRJA'];
}
$startRow_rsLRJA = $pageNum_rsLRJA * $maxRows_rsLRJA;

// Defining List Recordset variable
$sqlorderby_rsLRJA = "lrjakey";
if (isset($sql_orderby)) {
  $sqlorderby_rsLRJA = $sql_orderby;
}
mysql_select_db($database_Assessment, $Assessment);

$query_rsLRJA = "SELECT LRJAscores.lrjakey, LRJAscores_trainees.lrjascoringkey, LRJAscores.`Date`, LRJAscores_trainees.coderusername2, LRJAscores_trainees.lasname2, LRJAscores.coderusername, LRJAscores.lasname FROM LRJAscores LEFT JOIN LRJAscores_trainees ON LRJAscores.lrjakey = LRJAscores_trainees.lrjakey ORDER BY {$sqlorderby_rsLRJA}";
$query_limit_rsLRJA = sprintf("%s LIMIT %d, %d", $query_rsLRJA, $startRow_rsLRJA, $maxRows_rsLRJA);
$rsLRJA = mysql_query($query_limit_rsLRJA, $Assessment) or die(mysql_error());
$row_rsLRJA = mysql_fetch_assoc($rsLRJA);

if (isset($_GET['totalRows_rsLRJA'])) {
  $totalRows_rsLRJA = $_GET['totalRows_rsLRJA'];
} else {
  $all_rsLRJA = mysql_query($query_rsLRJA);
  $totalRows_rsLRJA = mysql_num_rows($all_rsLRJA);
}
$totalPages_rsLRJA = ceil($totalRows_rsLRJA/$maxRows_rsLRJA)-1;
//End TOMLR Special List Recordset

$maxRows_rsTrainees = 5;
$pageNum_rsTrainees = 0;
if (isset($_GET['pageNum_rsTrainees'])) {
  $pageNum_rsTrainees = $_GET['pageNum_rsTrainees'];
}
$startRow_rsTrainees = $pageNum_rsTrainees * $maxRows_rsTrainees;

mysql_select_db($database_Assessment, $Assessment);
$query_rsTrainees = "SELECT userkey, Userlevel, user_name, firstname, lastname FROM Registrants WHERE user_level = 3 OR user_level = 4";
$query_limit_rsTrainees = sprintf("%s LIMIT %d, %d", $query_rsTrainees, $startRow_rsTrainees, $maxRows_rsTrainees);
$rsTrainees = mysql_query($query_limit_rsTrainees, $Assessment) or die(mysql_error());
$row_rsTrainees = mysql_fetch_assoc($rsTrainees);

if (isset($_GET['totalRows_rsTrainees'])) {
  $totalRows_rsTrainees = $_GET['totalRows_rsTrainees'];
} else {
  $all_rsTrainees = mysql_query($query_rsTrainees);
  $totalRows_rsTrainees = mysql_num_rows($all_rsTrainees);
}
$totalPages_rsTrainees = ceil($totalRows_rsTrainees/$maxRows_rsTrainees)-1;

$queryString_rsLRJA = "";
if (!empty($_SERVER['QUERY_STRING'])) {
  $params = explode("&", $_SERVER['QUERY_STRING']);
  $newParams = array();
  foreach ($params as $param) {
    if (stristr($param, "pageNum_rsLRJA") == false && 
        stristr($param, "totalRows_rsLRJA") == false) {
      array_push($newParams, $param);
    }
  }
  if (count($newParams) != 0) {
    $queryString_rsLRJA = "&" . htmlentities(implode("&", $newParams));
  }
}
$queryString_rsLRJA = sprintf("&totalRows_rsLRJA=%d%s", $totalRows_rsLRJA, $queryString_rsLRJA);

?>
<?php
//sort column headers for rsLRJA
$tfm_saveParams = explode(",","");
$tfm_keepParams = "";
if($tfm_order == "ASC") {
	$tfm_order = "DESC";
}else{
	$tfm_order = "ASC";
};
while (list($key,$val) = each($tfm_saveParams)) {
	if(isset($_GET[$val]))$tfm_keepParams .= ($val)."=".urlencode($_GET[$val])."&";	
	if(isset($_POST[$val]))$tfm_keepParams .= ($val)."=".urlencode($_POST[$val])."&";
}
$tfm_orderbyURL = $_SERVER["PHP_SELF"]."?".$tfm_keepParams."tfm_order=".$tfm_order."&tfm_orderby=";
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><!-- InstanceBegin template="/Templates/templateadmin1.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>Developmental Testing Service: Compare scores</title>
<!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="head" -->
<!-- InstanceEndEditable -->
<link href="../css/styles1.css" rel="stylesheet" type="text/css" />

<script src="../SpryAssets/SpryMenuBar.js" type="text/javascript"></script>
<link href="../SpryAssets/SpryMenuBarVertical.css" rel="stylesheet" type="text/css" />
<style type="text/css">
<!--
body {
	background-image: url();
	background-repeat: repeat;
	background-color: #EDEEE9;
	color: #333028;
}
.style11 {
	font-size: 10px;
	color: #FFFFFF;
	font-weight: bold;
}
#apDiv1 {
	position:absolute;
	left:0px;
	top:-1px;
	width:1000;
	height:71px;
	z-index:15;
}
#apDiv2 {
	position:absolute;
	left:43px;
	top:122px;
	width:780px;
	height:17px;
	z-index:4;
}
#apDiv3 {
	position:absolute;
	left:168px;
	top:295px;
	width:539px;
	height:17px;
	z-index:8;
}
#apDiv4 {
	position:absolute;
	left:704px;
	top:122px;
	width:42px;
	height:17px;
	z-index:3;
}
#apDiv5 {
	position:absolute;
	left:0px;
	top:70px;
	width:1000px;
	z-index:5;
	background-color: #F8FBFB;
	height: 1038px;
}
#apDiv6 {
	position:absolute;
	left:275px;
	top:124px;
	width:629px;
	z-index:6;
}
#apDiv7 {
	position:absolute;
	left:127px;
	top:941px;
	width:625px;
	height:15px;
	z-index:7;
}
#apDiv8 {
	position:absolute;
	left:95px;
	top:203px;
	width:156px;
	height:208px;
	z-index:8;
}
#apDiv9 {
	position:absolute;
	left:95px;
	top:596px;
	width:156px;
	z-index:9;
}
#apDiv10 {
	position:absolute;
	left:94px;
	top:68px;
	width:157px;
	height:119px;
	z-index:10;
}
#apDiv11 {
	position:absolute;
	left:84px;
	top:1097px;
	width:145px;
	height:45px;
	z-index:11;
}
#apDiv12 {
	position:absolute;
	left:83px;
	top:869px;
	width:146px;
	height:54px;
	z-index:12;
}
#apDiv13 {
	position:absolute;
	left:82px;
	top:806px;
	width:147px;
	height:3px;
	z-index:13;
	background-color: #627ECF;
}
#apDiv14 {
	position:absolute;
	left:95px;
	top:478px;
	width:156px;
	height:39px;
	z-index:12;
}
#apDiv15 {
	position:absolute;
	left:93px;
	top:1045px;
	width:127px;
	height:39px;
	z-index:13;
}
#apDiv16 {
	position:absolute;
	left:4px;
	top:3px;
	width:30px;
	height:28px;
	z-index:14;
	border-top-width: 0px;
	border-right-width: 0px;
	border-bottom-width: 0px;
	border-left-width: 0px;
	border-top-style: none;
	border-right-style: none;
	border-bottom-style: none;
	border-left-style: none;
}
#apDiv17 {
	position:absolute;
	left:670px;
	top:64px;
	width:229px;
	height:23px;
	z-index:16;
	padding-top: 4px;
}
#apDiv18 {
	position:absolute;
	left:696px;
	top:82px;
	width:202px;
	height:25px;
	z-index:17;
}
#apDiv19 {
	position:absolute;
	left:94px;
	top:68px;
	width:157px;
	height:1832px;
	z-index:5;
	background-color: #E2E2E2;
}
-->
</style>
<link href="../SpryAssets/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div id="apDiv1">
  <img src="../images/dtsskinold/DTSheader1.gif" alt="DTS masthead" width="1000" height="69" align="left" />
</div>
<div id="apDiv6"><!-- InstanceBeginEditable name="body" -->
  <p><img src="../images/logos/LRJA.gif" width="72" height="29" alt="LRJA" /> </p>
  <h1>TRAINER: COMPARE SCORES</h1>
  <p><a href="tr-choose.php">choose an action</a> | <a href="tr-lrjabreakdown.php">breakdown</a> | <a href="tr-lrjacompare.php">score comparison</a></p>
  <h3>Download trainee results </h3>
  <td valign="top"><table width="400" border="0">
      <tr class="lrjabackground">
        <td class="tablehead3">User name</td>
        <td class="tablehead3">First name</td>
        <td class="tablehead3">Last name</td>
        <td class="tablehead3">Download</td>
      </tr>
      <?php do { ?>
        <tr>
          <td><div><?php echo $row_rsTrainees['user_name']; ?></div></td>
          <td><div><?php echo $row_rsTrainees['firstname']; ?></div></td>
          <td><div><?php echo $row_rsTrainees['lastname']; ?></div></td>
          <td><div align="center"><a href="tr-lrjadownload.php?user_name=<?php echo $row_rsTrainees['user_name']; ?>">download</a></div></td>
        </tr>
        <?php } while ($row_rsTrainees = mysql_fetch_assoc($rsTrainees)); ?>
    </table>
    <p>&nbsp;</p>
    <p class="copyright">&nbsp;<a href="<?php printf("%s?pageNum_rsLRJA=%d%s", $currentPage, 0, $queryString_rsLRJA); ?>">First</a> | <a href="<?php printf("%s?pageNum_rsLRJA=%d%s", $currentPage, max(0, $pageNum_rsLRJA - 1), $queryString_rsLRJA); ?>">Previous</a> | <a href="<?php printf("%s?pageNum_rsLRJA=%d%s", $currentPage, min($totalPages_rsLRJA, $pageNum_rsLRJA + 1), $queryString_rsLRJA); ?>">Next</a> | <a href="<?php printf("%s?pageNum_rsLRJA=%d%s", $currentPage, $totalPages_rsLRJA, $queryString_rsLRJA); ?>">Last</a></p>
    <p class="copyright">From <?php echo ($startRow_rsLRJA + 1) ?> to <?php echo min($startRow_rsLRJA + $maxRows_rsLRJA, $totalRows_rsLRJA) ?> of <?php echo $totalRows_rsLRJA ?></p>
    <table width="98%" border="0">
      <tr class="lrjabackground">
        <td class="tablehead3">Scoring key</td>
        <td class="tablehead3"><a href="<?Php echo ($tfm_orderbyURL); ?>lrjakey">Key</a></td>
        <td class="tablehead3"><a href="<?Php echo ($tfm_orderbyURL); ?>coderusername2">Trainee</a></td>
        <td class="tablehead3"><a href="<?Php echo ($tfm_orderbyURL); ?>coderusername">Analyst</a></td>
        <td class="tablehead3"><a href="<?Php echo ($tfm_orderbyURL); ?>lasname2">Trainee score</a></td>
        <td class="tablehead3"><a href="<?Php echo ($tfm_orderbyURL); ?>lasname">Analyst score </a></td>
        <td class="tablehead3">Rescore</td>
        <td class="tablehead3">View</td>
      </tr>
      <?php do { ?>
        <tr>
          <td><div align="center"><?php echo $row_rsLRJA['lrjascoringkey']; ?></div></td>
          <td><div align="center"><?php echo $row_rsLRJA['lrjakey']; ?></div></td>
          <td><div align="center"><?php echo $row_rsLRJA['coderusername2']; ?></div></td>
          <td><div align="center"><?php echo $row_rsLRJA['coderusername']; ?></div></td>
          <td><div align="center"><?php echo $row_rsLRJA['lasname2']; ?></div></td>
          <td><div align="center"><?php echo $row_rsLRJA['lasname']; ?></div></td>
          <td><div align="center"><a href="../scoring_lrja/lrjascoring.php?lrjakey=<?php echo $row_rsLRJA['lrjakey']; ?>">rescore</a></div></td>
          <td><div align="center"><a href="tr-lrjaviewcompare.php?lrjakey=<?php echo $row_rsLRJA['lrjakey']; ?>">view</a></div></td>
        </tr>
        <?php } while ($row_rsLRJA = mysql_fetch_assoc($rsLRJA)); ?>
    </table>  
  <!-- InstanceEndEditable -->
  <p align="center" class="browsernote">&nbsp;</p>
  <p align="center" class="browsernote">&nbsp;</p>
  <p align="center" class="browsernote">
  </p>
  <div align="center"></div>
  <p align="center" class="copyright">&nbsp;</p>
</div>
<div id="apDiv8">
  <h3 align="left">Administration</h3>
  <ul id="MenuBar3" class="MenuBarVertical">
    <li><a href="../scoring/chooseassessment.php">SCORING</a></li>
    <li><a href="t-choosetoscore.php" class="MenuBarItemSubmenu">TRAINING</a>
      <ul>
        <li><a href="t-choosetoscore.php">TRAINEES</a></li>
        <li><a href="tr-choose.php">ANALYSTS</a></li>
      </ul>
    </li>
    <li><a href="../projects/partnerchoices.php">RESEARCH</a></li>
    <li><a href="../analysis/a.php">ANALYSIS</a></li>
    <li><a href="../assessments/assessmentsOLD/select_assess.php">ASSESSMENTS</a></li>
    <li><a href="../admin/bulkbalanceselect.php" class="MenuBarItemSubmenu">ADMIN</a>
      <ul>
        <li><a href="../admin/bulkbalanceselect.php">ACCOUNT BALANCE</a></li>
        <li><a href="../admin/registrations.php">REGISTRANTS</a></li>
        <li><a href="../admin/emailtoemaillist.php">MAIL TO EMAIL LIST</a></li>
        <li><a href="../admin/emailtoregistrants.php">MAIL TO REGISTRANTS</a></li>
        <li><a href="../admin/emailtoresellers.php">MAIL TO RESELLERS</a></li>
        <li><a href="../admin/emailrecipientdelete1.php">DELETE EMAIL RECIPIENT</a></li>
      </ul>
    </li>
    <li><a href="../graphics/graphics.php">GRAPHICS</a></li>
  </ul>
</div>
<div id="apDiv9"><!-- InstanceBeginEditable name="New" --><!-- InstanceEndEditable -->

  <p class="copyright">&nbsp;</p>
  <p class="copyright">&nbsp;</p>
  <p class="copyright">&nbsp;</p>
  <p class="copyright">&nbsp;</p>
  <p class="copyright">©2010, Developmental Testing Service, INC. All rights reserved.
  </p>
  <p align="center" class="copyright"><a href="../index.php"><img src="../images/dtsskinold/DTSlogo.gif" width="26" height="26" alt="DTS logo" /></a></p>
<p>&nbsp;</p>
</div>
<div id="apDiv10"><!-- InstanceBeginEditable name="Graphic" --><img src="../images/corner/echinacea.jpg" width="156" height="117" alt="echinacea" /><!-- InstanceEndEditable --></div>
<div id="apDiv14">
  <h3>Search DTS</h3>
  <form action="http://www.google.com/cse" class="indent" id="cse-search-box">
  <div>
    <input type="hidden" name="cx" value="013728306127544288581:qryb8cweja4" />
    <input type="hidden" name="ie" value="UTF-8" />
    <input type="text" name="q" size="17" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&lang=en"></script>
</div>
<div id="apDiv17">
  <ul id="MenuBar2" class="MenuBarHorizontal">
    <li><a href="../security/logIn.php">log in</a>    </li>
    <li><a href="../index.html">home</a></li>
    <li><a href="../contactus.php">contact</a>    </li>
</ul>
</div>
<div id="apDiv19"></div>
<script type="text/javascript">
<!--
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"../SpryAssets/SpryMenuBarDownHover.gif", imgRight:"../SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar3 = new Spry.Widget.MenuBar("MenuBar3", {imgRight:"../SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</body>
<!-- InstanceEnd --></html>
<?php
mysql_free_result($rsLRJA);

mysql_free_result($rsTrainees);
?>
