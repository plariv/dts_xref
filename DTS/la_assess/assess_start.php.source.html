<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : DTS : /DTS/la_assess/assess_start.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of DTS</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Mon May  5 14:14:03 2014 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='DTS/la_assess';
filename='assess_start.php.source.html';
cookiekey='phpxref_dts';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/DTS/la_assess/</a> -> <a href="assess_start.php.html">assess_start.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="assess_start.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="assess_start.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>    <a class="phpfunction" onClick="logFunction('ob_start')" href="../../_functions/ob_start.html" onMouseOver="phpfuncPopup(event,'ob_start')">ob_start</a>();
<a name="l3"><span class="linenum">   3</span></a>  
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// SetSessionVar.php</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Sessiom start &amp; error reporting requred for session variables code</span>
<a name="l6"><span class="linenum">   6</span></a>  if (!isset(<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('_SESSION')" href="../../_variables/_SESSION.html">$_SESSION</a>)) {
<a name="l7"><span class="linenum">   7</span></a>    <a class="phpfunction" onClick="logFunction('session_start')" href="../../_functions/session_start.html" onMouseOver="phpfuncPopup(event,'session_start')">session_start</a>();
<a name="l8"><span class="linenum">   8</span></a>  }
<a name="l9"><span class="linenum">   9</span></a>  <a class="phpfunction" onClick="logFunction('error_reporting')" href="../../_functions/error_reporting.html" onMouseOver="phpfuncPopup(event,'error_reporting')">error_reporting</a>(E_ALL); 
<a name="l10"><span class="linenum">  10</span></a>  
<a name="l11"><span class="linenum">  11</span></a>  
<a name="l12"><span class="linenum">  12</span></a>  <span class="keyword">require_once</span> <a class="filename" href="../../DTS/Connections/Assessment.php.html" onMouseOver="reqPopup(event, 'Assessment.php', '../../DTS/Connections/Assessment.php')">('../Connections/Assessment.php')</a>; 
<a name="l13"><span class="linenum">  13</span></a>  <span class="keyword">require_once</span> <a class="filename" href="../../DTS/WA_SecurityAssist/Helper_PHP.php.html" onMouseOver="reqPopup(event, 'Helper_PHP.php', '../../DTS/WA_SecurityAssist/Helper_PHP.php')">( &quot;../WA_SecurityAssist/Helper_PHP.php&quot; )</a>; 
<a name="l14"><span class="linenum">  14</span></a>  <span class="keyword">include_once</span> <a class="filename" href="../../DTS/includes/general_custom_functions.php.html" onMouseOver="reqPopup(event, 'general_custom_functions.php', '../../DTS/includes/general_custom_functions.php')"> (&quot;../includes/general_custom_functions.php&quot;)</a>;
<a name="l15"><span class="linenum">  15</span></a>  <a class="phpfunction" onClick="logFunction('mysql_select_db')" href="../../_functions/mysql_select_db.html" onMouseOver="phpfuncPopup(event,'mysql_select_db')">mysql_select_db</a>(<a class="var it19" onMouseOver="hilite(19)" onMouseOut="lolite()" onClick="logVariable('database_Assessment')" href="../../_variables/database_Assessment.html">$database_Assessment</a>, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('Assessment')" href="../../_variables/Assessment.html">$Assessment</a>);
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  if (!<a class="function" onClick="logFunction('WA_Auth_RulePasses')" href="../../_functions/wa_auth_rulepasses.html" onMouseOver="funcPopup(event,'wa_auth_rulepasses')">WA_Auth_RulePasses</a>(&quot;Logged in to registrants&quot;)){
<a name="l19"><span class="linenum">  19</span></a>      <a class="function" onClick="logFunction('WA_Auth_RestrictAccess')" href="../../_functions/wa_auth_restrictaccess.html" onMouseOver="funcPopup(event,'wa_auth_restrictaccess')">WA_Auth_RestrictAccess</a>(&quot;../security/logIn.php&quot;);
<a name="l20"><span class="linenum">  20</span></a>  }
<a name="l21"><span class="linenum">  21</span></a>  <a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('userkey')" href="../../_variables/userkey.html">$userkey</a> = <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('_SESSION')" href="../../_variables/_SESSION.html">$_SESSION</a>['log_userkey']; 
<a name="l22"><span class="linenum">  22</span></a>  
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment">// if no instrument_id is chosen, then force the user to choose one.</span>
<a name="l25"><span class="linenum">  25</span></a>  if (!isset(<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('_SESSION')" href="../../_variables/_SESSION.html">$_SESSION</a>['instrument_id'])) {
<a name="l26"><span class="linenum">  26</span></a>      <a class="function" onClick="logFunction('WA_Auth_RestrictAccess')" href="../../_functions/wa_auth_restrictaccess.html" onMouseOver="funcPopup(event,'wa_auth_restrictaccess')">WA_Auth_RestrictAccess</a>(&quot;../select_instrument.php&quot;);
<a name="l27"><span class="linenum">  27</span></a>  }
<a name="l28"><span class="linenum">  28</span></a>  <a class="var it483" onMouseOver="hilite(483)" onMouseOut="lolite()" onClick="logVariable('instrument_id')" href="../../_variables/instrument_id.html">$instrument_id</a> = <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('_SESSION')" href="../../_variables/_SESSION.html">$_SESSION</a>['instrument_id'];
<a name="l29"><span class="linenum">  29</span></a>  <a class="var it485" onMouseOver="hilite(485)" onMouseOut="lolite()" onClick="logVariable('instrument_id_base')" href="../../_variables/instrument_id_base.html">$instrument_id_base</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;_JOURNAL&quot;, &quot;&quot;, <a class="var it483" onMouseOver="hilite(483)" onMouseOut="lolite()" onClick="logVariable('instrument_id')" href="../../_variables/instrument_id.html">$instrument_id</a>); 
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment">// If an LAKEY is specified, then the user should just be directed on to the first page.</span>
<a name="l35"><span class="linenum">  35</span></a>  if (isset(<a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../../_variables/_GET.html">$_GET</a>['lakey']) AND <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../../_variables/_GET.html">$_GET</a>['lakey'] &lt;&gt; &quot;&quot;) {
<a name="l36"><span class="linenum">  36</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>(sprintf(&quot;Location: assess_personal1.php?lakey=&quot;.<a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../../_variables/_GET.html">$_GET</a>['lakey']));
<a name="l37"><span class="linenum">  37</span></a>      exit();
<a name="l38"><span class="linenum">  38</span></a>  }
<a name="l39"><span class="linenum">  39</span></a>  
<a name="l40"><span class="linenum">  40</span></a>  
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">//                        CALCULATE WHICH TEST TIME THIS IS</span>
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">// The test time is calculated as: find the largest test_time number among this user's records for this instrument_id, and add 1 to it. If the assignment has a test time assigned to it, this result won't matter.</span>
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>  <a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('query_rsTestTime')" href="../../_variables/query_rsTestTime.html">$query_rsTestTime</a> = sprintf(&quot;SELECT lakey, userkey, test_time FROM la_data WHERE userkey = %s AND (instrument_id = %s OR instrument_id = %s) ORDER BY test_time DESC&quot;, 
<a name="l47"><span class="linenum">  47</span></a>          <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('userkey')" href="../../_variables/userkey.html">$userkey</a>, &quot;int&quot;), 
<a name="l48"><span class="linenum">  48</span></a>          <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it485" onMouseOver="hilite(485)" onMouseOut="lolite()" onClick="logVariable('instrument_id_base')" href="../../_variables/instrument_id_base.html">$instrument_id_base</a>, &quot;text&quot;),
<a name="l49"><span class="linenum">  49</span></a>          <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it485" onMouseOver="hilite(485)" onMouseOut="lolite()" onClick="logVariable('instrument_id_base')" href="../../_variables/instrument_id_base.html">$instrument_id_base</a>.&quot;_JOURNAL&quot;, &quot;text&quot;));
<a name="l50"><span class="linenum">  50</span></a>  <a class="var it1823" onMouseOver="hilite(1823)" onMouseOut="lolite()" onClick="logVariable('rsTestTime')" href="../../_variables/rsTestTime.html">$rsTestTime</a> = <a class="phpfunction" onClick="logFunction('mysql_query')" href="../../_functions/mysql_query.html" onMouseOver="phpfuncPopup(event,'mysql_query')">mysql_query</a>(<a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('query_rsTestTime')" href="../../_variables/query_rsTestTime.html">$query_rsTestTime</a>, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('Assessment')" href="../../_variables/Assessment.html">$Assessment</a>) or die(<a class="phpfunction" onClick="logFunction('mysql_error')" href="../../_functions/mysql_error.html" onMouseOver="phpfuncPopup(event,'mysql_error')">mysql_error</a>());
<a name="l51"><span class="linenum">  51</span></a>  <a class="var it1824" onMouseOver="hilite(1824)" onMouseOut="lolite()" onClick="logVariable('row_rsTestTime')" href="../../_variables/row_rsTestTime.html">$row_rsTestTime</a> = <a class="phpfunction" onClick="logFunction('mysql_fetch_assoc')" href="../../_functions/mysql_fetch_assoc.html" onMouseOver="phpfuncPopup(event,'mysql_fetch_assoc')">mysql_fetch_assoc</a>(<a class="var it1823" onMouseOver="hilite(1823)" onMouseOut="lolite()" onClick="logVariable('rsTestTime')" href="../../_variables/rsTestTime.html">$rsTestTime</a>);
<a name="l52"><span class="linenum">  52</span></a>  <a class="var it2298" onMouseOver="hilite(2298)" onMouseOut="lolite()" onClick="logVariable('test_time_today')" href="../../_variables/test_time_today.html">$test_time_today</a> = <a class="var it1824" onMouseOver="hilite(1824)" onMouseOut="lolite()" onClick="logVariable('row_rsTestTime')" href="../../_variables/row_rsTestTime.html">$row_rsTestTime</a>['test_time'] + 1;
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>  
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">// Look up this registrant</span>
<a name="l57"><span class="linenum">  57</span></a>  <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = sprintf(&quot;SELECT * FROM registrants WHERE userkey = %s&quot;, 
<a name="l58"><span class="linenum">  58</span></a>      <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('userkey')" href="../../_variables/userkey.html">$userkey</a>, 'int'));
<a name="l59"><span class="linenum">  59</span></a>  <a class="var it142" onMouseOver="hilite(142)" onMouseOut="lolite()" onClick="logVariable('rsRegistrant')" href="../../_variables/rsRegistrant.html">$rsRegistrant</a> = <a class="phpfunction" onClick="logFunction('mysql_query')" href="../../_functions/mysql_query.html" onMouseOver="phpfuncPopup(event,'mysql_query')">mysql_query</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>) or die(&quot;ERROR looking up this user.&quot;);
<a name="l60"><span class="linenum">  60</span></a>  <a class="var it757" onMouseOver="hilite(757)" onMouseOut="lolite()" onClick="logVariable('registrant')" href="../../_variables/registrant.html">$registrant</a> = <a class="phpfunction" onClick="logFunction('mysql_fetch_assoc')" href="../../_functions/mysql_fetch_assoc.html" onMouseOver="phpfuncPopup(event,'mysql_fetch_assoc')">mysql_fetch_assoc</a>(<a class="var it142" onMouseOver="hilite(142)" onMouseOut="lolite()" onClick="logVariable('rsRegistrant')" href="../../_variables/rsRegistrant.html">$rsRegistrant</a>);
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">//                         CHECK IF THE USER HAS ANY UN-STARTED ASSIGNMENTS FOR THIS INSTRUMENT_ID</span>
<a name="l63"><span class="linenum">  63</span></a>  
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">// Prioritizes 1) any assignment which is LIVE; 2) the most recent incomplete assignment.</span>
<a name="l65"><span class="linenum">  65</span></a>  <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = sprintf(&quot;SELECT a.*, dil.*, rb.company, r.bulkuserkey, 
<a name="l66"><span class="linenum">  66</span></a>          IF(<a class="function" onClick="logFunction('NOW')" href="../../_functions/now.html" onMouseOver="funcPopup(event,'now')">NOW</a>() BETWEEN a.date_start AND a.date_end, 1, 0) AS is_live
<a name="l67"><span class="linenum">  67</span></a>      FROM registrants r 
<a name="l68"><span class="linenum">  68</span></a>          JOIN students_assignments sa ON r.userkey = sa.userkey 
<a name="l69"><span class="linenum">  69</span></a>          JOIN la_assignments a ON sa.assignmentkey = a.assignmentkey
<a name="l70"><span class="linenum">  70</span></a>              AND <a class="function" onClick="logFunction('NOW')" href="../../_functions/now.html" onMouseOver="funcPopup(event,'now')">NOW</a>() &gt;= a.date_start
<a name="l71"><span class="linenum">  71</span></a>          LEFT JOIN la_data d ON d.userkey = r.userkey AND d.assignmentkey = sa.assignmentkey
<a name="l72"><span class="linenum">  72</span></a>          LEFT JOIN la_dilemmas dil ON a.assign_dilemmakey = dil.dilemmakey 
<a name="l73"><span class="linenum">  73</span></a>          LEFT JOIN registrants rb ON a.bulkcustomerkey = rb.userkey 
<a name="l74"><span class="linenum">  74</span></a>      WHERE r.userkey = %s AND a.instrument_id = %s AND d.lakey IS NULL
<a name="l75"><span class="linenum">  75</span></a>      ORDER BY is_live DESC, a.date_end DESC 
<a name="l76"><span class="linenum">  76</span></a>      LIMIT 1&quot;,
<a name="l77"><span class="linenum">  77</span></a>          <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('userkey')" href="../../_variables/userkey.html">$userkey</a>, &quot;int&quot;),
<a name="l78"><span class="linenum">  78</span></a>          <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it483" onMouseOver="hilite(483)" onMouseOut="lolite()" onClick="logVariable('instrument_id')" href="../../_variables/instrument_id.html">$instrument_id</a>, &quot;text&quot;));
<a name="l79"><span class="linenum">  79</span></a>  <a class="var it2299" onMouseOver="hilite(2299)" onMouseOut="lolite()" onClick="logVariable('rsAssignments')" href="../../_variables/rsAssignments.html">$rsAssignments</a> = <a class="phpfunction" onClick="logFunction('mysql_query')" href="../../_functions/mysql_query.html" onMouseOver="phpfuncPopup(event,'mysql_query')">mysql_query</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>) or die(&quot;rsAssignments: &quot;.<a class="phpfunction" onClick="logFunction('mysql_error')" href="../../_functions/mysql_error.html" onMouseOver="phpfuncPopup(event,'mysql_error')">mysql_error</a>());
<a name="l80"><span class="linenum">  80</span></a>  <a class="var it2300" onMouseOver="hilite(2300)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a> = <a class="phpfunction" onClick="logFunction('mysql_fetch_assoc')" href="../../_functions/mysql_fetch_assoc.html" onMouseOver="phpfuncPopup(event,'mysql_fetch_assoc')">mysql_fetch_assoc</a>(<a class="var it2299" onMouseOver="hilite(2299)" onMouseOut="lolite()" onClick="logVariable('rsAssignments')" href="../../_variables/rsAssignments.html">$rsAssignments</a>);
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">// If this assignment has a test time marked for it, save that test_time rather than the autocalc one.</span>
<a name="l83"><span class="linenum">  83</span></a>  if (<a class="var it2300" onMouseOver="hilite(2300)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>['test_time'] &gt; 0) { 
<a name="l84"><span class="linenum">  84</span></a>      <a class="var it2298" onMouseOver="hilite(2298)" onMouseOut="lolite()" onClick="logVariable('test_time_today')" href="../../_variables/test_time_today.html">$test_time_today</a> = <a class="var it2300" onMouseOver="hilite(2300)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>['test_time'];
<a name="l85"><span class="linenum">  85</span></a>  }
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment">// If this assn has research conditions, look up the dilemma for this user's condition + test time. </span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">// Otherwise, default to the dilemmakey selected for this assignment (which may in turn be blank).</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">// NOTE: There is NO NEED to check whether a previous la_data record is associated with this conditionkey. Only one la_data record should be associated with an assignmentkey (barring rare problem cases), and that's all we need worry about. </span>
<a name="l90"><span class="linenum">  90</span></a>  <a class="var it2301" onMouseOver="hilite(2301)" onMouseOut="lolite()" onClick="logVariable('dilemmakey')" href="../../_variables/dilemmakey.html">$dilemmakey</a> = <a class="var it2300" onMouseOver="hilite(2300)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>['dilemmakey'];
<a name="l91"><span class="linenum">  91</span></a>  <a class="var it2302" onMouseOver="hilite(2302)" onMouseOut="lolite()" onClick="logVariable('conditionkey')" href="../../_variables/conditionkey.html">$conditionkey</a> = null;
<a name="l92"><span class="linenum">  92</span></a>  if (<a class="var it2300" onMouseOver="hilite(2300)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>['use_dilemma_conditions'] == 1) { 
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">    // Look up this research condition, if a dilemma is present for this test time</span>
<a name="l94"><span class="linenum">  94</span></a>      <a class="var it2303" onMouseOver="hilite(2303)" onMouseOut="lolite()" onClick="logVariable('sql_condition')" href="../../_variables/sql_condition.html">$sql_condition</a> = sprintf(&quot;SELECT c.* 
<a name="l95"><span class="linenum">  95</span></a>          FROM students_conditions sc 
<a name="l96"><span class="linenum">  96</span></a>              JOIN la_conditions c ON sc.conditionkey = c.conditionkey
<a name="l97"><span class="linenum">  97</span></a>          WHERE sc.userkey = %s AND c.instrument_id = %s AND time0%s_dilemmakey &gt; 0 &quot;,
<a name="l98"><span class="linenum">  98</span></a>              <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('userkey')" href="../../_variables/userkey.html">$userkey</a>, 'int'),
<a name="l99"><span class="linenum">  99</span></a>              <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it483" onMouseOver="hilite(483)" onMouseOut="lolite()" onClick="logVariable('instrument_id')" href="../../_variables/instrument_id.html">$instrument_id</a>, 'text'),
<a name="l100"><span class="linenum"> 100</span></a>              <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it2298" onMouseOver="hilite(2298)" onMouseOut="lolite()" onClick="logVariable('test_time_today')" href="../../_variables/test_time_today.html">$test_time_today</a>, 'int'));
<a name="l101"><span class="linenum"> 101</span></a>      <a class="var it2304" onMouseOver="hilite(2304)" onMouseOut="lolite()" onClick="logVariable('rsCondition')" href="../../_variables/rsCondition.html">$rsCondition</a> = <a class="phpfunction" onClick="logFunction('mysql_query')" href="../../_functions/mysql_query.html" onMouseOver="phpfuncPopup(event,'mysql_query')">mysql_query</a>(<a class="var it2303" onMouseOver="hilite(2303)" onMouseOut="lolite()" onClick="logVariable('sql_condition')" href="../../_variables/sql_condition.html">$sql_condition</a>) or die(&quot;ERROR preparing test condition: &quot;.<a class="phpfunction" onClick="logFunction('mysql_error')" href="../../_functions/mysql_error.html" onMouseOver="phpfuncPopup(event,'mysql_error')">mysql_error</a>());
<a name="l102"><span class="linenum"> 102</span></a>      <a class="var it2305" onMouseOver="hilite(2305)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a> = <a class="phpfunction" onClick="logFunction('mysql_fetch_assoc')" href="../../_functions/mysql_fetch_assoc.html" onMouseOver="phpfuncPopup(event,'mysql_fetch_assoc')">mysql_fetch_assoc</a>(<a class="var it2304" onMouseOver="hilite(2304)" onMouseOut="lolite()" onClick="logVariable('rsCondition')" href="../../_variables/rsCondition.html">$rsCondition</a>);
<a name="l103"><span class="linenum"> 103</span></a>      if (<a class="var it2305" onMouseOver="hilite(2305)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>['conditionkey'] &gt; 0) { 
<a name="l104"><span class="linenum"> 104</span></a>          <a class="var it2302" onMouseOver="hilite(2302)" onMouseOut="lolite()" onClick="logVariable('conditionkey')" href="../../_variables/conditionkey.html">$conditionkey</a> = <a class="var it2305" onMouseOver="hilite(2305)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>['conditionkey'];
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it2301" onMouseOver="hilite(2301)" onMouseOut="lolite()" onClick="logVariable('dilemmakey')" href="../../_variables/dilemmakey.html">$dilemmakey</a> = <a class="var it2305" onMouseOver="hilite(2305)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>['time0'.<a class="var it2298" onMouseOver="hilite(2298)" onMouseOut="lolite()" onClick="logVariable('test_time_today')" href="../../_variables/test_time_today.html">$test_time_today</a>.'_dilemmakey'];
<a name="l106"><span class="linenum"> 106</span></a>      }
<a name="l107"><span class="linenum"> 107</span></a>  }
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment">// Resellerkey: based on assignment if present, otherwise based on the user</span>
<a name="l112"><span class="linenum"> 112</span></a>  <a class="var it2306" onMouseOver="hilite(2306)" onMouseOut="lolite()" onClick="logVariable('resellerkey')" href="../../_variables/resellerkey.html">$resellerkey</a> = <a class="var it2300" onMouseOver="hilite(2300)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>['bulkuserkey'];
<a name="l113"><span class="linenum"> 113</span></a>  if (<a class="var it2306" onMouseOver="hilite(2306)" onMouseOut="lolite()" onClick="logVariable('resellerkey')" href="../../_variables/resellerkey.html">$resellerkey</a> == 0) { <a class="var it2306" onMouseOver="hilite(2306)" onMouseOut="lolite()" onClick="logVariable('resellerkey')" href="../../_variables/resellerkey.html">$resellerkey</a> = <a class="var it757" onMouseOver="hilite(757)" onMouseOut="lolite()" onClick="logVariable('registrant')" href="../../_variables/registrant.html">$registrant</a>['bulkuserkey']; }
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>  <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('insertSQL')" href="../../_variables/insertSQL.html">$insertSQL</a> = sprintf(&quot;INSERT INTO la_data 
<a name="l116"><span class="linenum"> 116</span></a>      (instrument_id, userkey, resellerkey, test_time, assignmentkey, conditionkey, dilemmakey) 
<a name="l117"><span class="linenum"> 117</span></a>      <a class="function" onClick="logFunction('VALUES')" href="../../_functions/values.html" onMouseOver="funcPopup(event,'values')">VALUES</a> (%s, %s, %s, %s, %s, %s, %s) &quot;,
<a name="l118"><span class="linenum"> 118</span></a>           <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it483" onMouseOver="hilite(483)" onMouseOut="lolite()" onClick="logVariable('instrument_id')" href="../../_variables/instrument_id.html">$instrument_id</a>, 'text'),
<a name="l119"><span class="linenum"> 119</span></a>           <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('userkey')" href="../../_variables/userkey.html">$userkey</a>, 'int'),
<a name="l120"><span class="linenum"> 120</span></a>           <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it2306" onMouseOver="hilite(2306)" onMouseOut="lolite()" onClick="logVariable('resellerkey')" href="../../_variables/resellerkey.html">$resellerkey</a>, 'int'),
<a name="l121"><span class="linenum"> 121</span></a>           <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it2298" onMouseOver="hilite(2298)" onMouseOut="lolite()" onClick="logVariable('test_time_today')" href="../../_variables/test_time_today.html">$test_time_today</a>, 'int'),
<a name="l122"><span class="linenum"> 122</span></a>           <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it2300" onMouseOver="hilite(2300)" onMouseOut="lolite()" onClick="logVariable('assignment')" href="../../_variables/assignment.html">$assignment</a>['assignmentkey'], 'int'),
<a name="l123"><span class="linenum"> 123</span></a>           <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it2302" onMouseOver="hilite(2302)" onMouseOut="lolite()" onClick="logVariable('conditionkey')" href="../../_variables/conditionkey.html">$conditionkey</a>, 'int'),
<a name="l124"><span class="linenum"> 124</span></a>           <a class="function" onClick="logFunction('SQLstr')" href="../../_functions/sqlstr.html" onMouseOver="funcPopup(event,'sqlstr')">SQLstr</a>(<a class="var it2301" onMouseOver="hilite(2301)" onMouseOut="lolite()" onClick="logVariable('dilemmakey')" href="../../_variables/dilemmakey.html">$dilemmakey</a>, 'int'));
<a name="l125"><span class="linenum"> 125</span></a>  
<a name="l126"><span class="linenum"> 126</span></a>  <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('Result1')" href="../../_variables/Result1.html">$Result1</a> = <a class="phpfunction" onClick="logFunction('mysql_query')" href="../../_functions/mysql_query.html" onMouseOver="phpfuncPopup(event,'mysql_query')">mysql_query</a>(<a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('insertSQL')" href="../../_variables/insertSQL.html">$insertSQL</a>, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('Assessment')" href="../../_variables/Assessment.html">$Assessment</a>) or die(&quot;Insert new record: &quot;.<a class="phpfunction" onClick="logFunction('mysql_error')" href="../../_functions/mysql_error.html" onMouseOver="phpfuncPopup(event,'mysql_error')">mysql_error</a>());
<a name="l127"><span class="linenum"> 127</span></a>  <a class="var it1797" onMouseOver="hilite(1797)" onMouseOut="lolite()" onClick="logVariable('insert_ID')" href="../../_variables/insert_ID.html">$insert_ID</a> = <a class="phpfunction" onClick="logFunction('mysql_insert_id')" href="../../_functions/mysql_insert_id.html" onMouseOver="phpfuncPopup(event,'mysql_insert_id')">mysql_insert_id</a>();
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>  <a class="var it2307" onMouseOver="hilite(2307)" onMouseOut="lolite()" onClick="logVariable('time_start')" href="../../_variables/time_start.html">$time_start</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(); <span class="comment">// note the time the record was started.</span>
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">// If this record is finished in one sitting (not interrupted such that the URL variables would be reloaded), the URL var starttime will be carried through to the final page and the time to complete will be calculated there.</span>
<a name="l131"><span class="linenum"> 131</span></a>  
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>  
<a name="l134"><span class="linenum"> 134</span></a>  <a class="var it194" onMouseOver="hilite(194)" onMouseOut="lolite()" onClick="logVariable('insertGoTo')" href="../../_variables/insertGoTo.html">$insertGoTo</a> = &quot;assess_personal1.php?lakey=&quot;.<a class="var it1797" onMouseOver="hilite(1797)" onMouseOut="lolite()" onClick="logVariable('insert_ID')" href="../../_variables/insert_ID.html">$insert_ID</a>;
<a name="l135"><span class="linenum"> 135</span></a>  if (isset(<a class="var it2307" onMouseOver="hilite(2307)" onMouseOut="lolite()" onClick="logVariable('time_start')" href="../../_variables/time_start.html">$time_start</a>)) { <a class="var it194" onMouseOver="hilite(194)" onMouseOut="lolite()" onClick="logVariable('insertGoTo')" href="../../_variables/insertGoTo.html">$insertGoTo</a> .= &quot;&amp;starttime=&quot;.<a class="var it2307" onMouseOver="hilite(2307)" onMouseOut="lolite()" onClick="logVariable('time_start')" href="../../_variables/time_start.html">$time_start</a>; }
<a name="l136"><span class="linenum"> 136</span></a>  if (isset(<a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['QUERY_STRING'])) {
<a name="l137"><span class="linenum"> 137</span></a>      <a class="var it194" onMouseOver="hilite(194)" onMouseOut="lolite()" onClick="logVariable('insertGoTo')" href="../../_variables/insertGoTo.html">$insertGoTo</a> .= (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it194" onMouseOver="hilite(194)" onMouseOut="lolite()" onClick="logVariable('insertGoTo')" href="../../_variables/insertGoTo.html">$insertGoTo</a>, '?')) ? &quot;&amp;&quot; : &quot;?&quot;;
<a name="l138"><span class="linenum"> 138</span></a>      <a class="var it194" onMouseOver="hilite(194)" onMouseOut="lolite()" onClick="logVariable('insertGoTo')" href="../../_variables/insertGoTo.html">$insertGoTo</a> .= <a class="var it71" onMouseOver="hilite(71)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['QUERY_STRING'];
<a name="l139"><span class="linenum"> 139</span></a>  }
<a name="l140"><span class="linenum"> 140</span></a>  
<a name="l141"><span class="linenum"> 141</span></a>  <a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>(sprintf(&quot;Location: %s&quot;, <a class="var it194" onMouseOver="hilite(194)" onMouseOut="lolite()" onClick="logVariable('insertGoTo')" href="../../_variables/insertGoTo.html">$insertGoTo</a>));
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'wa_auth_restrictaccess': ['wa_auth_restrictaccess', '', [['DTS/WA_SecurityAssist','Helper_PHP.php',66]], 777],
'now': ['now', '', [['DTS/jQuery/includes','jquery-1.4.2.js',822]], 80],
'values': ['values', '', [['DTS/openflashcharts/actionscript','Values.as',7]], 135],
'wa_auth_rulepasses': ['wa_auth_rulepasses', '', [['DTS/WA_SecurityAssist','Helper_PHP.php',160]], 771],
'sqlstr': ['sqlstr', '', [['DTS/includes','general_custom_functions.php',16],['DTS/includes','dts_functions.php',206],['DTS/includes','dts_functions_2.php',57],['DTS/_sorttask','sorttasklead.php',5]], 1466],
'mysql_query': ['mysql_query', '', [], 5079],
'error_reporting': ['error_reporting', '', [], 10],
'mysql_error': ['mysql_error', '', [], 4717],
'strpos': ['strpos', '', [], 897],
'ob_start': ['ob_start', '', [], 50],
'mysql_fetch_assoc': ['mysql_fetch_assoc', '', [], 9670],
'str_replace': ['str_replace', '', [], 1019],
'session_start': ['session_start', '', [], 39],
'mysql_insert_id': ['mysql_insert_id', '', [], 47],
'time': ['time', '', [], 44],
'mysql_select_db': ['mysql_select_db', '', [], 3995],
'header': ['header', '', [], 717]};
CLASS_DATA={
};
CONST_DATA={
};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Mon May  5 14:14:03 2014</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
