<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : DTS : /DTS/DTSassets/xpath.js source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of DTS</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Mon May  5 14:14:03 2014 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='DTS/DTSassets';
filename='xpath.js.source.html';
cookiekey='phpxref_dts';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/DTS/DTSassets/</a> -> <a href="xpath.js.html">xpath.js</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="xpath.js.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="xpath.js.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  <span class="comment">// xpath.js - version 0.7 - Spry Pre-Release 1.6.1</span>
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">//</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// Code from xmltoken.js.</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Copyright 2006 Google Inc.</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// All Rights Reserved</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">//</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// Defines regular expression patterns to extract XML tokens from string.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// See &lt;http://www.w3.org/TR/REC-xml/#sec-common-syn&gt;,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// &lt;http://www.w3.org/TR/xml11/#sec-common-syn&gt; and</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// &lt;http://www.w3.org/TR/REC-xml-names/#NT-NCName&gt; for the specifications.</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">//</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// Author: Junji Takagi &lt;jtakagi@google.com&gt;</span>
<a name="l14"><span class="linenum">  14</span></a>  
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// Detect whether RegExp supports Unicode characters or not.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  var REGEXP_UNICODE = function() {
<a name="l18"><span class="linenum">  18</span></a>    var tests = [' ', '\u0120', -1,  // Konquerer 3.4.0 fails here.
<a name="l19"><span class="linenum">  19</span></a>                 '!', '\u0120', -1,
<a name="l20"><span class="linenum">  20</span></a>                 '\u0120', '\u0120', 0,
<a name="l21"><span class="linenum">  21</span></a>                 '\u0121', '\u0120', -1,
<a name="l22"><span class="linenum">  22</span></a>                 '\u0121', '\u0120|\u0121', 0,
<a name="l23"><span class="linenum">  23</span></a>                 '\u0122', '\u0120|\u0121', -1,
<a name="l24"><span class="linenum">  24</span></a>                 '\u0120', '[\u0120]', 0,  // Safari 2.0.3 fails here.
<a name="l25"><span class="linenum">  25</span></a>                 '\u0121', '[\u0120]', -1,
<a name="l26"><span class="linenum">  26</span></a>                 '\u0121', '[\u0120\u0121]', 0,  // Safari 2.0.3 fails here.
<a name="l27"><span class="linenum">  27</span></a>                 '\u0122', '[\u0120\u0121]', -1,
<a name="l28"><span class="linenum">  28</span></a>                 '\u0121', '[\u0120-\u0121]', 0,  // Safari 2.0.3 fails here.
<a name="l29"><span class="linenum">  29</span></a>                 '\u0122', '[\u0120-\u0121]', -1];
<a name="l30"><span class="linenum">  30</span></a>    for (var i = 0; i &lt; tests.length; i += 3) {
<a name="l31"><span class="linenum">  31</span></a>      if (tests[i].search(new RegExp(tests[i + 1])) != tests[i + 2]) {
<a name="l32"><span class="linenum">  32</span></a>        return false;
<a name="l33"><span class="linenum">  33</span></a>      }
<a name="l34"><span class="linenum">  34</span></a>    }
<a name="l35"><span class="linenum">  35</span></a>    return true;
<a name="l36"><span class="linenum">  36</span></a>  }();
<a name="l37"><span class="linenum">  37</span></a>  
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">// Common tokens in XML 1.0 and XML 1.1.</span>
<a name="l39"><span class="linenum">  39</span></a>  
<a name="l40"><span class="linenum">  40</span></a>  var XML_S = '[ \t\r\n]+';
<a name="l41"><span class="linenum">  41</span></a>  var XML_EQ = '(' + XML_S + ')?=(' + XML_S + ')?';
<a name="l42"><span class="linenum">  42</span></a>  var XML_CHAR_REF = '&amp;#[0-9]+;|&amp;#x[0-9a-fA-F]+;';
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">// XML 1.0 tokens.</span>
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>  var XML10_VERSION_INFO = XML_S + 'version' + XML_EQ + '(&quot;1\\.0&quot;|' + &quot;'1\\.0')&quot;;
<a name="l47"><span class="linenum">  47</span></a>  var XML10_BASE_CHAR = (REGEXP_UNICODE) ?
<a name="l48"><span class="linenum">  48</span></a>    '\u0041-\u005a\u0061-\u007a\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff' +
<a name="l49"><span class="linenum">  49</span></a>    '\u0100-\u0131\u0134-\u013e\u0141-\u0148\u014a-\u017e\u0180-\u01c3' +
<a name="l50"><span class="linenum">  50</span></a>    '\u01cd-\u01f0\u01f4-\u01f5\u01fa-\u0217\u0250-\u02a8\u02bb-\u02c1\u0386' +
<a name="l51"><span class="linenum">  51</span></a>    '\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03ce\u03d0-\u03d6\u03da\u03dc' +
<a name="l52"><span class="linenum">  52</span></a>    '\u03de\u03e0\u03e2-\u03f3\u0401-\u040c\u040e-\u044f\u0451-\u045c' +
<a name="l53"><span class="linenum">  53</span></a>    '\u045e-\u0481\u0490-\u04c4\u04c7-\u04c8\u04cb-\u04cc\u04d0-\u04eb' +
<a name="l54"><span class="linenum">  54</span></a>    '\u04ee-\u04f5\u04f8-\u04f9\u0531-\u0556\u0559\u0561-\u0586\u05d0-\u05ea' +
<a name="l55"><span class="linenum">  55</span></a>    '\u05f0-\u05f2\u0621-\u063a\u0641-\u064a\u0671-\u06b7\u06ba-\u06be' +
<a name="l56"><span class="linenum">  56</span></a>    '\u06c0-\u06ce\u06d0-\u06d3\u06d5\u06e5-\u06e6\u0905-\u0939\u093d' +
<a name="l57"><span class="linenum">  57</span></a>    '\u0958-\u0961\u0985-\u098c\u098f-\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2' +
<a name="l58"><span class="linenum">  58</span></a>    '\u09b6-\u09b9\u09dc-\u09dd\u09df-\u09e1\u09f0-\u09f1\u0a05-\u0a0a' +
<a name="l59"><span class="linenum">  59</span></a>    '\u0a0f-\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32-\u0a33\u0a35-\u0a36' +
<a name="l60"><span class="linenum">  60</span></a>    '\u0a38-\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8b\u0a8d' +
<a name="l61"><span class="linenum">  61</span></a>    '\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2-\u0ab3\u0ab5-\u0ab9' +
<a name="l62"><span class="linenum">  62</span></a>    '\u0abd\u0ae0\u0b05-\u0b0c\u0b0f-\u0b10\u0b13-\u0b28\u0b2a-\u0b30' +
<a name="l63"><span class="linenum">  63</span></a>    '\u0b32-\u0b33\u0b36-\u0b39\u0b3d\u0b5c-\u0b5d\u0b5f-\u0b61\u0b85-\u0b8a' +
<a name="l64"><span class="linenum">  64</span></a>    '\u0b8e-\u0b90\u0b92-\u0b95\u0b99-\u0b9a\u0b9c\u0b9e-\u0b9f\u0ba3-\u0ba4' +
<a name="l65"><span class="linenum">  65</span></a>    '\u0ba8-\u0baa\u0bae-\u0bb5\u0bb7-\u0bb9\u0c05-\u0c0c\u0c0e-\u0c10' +
<a name="l66"><span class="linenum">  66</span></a>    '\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c60-\u0c61\u0c85-\u0c8c' +
<a name="l67"><span class="linenum">  67</span></a>    '\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cde\u0ce0-\u0ce1' +
<a name="l68"><span class="linenum">  68</span></a>    '\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d60-\u0d61' +
<a name="l69"><span class="linenum">  69</span></a>    '\u0e01-\u0e2e\u0e30\u0e32-\u0e33\u0e40-\u0e45\u0e81-\u0e82\u0e84' +
<a name="l70"><span class="linenum">  70</span></a>    '\u0e87-\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5' +
<a name="l71"><span class="linenum">  71</span></a>    '\u0ea7\u0eaa-\u0eab\u0ead-\u0eae\u0eb0\u0eb2-\u0eb3\u0ebd\u0ec0-\u0ec4' +
<a name="l72"><span class="linenum">  72</span></a>    '\u0f40-\u0f47\u0f49-\u0f69\u10a0-\u10c5\u10d0-\u10f6\u1100\u1102-\u1103' +
<a name="l73"><span class="linenum">  73</span></a>    '\u1105-\u1107\u1109\u110b-\u110c\u110e-\u1112\u113c\u113e\u1140\u114c' +
<a name="l74"><span class="linenum">  74</span></a>    '\u114e\u1150\u1154-\u1155\u1159\u115f-\u1161\u1163\u1165\u1167\u1169' +
<a name="l75"><span class="linenum">  75</span></a>    '\u116d-\u116e\u1172-\u1173\u1175\u119e\u11a8\u11ab\u11ae-\u11af' +
<a name="l76"><span class="linenum">  76</span></a>    '\u11b7-\u11b8\u11ba\u11bc-\u11c2\u11eb\u11f0\u11f9\u1e00-\u1e9b' +
<a name="l77"><span class="linenum">  77</span></a>    '\u1ea0-\u1ef9\u1f00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d' +
<a name="l78"><span class="linenum">  78</span></a>    '\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc' +
<a name="l79"><span class="linenum">  79</span></a>    '\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec' +
<a name="l80"><span class="linenum">  80</span></a>    '\u1ff2-\u1ff4\u1ff6-\u1ffc\u2126\u212a-\u212b\u212e\u2180-\u2182' +
<a name="l81"><span class="linenum">  81</span></a>    '\u3041-\u3094\u30a1-\u30fa\u3105-\u312c\uac00-\ud7a3' :
<a name="l82"><span class="linenum">  82</span></a>    'A-Za-z';
<a name="l83"><span class="linenum">  83</span></a>  var XML10_IDEOGRAPHIC = (REGEXP_UNICODE) ?
<a name="l84"><span class="linenum">  84</span></a>    '\u4e00-\u9fa5\u3007\u3021-\u3029' :
<a name="l85"><span class="linenum">  85</span></a>    '';
<a name="l86"><span class="linenum">  86</span></a>  var XML10_COMBINING_CHAR = (REGEXP_UNICODE) ?
<a name="l87"><span class="linenum">  87</span></a>    '\u0300-\u0345\u0360-\u0361\u0483-\u0486\u0591-\u05a1\u05a3-\u05b9' +
<a name="l88"><span class="linenum">  88</span></a>    '\u05bb-\u05bd\u05bf\u05c1-\u05c2\u05c4\u064b-\u0652\u0670\u06d6-\u06dc' +
<a name="l89"><span class="linenum">  89</span></a>    '\u06dd-\u06df\u06e0-\u06e4\u06e7-\u06e8\u06ea-\u06ed\u0901-\u0903\u093c' +
<a name="l90"><span class="linenum">  90</span></a>    '\u093e-\u094c\u094d\u0951-\u0954\u0962-\u0963\u0981-\u0983\u09bc\u09be' +
<a name="l91"><span class="linenum">  91</span></a>    '\u09bf\u09c0-\u09c4\u09c7-\u09c8\u09cb-\u09cd\u09d7\u09e2-\u09e3\u0a02' +
<a name="l92"><span class="linenum">  92</span></a>    '\u0a3c\u0a3e\u0a3f\u0a40-\u0a42\u0a47-\u0a48\u0a4b-\u0a4d\u0a70-\u0a71' +
<a name="l93"><span class="linenum">  93</span></a>    '\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0b01-\u0b03' +
<a name="l94"><span class="linenum">  94</span></a>    '\u0b3c\u0b3e-\u0b43\u0b47-\u0b48\u0b4b-\u0b4d\u0b56-\u0b57\u0b82-\u0b83' +
<a name="l95"><span class="linenum">  95</span></a>    '\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0c01-\u0c03\u0c3e-\u0c44' +
<a name="l96"><span class="linenum">  96</span></a>    '\u0c46-\u0c48\u0c4a-\u0c4d\u0c55-\u0c56\u0c82-\u0c83\u0cbe-\u0cc4' +
<a name="l97"><span class="linenum">  97</span></a>    '\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5-\u0cd6\u0d02-\u0d03\u0d3e-\u0d43' +
<a name="l98"><span class="linenum">  98</span></a>    '\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1' +
<a name="l99"><span class="linenum">  99</span></a>    '\u0eb4-\u0eb9\u0ebb-\u0ebc\u0ec8-\u0ecd\u0f18-\u0f19\u0f35\u0f37\u0f39' +
<a name="l100"><span class="linenum"> 100</span></a>    '\u0f3e\u0f3f\u0f71-\u0f84\u0f86-\u0f8b\u0f90-\u0f95\u0f97\u0f99-\u0fad' +
<a name="l101"><span class="linenum"> 101</span></a>    '\u0fb1-\u0fb7\u0fb9\u20d0-\u20dc\u20e1\u302a-\u302f\u3099\u309a' :
<a name="l102"><span class="linenum"> 102</span></a>    '';
<a name="l103"><span class="linenum"> 103</span></a>  var XML10_DIGIT = (REGEXP_UNICODE) ?
<a name="l104"><span class="linenum"> 104</span></a>    '\u0030-\u0039\u0660-\u0669\u06f0-\u06f9\u0966-\u096f\u09e6-\u09ef' +
<a name="l105"><span class="linenum"> 105</span></a>    '\u0a66-\u0a6f\u0ae6-\u0aef\u0b66-\u0b6f\u0be7-\u0bef\u0c66-\u0c6f' +
<a name="l106"><span class="linenum"> 106</span></a>    '\u0ce6-\u0cef\u0d66-\u0d6f\u0e50-\u0e59\u0ed0-\u0ed9\u0f20-\u0f29' :
<a name="l107"><span class="linenum"> 107</span></a>    '0-9';
<a name="l108"><span class="linenum"> 108</span></a>  var XML10_EXTENDER = (REGEXP_UNICODE) ?
<a name="l109"><span class="linenum"> 109</span></a>    '\u00b7\u02d0\u02d1\u0387\u0640\u0e46\u0ec6\u3005\u3031-\u3035' +
<a name="l110"><span class="linenum"> 110</span></a>    '\u309d-\u309e\u30fc-\u30fe' :
<a name="l111"><span class="linenum"> 111</span></a>    '';
<a name="l112"><span class="linenum"> 112</span></a>  var XML10_LETTER = XML10_BASE_CHAR + XML10_IDEOGRAPHIC;
<a name="l113"><span class="linenum"> 113</span></a>  var XML10_NAME_CHAR = XML10_LETTER + XML10_DIGIT + '\\._:' +
<a name="l114"><span class="linenum"> 114</span></a>                        XML10_COMBINING_CHAR + XML10_EXTENDER + '-';
<a name="l115"><span class="linenum"> 115</span></a>  var XML10_NAME = '[' + XML10_LETTER + '_:][' + XML10_NAME_CHAR + ']*';
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>  var XML10_ENTITY_REF = '&amp;' + XML10_NAME + ';';
<a name="l118"><span class="linenum"> 118</span></a>  var XML10_REFERENCE = XML10_ENTITY_REF + '|' + XML_CHAR_REF;
<a name="l119"><span class="linenum"> 119</span></a>  var XML10_ATT_VALUE = '&quot;(([^&lt;&amp;&quot;]|' + XML10_REFERENCE + ')*)&quot;|' +
<a name="l120"><span class="linenum"> 120</span></a>                        &quot;'(([^&lt;&amp;']|&quot; + XML10_REFERENCE + &quot;)*)'&quot;;
<a name="l121"><span class="linenum"> 121</span></a>  var XML10_ATTRIBUTE =
<a name="l122"><span class="linenum"> 122</span></a>    '(' + XML10_NAME + ')' + XML_EQ + '(' + XML10_ATT_VALUE + ')';
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">// XML 1.1 tokens.</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">// TODO(jtakagi): NameStartChar also includes \u10000-\ueffff.</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">// ECMAScript Language Specifiction defines UnicodeEscapeSequence as</span>
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">// &quot;\u HexDigit HexDigit HexDigit HexDigit&quot; and we may need to use</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">// surrogate pairs, but any browser doesn't support surrogate paris in</span>
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">// character classes of regular expression, so avoid including them for now.</span>
<a name="l130"><span class="linenum"> 130</span></a>  
<a name="l131"><span class="linenum"> 131</span></a>  var XML11_VERSION_INFO = XML_S + 'version' + XML_EQ + '(&quot;1\\.1&quot;|' + &quot;'1\\.1')&quot;;
<a name="l132"><span class="linenum"> 132</span></a>  var XML11_NAME_START_CHAR = (REGEXP_UNICODE) ?
<a name="l133"><span class="linenum"> 133</span></a>    ':A-Z_a-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02ff\u0370-\u037d' +
<a name="l134"><span class="linenum"> 134</span></a>    '\u037f-\u1fff\u200c-\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff' +
<a name="l135"><span class="linenum"> 135</span></a>    '\uf900-\ufdcf\ufdf0-\ufffd' :
<a name="l136"><span class="linenum"> 136</span></a>    ':A-Z_a-z';
<a name="l137"><span class="linenum"> 137</span></a>  var XML11_NAME_CHAR = XML11_NAME_START_CHAR +
<a name="l138"><span class="linenum"> 138</span></a>    ((REGEXP_UNICODE) ? '\\.0-9\u00b7\u0300-\u036f\u203f-\u2040-' : '\\.0-9-');
<a name="l139"><span class="linenum"> 139</span></a>  var XML11_NAME = '[' + XML11_NAME_START_CHAR + '][' + XML11_NAME_CHAR + ']*';
<a name="l140"><span class="linenum"> 140</span></a>  
<a name="l141"><span class="linenum"> 141</span></a>  var XML11_ENTITY_REF = '&amp;' + XML11_NAME + ';';
<a name="l142"><span class="linenum"> 142</span></a>  var XML11_REFERENCE = XML11_ENTITY_REF + '|' + XML_CHAR_REF;
<a name="l143"><span class="linenum"> 143</span></a>  var XML11_ATT_VALUE = '&quot;(([^&lt;&amp;&quot;]|' + XML11_REFERENCE + ')*)&quot;|' +
<a name="l144"><span class="linenum"> 144</span></a>                        &quot;'(([^&lt;&amp;']|&quot; + XML11_REFERENCE + &quot;)*)'&quot;;
<a name="l145"><span class="linenum"> 145</span></a>  var XML11_ATTRIBUTE =
<a name="l146"><span class="linenum"> 146</span></a>    '(' + XML11_NAME + ')' + XML_EQ + '(' + XML11_ATT_VALUE + ')';
<a name="l147"><span class="linenum"> 147</span></a>  
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">// XML Namespace tokens.</span>
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">// Used in XML parser and XPath parser.</span>
<a name="l150"><span class="linenum"> 150</span></a>  
<a name="l151"><span class="linenum"> 151</span></a>  var XML_NC_NAME_CHAR = XML10_LETTER + XML10_DIGIT + '\\._' +
<a name="l152"><span class="linenum"> 152</span></a>                         XML10_COMBINING_CHAR + XML10_EXTENDER + '-';
<a name="l153"><span class="linenum"> 153</span></a>  var XML_NC_NAME = '[' + XML10_LETTER + '_][' + XML_NC_NAME_CHAR + ']*';
<a name="l154"><span class="linenum"> 154</span></a>  
<a name="l155"><span class="linenum"> 155</span></a>  
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">// Code from dom.js.</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">//</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">// Based on &lt;http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">// core.html#ID-1950641247&gt;</span>
<a name="l160"><span class="linenum"> 160</span></a>  var DOM_ELEMENT_NODE = 1;
<a name="l161"><span class="linenum"> 161</span></a>  var DOM_ATTRIBUTE_NODE = 2;
<a name="l162"><span class="linenum"> 162</span></a>  var DOM_TEXT_NODE = 3;
<a name="l163"><span class="linenum"> 163</span></a>  var DOM_CDATA_SECTION_NODE = 4;
<a name="l164"><span class="linenum"> 164</span></a>  var DOM_ENTITY_REFERENCE_NODE = 5;
<a name="l165"><span class="linenum"> 165</span></a>  var DOM_ENTITY_NODE = 6;
<a name="l166"><span class="linenum"> 166</span></a>  var DOM_PROCESSING_INSTRUCTION_NODE = 7;
<a name="l167"><span class="linenum"> 167</span></a>  var DOM_COMMENT_NODE = 8;
<a name="l168"><span class="linenum"> 168</span></a>  var DOM_DOCUMENT_NODE = 9;
<a name="l169"><span class="linenum"> 169</span></a>  var DOM_DOCUMENT_TYPE_NODE = 10;
<a name="l170"><span class="linenum"> 170</span></a>  var DOM_DOCUMENT_FRAGMENT_NODE = 11;
<a name="l171"><span class="linenum"> 171</span></a>  var DOM_NOTATION_NODE = 12;
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">// Code from util.js.</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">//</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">// Copyright 2005 Google</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">//</span>
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment">// Author: Steffen Meschkat &lt;mesch@google.com&gt;</span>
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment">//</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment">// Miscellaneous utility and placeholder functions.</span>
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">// Dummy implmentation for the logging functions. Replace by something</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment">// useful when you want to debug.</span>
<a name="l183"><span class="linenum"> 183</span></a>  function <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>(msg) {};
<a name="l184"><span class="linenum"> 184</span></a>  function <a class="function" onClick="logFunction('xsltLog')" href="../../_functions/xsltlog.html" onMouseOver="funcPopup(event,'xsltlog')">xsltLog</a>(msg) {};
<a name="l185"><span class="linenum"> 185</span></a>  function <a class="function" onClick="logFunction('xsltLogXml')" href="../../_functions/xsltlogxml.html" onMouseOver="funcPopup(event,'xsltlogxml')">xsltLogXml</a>(msg) {};
<a name="l186"><span class="linenum"> 186</span></a>  
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment">// Throws an exception if false.</span>
<a name="l188"><span class="linenum"> 188</span></a>  function <a class="function" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="funcPopup(event,'assert')">assert</a>(b) {
<a name="l189"><span class="linenum"> 189</span></a>    if (!b) {
<a name="l190"><span class="linenum"> 190</span></a>      throw &quot;Assertion failed&quot;;
<a name="l191"><span class="linenum"> 191</span></a>    }
<a name="l192"><span class="linenum"> 192</span></a>  }
<a name="l193"><span class="linenum"> 193</span></a>  
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">// Splits a string s at all occurrences of character c. This is like</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">// the split() method of the string object, but IE omits empty</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">// strings, which violates the invariant (s.split(x).join(x) == s).</span>
<a name="l197"><span class="linenum"> 197</span></a>  function <a class="function" onClick="logFunction('stringSplit')" href="../../_functions/stringsplit.html" onMouseOver="funcPopup(event,'stringsplit')">stringSplit</a>(s, c) {
<a name="l198"><span class="linenum"> 198</span></a>    var a = s.indexOf(c);
<a name="l199"><span class="linenum"> 199</span></a>    if (a == -1) {
<a name="l200"><span class="linenum"> 200</span></a>      return [ s ];
<a name="l201"><span class="linenum"> 201</span></a>    }
<a name="l202"><span class="linenum"> 202</span></a>    var parts = [];
<a name="l203"><span class="linenum"> 203</span></a>    parts.push(s.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(0,a));
<a name="l204"><span class="linenum"> 204</span></a>    while (a != -1) {
<a name="l205"><span class="linenum"> 205</span></a>      var a1 = s.indexOf(c, a + 1);
<a name="l206"><span class="linenum"> 206</span></a>      if (a1 != -1) {
<a name="l207"><span class="linenum"> 207</span></a>        parts.push(s.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(a + 1, a1 - a - 1));
<a name="l208"><span class="linenum"> 208</span></a>      } else {
<a name="l209"><span class="linenum"> 209</span></a>        parts.push(s.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(a + 1));
<a name="l210"><span class="linenum"> 210</span></a>      }
<a name="l211"><span class="linenum"> 211</span></a>      a = a1;
<a name="l212"><span class="linenum"> 212</span></a>    }
<a name="l213"><span class="linenum"> 213</span></a>    return parts;
<a name="l214"><span class="linenum"> 214</span></a>  }
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment">// Applies the given function to each element of the array, preserving</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">// this, and passing the index.</span>
<a name="l218"><span class="linenum"> 218</span></a>  function <a class="function" onClick="logFunction('mapExec')" href="../../_functions/mapexec.html" onMouseOver="funcPopup(event,'mapexec')">mapExec</a>(array, func) {
<a name="l219"><span class="linenum"> 219</span></a>    for (var i = 0; i &lt; array.length; ++i) {
<a name="l220"><span class="linenum"> 220</span></a>      func.call(this, array[i], i);
<a name="l221"><span class="linenum"> 221</span></a>    }
<a name="l222"><span class="linenum"> 222</span></a>  }
<a name="l223"><span class="linenum"> 223</span></a>  
<a name="l224"><span class="linenum"> 224</span></a>  <span class="comment">// Returns an array that contains the return value of the given</span>
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment">// function applied to every element of the input array.</span>
<a name="l226"><span class="linenum"> 226</span></a>  function <a class="function" onClick="logFunction('mapExpr')" href="../../_functions/mapexpr.html" onMouseOver="funcPopup(event,'mapexpr')">mapExpr</a>(array, func) {
<a name="l227"><span class="linenum"> 227</span></a>    var ret = [];
<a name="l228"><span class="linenum"> 228</span></a>    for (var i = 0; i &lt; array.length; ++i) {
<a name="l229"><span class="linenum"> 229</span></a>      ret.push(func(array[i]));
<a name="l230"><span class="linenum"> 230</span></a>    }
<a name="l231"><span class="linenum"> 231</span></a>    return ret;
<a name="l232"><span class="linenum"> 232</span></a>  };
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">// Reverses the given array in place.</span>
<a name="l235"><span class="linenum"> 235</span></a>  function <a class="function" onClick="logFunction('reverseInplace')" href="../../_functions/reverseinplace.html" onMouseOver="funcPopup(event,'reverseinplace')">reverseInplace</a>(array) {
<a name="l236"><span class="linenum"> 236</span></a>    for (var i = 0; i &lt; array.length / 2; ++i) {
<a name="l237"><span class="linenum"> 237</span></a>      var h = array[i];
<a name="l238"><span class="linenum"> 238</span></a>      var ii = array.length - i - 1;
<a name="l239"><span class="linenum"> 239</span></a>      array[i] = array[ii];
<a name="l240"><span class="linenum"> 240</span></a>      array[ii] = h;
<a name="l241"><span class="linenum"> 241</span></a>    }
<a name="l242"><span class="linenum"> 242</span></a>  }
<a name="l243"><span class="linenum"> 243</span></a>  
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment">// Removes value from array. Returns the number of instances of value</span>
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment">// that were removed from array.</span>
<a name="l246"><span class="linenum"> 246</span></a>  function <a class="function" onClick="logFunction('removeFromArray')" href="../../_functions/removefromarray.html" onMouseOver="funcPopup(event,'removefromarray')">removeFromArray</a>(array, value, opt_notype) {
<a name="l247"><span class="linenum"> 247</span></a>    var shift = 0;
<a name="l248"><span class="linenum"> 248</span></a>    for (var i = 0; i &lt; array.length; ++i) {
<a name="l249"><span class="linenum"> 249</span></a>      if (array[i] === value || (opt_notype &amp;&amp; array[i] == value)) {
<a name="l250"><span class="linenum"> 250</span></a>        array.splice(i--, 1);
<a name="l251"><span class="linenum"> 251</span></a>        shift++;
<a name="l252"><span class="linenum"> 252</span></a>      }
<a name="l253"><span class="linenum"> 253</span></a>    }
<a name="l254"><span class="linenum"> 254</span></a>    return shift;
<a name="l255"><span class="linenum"> 255</span></a>  }
<a name="l256"><span class="linenum"> 256</span></a>  
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">// Shallow-copies an array.</span>
<a name="l258"><span class="linenum"> 258</span></a>  function <a class="function" onClick="logFunction('copyArray')" href="../../_functions/copyarray.html" onMouseOver="funcPopup(event,'copyarray')">copyArray</a>(dst, src) {
<a name="l259"><span class="linenum"> 259</span></a>    for (var i = 0; i &lt; src.length; ++i) {
<a name="l260"><span class="linenum"> 260</span></a>      dst.push(src[i]);
<a name="l261"><span class="linenum"> 261</span></a>    }
<a name="l262"><span class="linenum"> 262</span></a>  }
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">// Returns the text value of a node; for nodes without children this</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment">// is the nodeValue, for nodes with children this is the concatenation</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">// of the value of all children.</span>
<a name="l267"><span class="linenum"> 267</span></a>  function <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(node) {
<a name="l268"><span class="linenum"> 268</span></a>    if (!node) {
<a name="l269"><span class="linenum"> 269</span></a>      return '';
<a name="l270"><span class="linenum"> 270</span></a>    }
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>    var ret = '';
<a name="l273"><span class="linenum"> 273</span></a>    if (node.nodeType == DOM_TEXT_NODE ||
<a name="l274"><span class="linenum"> 274</span></a>        node.nodeType == DOM_CDATA_SECTION_NODE ||
<a name="l275"><span class="linenum"> 275</span></a>        node.nodeType == DOM_ATTRIBUTE_NODE) {
<a name="l276"><span class="linenum"> 276</span></a>      ret += node.nodeValue;
<a name="l277"><span class="linenum"> 277</span></a>  
<a name="l278"><span class="linenum"> 278</span></a>    } else if (node.nodeType == DOM_ELEMENT_NODE ||
<a name="l279"><span class="linenum"> 279</span></a>               node.nodeType == DOM_DOCUMENT_NODE ||
<a name="l280"><span class="linenum"> 280</span></a>               node.nodeType == DOM_DOCUMENT_FRAGMENT_NODE) {
<a name="l281"><span class="linenum"> 281</span></a>      for (var i = 0; i &lt; node.childNodes.length; ++i) {
<a name="l282"><span class="linenum"> 282</span></a>        ret += arguments.callee(node.childNodes[i]);
<a name="l283"><span class="linenum"> 283</span></a>      }
<a name="l284"><span class="linenum"> 284</span></a>    }
<a name="l285"><span class="linenum"> 285</span></a>    return ret;
<a name="l286"><span class="linenum"> 286</span></a>  }
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">// Code from xpath.js.</span>
<a name="l289"><span class="linenum"> 289</span></a>  <span class="comment">//</span>
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment">// Copyright 2005 Google Inc.</span>
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment">// All Rights Reserved</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment">//</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment">// An XPath parser and evaluator written in JavaScript. The</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment">// implementation is complete except for functions handling</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment">// namespaces.</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment">//</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">// Reference: [XPATH] XPath Specification</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment">// &lt;http://www.w3.org/TR/1999/REC-xpath-19991116&gt;.</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment">//</span>
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment">//</span>
<a name="l301"><span class="linenum"> 301</span></a>  <span class="comment">// The API of the parser has several parts:</span>
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment">//</span>
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">// 1. The parser function xpathParse() that takes a string and returns</span>
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">// an expession object.</span>
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment">//</span>
<a name="l306"><span class="linenum"> 306</span></a>  <span class="comment">// 2. The expression object that has an evaluate() method to evaluate the</span>
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">// XPath expression it represents. (It is actually a hierarchy of</span>
<a name="l308"><span class="linenum"> 308</span></a>  <span class="comment">// objects that resembles the parse tree, but an application will call</span>
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment">// evaluate() only on the top node of this hierarchy.)</span>
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment">//</span>
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment">// 3. The context object that is passed as an argument to the evaluate()</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment">// method, which represents the DOM context in which the expression is</span>
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment">// evaluated.</span>
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">//</span>
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment">// 4. The value object that is returned from evaluate() and represents</span>
<a name="l316"><span class="linenum"> 316</span></a>  <span class="comment">// values of the different types that are defined by XPath (number,</span>
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">// string, boolean, and node-set), and allows to convert between them.</span>
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment">//</span>
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment">// These parts are near the top of the file, the functions and data</span>
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment">// that are used internally follow after them.</span>
<a name="l321"><span class="linenum"> 321</span></a>  <span class="comment">//</span>
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment">//</span>
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment">// Author: Steffen Meschkat &lt;mesch@google.com&gt;</span>
<a name="l324"><span class="linenum"> 324</span></a>  
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>  <span class="comment">// The entry point for the parser.</span>
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment">//</span>
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment">// @param expr a string that contains an XPath expression.</span>
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">// @return an expression object that can be evaluated with an</span>
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment">// expression context.</span>
<a name="l331"><span class="linenum"> 331</span></a>  
<a name="l332"><span class="linenum"> 332</span></a>  function <a class="function" onClick="logFunction('xpathParse')" href="../../_functions/xpathparse.html" onMouseOver="funcPopup(event,'xpathparse')">xpathParse</a>(expr) {
<a name="l333"><span class="linenum"> 333</span></a>    <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('parse ' + expr);
<a name="l334"><span class="linenum"> 334</span></a>    <a class="function" onClick="logFunction('xpathParseInit')" href="../../_functions/xpathparseinit.html" onMouseOver="funcPopup(event,'xpathparseinit')">xpathParseInit</a>();
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>    var cached = <a class="function" onClick="logFunction('xpathCacheLookup')" href="../../_functions/xpathcachelookup.html" onMouseOver="funcPopup(event,'xpathcachelookup')">xpathCacheLookup</a>(expr);
<a name="l337"><span class="linenum"> 337</span></a>    if (cached) {
<a name="l338"><span class="linenum"> 338</span></a>      <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>(' ... cached');
<a name="l339"><span class="linenum"> 339</span></a>      return cached;
<a name="l340"><span class="linenum"> 340</span></a>    }
<a name="l341"><span class="linenum"> 341</span></a>  
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">  // Optimize for a few common cases: simple attribute node tests</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment">  // (@id), simple element node tests (page), variable references</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">  // ($address), numbers (4), multi-step path expressions where each</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment">  // step is a plain element node test</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment">  // (page/overlay/locations/location).</span>
<a name="l347"><span class="linenum"> 347</span></a>  
<a name="l348"><span class="linenum"> 348</span></a>    if (expr.match(/^(\$|@)?\w+$/i)) {
<a name="l349"><span class="linenum"> 349</span></a>      var ret = <a class="function" onClick="logFunction('makeSimpleExpr')" href="../../_functions/makesimpleexpr.html" onMouseOver="funcPopup(event,'makesimpleexpr')">makeSimpleExpr</a>(expr);
<a name="l350"><span class="linenum"> 350</span></a>      xpathParseCache[expr] = ret;
<a name="l351"><span class="linenum"> 351</span></a>      <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>(' ... simple');
<a name="l352"><span class="linenum"> 352</span></a>      return ret;
<a name="l353"><span class="linenum"> 353</span></a>    }
<a name="l354"><span class="linenum"> 354</span></a>  
<a name="l355"><span class="linenum"> 355</span></a>    if (expr.match(/^\w+(\/\w+)*$/i)) {
<a name="l356"><span class="linenum"> 356</span></a>      var ret = <a class="function" onClick="logFunction('makeSimpleExpr2')" href="../../_functions/makesimpleexpr2.html" onMouseOver="funcPopup(event,'makesimpleexpr2')">makeSimpleExpr2</a>(expr);
<a name="l357"><span class="linenum"> 357</span></a>      xpathParseCache[expr] = ret;
<a name="l358"><span class="linenum"> 358</span></a>      <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>(' ... simple 2');
<a name="l359"><span class="linenum"> 359</span></a>      return ret;
<a name="l360"><span class="linenum"> 360</span></a>    }
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>    var cachekey = expr; <span class="comment">// expr is modified during parse</span>
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>    var stack = [];
<a name="l365"><span class="linenum"> 365</span></a>    var ahead = null;
<a name="l366"><span class="linenum"> 366</span></a>    var previous = null;
<a name="l367"><span class="linenum"> 367</span></a>    var done = false;
<a name="l368"><span class="linenum"> 368</span></a>  
<a name="l369"><span class="linenum"> 369</span></a>    var parse_count = 0;
<a name="l370"><span class="linenum"> 370</span></a>    var lexer_count = 0;
<a name="l371"><span class="linenum"> 371</span></a>    var reduce_count = 0;
<a name="l372"><span class="linenum"> 372</span></a>  
<a name="l373"><span class="linenum"> 373</span></a>    while (!done) {
<a name="l374"><span class="linenum"> 374</span></a>      parse_count++;
<a name="l375"><span class="linenum"> 375</span></a>      expr = expr.replace(/^\s*/, '');
<a name="l376"><span class="linenum"> 376</span></a>      previous = ahead;
<a name="l377"><span class="linenum"> 377</span></a>      ahead = null;
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>      var rule = null;
<a name="l380"><span class="linenum"> 380</span></a>      var match = '';
<a name="l381"><span class="linenum"> 381</span></a>      for (var i = 0; i &lt; xpathTokenRules.length; ++i) {
<a name="l382"><span class="linenum"> 382</span></a>        var result = xpathTokenRules[i].re.<a class="phpfunction" onClick="logFunction('exec')" href="../../_functions/exec.html" onMouseOver="phpfuncPopup(event,'exec')">exec</a>(expr);
<a name="l383"><span class="linenum"> 383</span></a>        lexer_count++;
<a name="l384"><span class="linenum"> 384</span></a>        if (result &amp;&amp; result.length &gt; 0 &amp;&amp; result[0].length &gt; match.length) {
<a name="l385"><span class="linenum"> 385</span></a>          rule = xpathTokenRules[i];
<a name="l386"><span class="linenum"> 386</span></a>          match = result[0];
<a name="l387"><span class="linenum"> 387</span></a>          break;
<a name="l388"><span class="linenum"> 388</span></a>        }
<a name="l389"><span class="linenum"> 389</span></a>      }
<a name="l390"><span class="linenum"> 390</span></a>  
<a name="l391"><span class="linenum"> 391</span></a>  <span class="comment">    // Special case: allow operator keywords to be element and</span>
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment">    // variable names.</span>
<a name="l393"><span class="linenum"> 393</span></a>  
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment">    // NOTE(mesch): The parser resolves conflicts by looking ahead,</span>
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment">    // and this is the only case where we look back to</span>
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment">    // disambiguate. So this is indeed something different, and</span>
<a name="l397"><span class="linenum"> 397</span></a>  <span class="comment">    // looking back is usually done in the lexer (via states in the</span>
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">    // general case, called &quot;start conditions&quot; in flex(1)). Also,the</span>
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment">    // conflict resolution in the parser is not as robust as it could</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">    // be, so I'd like to keep as much off the parser as possible (all</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">    // these precedence values should be computed from the grammar</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">    // rules and possibly associativity declarations, as in bison(1),</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment">    // and not explicitly set.</span>
<a name="l404"><span class="linenum"> 404</span></a>  
<a name="l405"><span class="linenum"> 405</span></a>      if (rule &amp;&amp;
<a name="l406"><span class="linenum"> 406</span></a>          (rule == TOK_DIV ||
<a name="l407"><span class="linenum"> 407</span></a>           rule == TOK_MOD ||
<a name="l408"><span class="linenum"> 408</span></a>           rule == TOK_AND ||
<a name="l409"><span class="linenum"> 409</span></a>           rule == TOK_OR) &amp;&amp;
<a name="l410"><span class="linenum"> 410</span></a>          (!previous ||
<a name="l411"><span class="linenum"> 411</span></a>           previous.tag == TOK_AT ||
<a name="l412"><span class="linenum"> 412</span></a>           previous.tag == TOK_DSLASH ||
<a name="l413"><span class="linenum"> 413</span></a>           previous.tag == TOK_SLASH ||
<a name="l414"><span class="linenum"> 414</span></a>           previous.tag == TOK_AXIS ||
<a name="l415"><span class="linenum"> 415</span></a>           previous.tag == TOK_DOLLAR)) {
<a name="l416"><span class="linenum"> 416</span></a>        rule = TOK_QNAME;
<a name="l417"><span class="linenum"> 417</span></a>      }
<a name="l418"><span class="linenum"> 418</span></a>  
<a name="l419"><span class="linenum"> 419</span></a>      if (rule) {
<a name="l420"><span class="linenum"> 420</span></a>        expr = expr.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(match.length);
<a name="l421"><span class="linenum"> 421</span></a>        <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('token: ' + match + ' -- ' + rule.label);
<a name="l422"><span class="linenum"> 422</span></a>        ahead = {
<a name="l423"><span class="linenum"> 423</span></a>          tag: rule,
<a name="l424"><span class="linenum"> 424</span></a>          match: match,
<a name="l425"><span class="linenum"> 425</span></a>          prec: rule.prec ?  rule.prec : 0, // || 0 is removed by the compiler
<a name="l426"><span class="linenum"> 426</span></a>          expr: <a class="function" onClick="logFunction('makeTokenExpr')" href="../../_functions/maketokenexpr.html" onMouseOver="funcPopup(event,'maketokenexpr')">makeTokenExpr</a>(match)
<a name="l427"><span class="linenum"> 427</span></a>        };
<a name="l428"><span class="linenum"> 428</span></a>  
<a name="l429"><span class="linenum"> 429</span></a>      } else {
<a name="l430"><span class="linenum"> 430</span></a>        <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('DONE');
<a name="l431"><span class="linenum"> 431</span></a>        done = true;
<a name="l432"><span class="linenum"> 432</span></a>      }
<a name="l433"><span class="linenum"> 433</span></a>  
<a name="l434"><span class="linenum"> 434</span></a>      while (<a class="function" onClick="logFunction('xpathReduce')" href="../../_functions/xpathreduce.html" onMouseOver="funcPopup(event,'xpathreduce')">xpathReduce</a>(stack, ahead)) {
<a name="l435"><span class="linenum"> 435</span></a>        reduce_count++;
<a name="l436"><span class="linenum"> 436</span></a>        <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('stack: ' + <a class="function" onClick="logFunction('stackToString')" href="../../_functions/stacktostring.html" onMouseOver="funcPopup(event,'stacktostring')">stackToString</a>(stack));
<a name="l437"><span class="linenum"> 437</span></a>      }
<a name="l438"><span class="linenum"> 438</span></a>    }
<a name="l439"><span class="linenum"> 439</span></a>  
<a name="l440"><span class="linenum"> 440</span></a>    <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('stack: ' + <a class="function" onClick="logFunction('stackToString')" href="../../_functions/stacktostring.html" onMouseOver="funcPopup(event,'stacktostring')">stackToString</a>(stack));
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>    if (stack.length != 1) {
<a name="l443"><span class="linenum"> 443</span></a>      throw 'XPath parse error ' + cachekey + ':\n' + <a class="function" onClick="logFunction('stackToString')" href="../../_functions/stacktostring.html" onMouseOver="funcPopup(event,'stacktostring')">stackToString</a>(stack);
<a name="l444"><span class="linenum"> 444</span></a>    }
<a name="l445"><span class="linenum"> 445</span></a>  
<a name="l446"><span class="linenum"> 446</span></a>    var result = stack[0].expr;
<a name="l447"><span class="linenum"> 447</span></a>    xpathParseCache[cachekey] = result;
<a name="l448"><span class="linenum"> 448</span></a>  
<a name="l449"><span class="linenum"> 449</span></a>    <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('XPath parse: ' + parse_count + ' / ' +
<a name="l450"><span class="linenum"> 450</span></a>             lexer_count + ' / ' + reduce_count);
<a name="l451"><span class="linenum"> 451</span></a>  
<a name="l452"><span class="linenum"> 452</span></a>    return result;
<a name="l453"><span class="linenum"> 453</span></a>  }
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>  var xpathParseCache = {};
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>  function <a class="function" onClick="logFunction('xpathCacheLookup')" href="../../_functions/xpathcachelookup.html" onMouseOver="funcPopup(event,'xpathcachelookup')">xpathCacheLookup</a>(expr) {
<a name="l458"><span class="linenum"> 458</span></a>    return xpathParseCache[expr];
<a name="l459"><span class="linenum"> 459</span></a>  }
<a name="l460"><span class="linenum"> 460</span></a>  
<a name="l461"><span class="linenum"> 461</span></a>  function <a class="function" onClick="logFunction('xpathReduce')" href="../../_functions/xpathreduce.html" onMouseOver="funcPopup(event,'xpathreduce')">xpathReduce</a>(stack, ahead) {
<a name="l462"><span class="linenum"> 462</span></a>    var cand = null;
<a name="l463"><span class="linenum"> 463</span></a>  
<a name="l464"><span class="linenum"> 464</span></a>    if (stack.length &gt; 0) {
<a name="l465"><span class="linenum"> 465</span></a>      var top = stack[stack.length-1];
<a name="l466"><span class="linenum"> 466</span></a>      var ruleset = xpathRules[top.tag.key];
<a name="l467"><span class="linenum"> 467</span></a>  
<a name="l468"><span class="linenum"> 468</span></a>      if (ruleset) {
<a name="l469"><span class="linenum"> 469</span></a>        for (var i = 0; i &lt; ruleset.length; ++i) {
<a name="l470"><span class="linenum"> 470</span></a>          var rule = ruleset[i];
<a name="l471"><span class="linenum"> 471</span></a>          var match = <a class="function" onClick="logFunction('xpathMatchStack')" href="../../_functions/xpathmatchstack.html" onMouseOver="funcPopup(event,'xpathmatchstack')">xpathMatchStack</a>(stack, rule[1]);
<a name="l472"><span class="linenum"> 472</span></a>          if (match.length) {
<a name="l473"><span class="linenum"> 473</span></a>            cand = {
<a name="l474"><span class="linenum"> 474</span></a>              tag: rule[0],
<a name="l475"><span class="linenum"> 475</span></a>              rule: rule,
<a name="l476"><span class="linenum"> 476</span></a>              match: match
<a name="l477"><span class="linenum"> 477</span></a>            };
<a name="l478"><span class="linenum"> 478</span></a>            cand.prec = <a class="function" onClick="logFunction('xpathGrammarPrecedence')" href="../../_functions/xpathgrammarprecedence.html" onMouseOver="funcPopup(event,'xpathgrammarprecedence')">xpathGrammarPrecedence</a>(cand);
<a name="l479"><span class="linenum"> 479</span></a>            break;
<a name="l480"><span class="linenum"> 480</span></a>          }
<a name="l481"><span class="linenum"> 481</span></a>        }
<a name="l482"><span class="linenum"> 482</span></a>      }
<a name="l483"><span class="linenum"> 483</span></a>    }
<a name="l484"><span class="linenum"> 484</span></a>  
<a name="l485"><span class="linenum"> 485</span></a>    var ret;
<a name="l486"><span class="linenum"> 486</span></a>    if (cand &amp;&amp; (!ahead || cand.prec &gt; ahead.prec ||
<a name="l487"><span class="linenum"> 487</span></a>                 (ahead.tag.left &amp;&amp; cand.prec &gt;= ahead.prec))) {
<a name="l488"><span class="linenum"> 488</span></a>      for (var i = 0; i &lt; cand.match.matchlength; ++i) {
<a name="l489"><span class="linenum"> 489</span></a>        stack.pop();
<a name="l490"><span class="linenum"> 490</span></a>      }
<a name="l491"><span class="linenum"> 491</span></a>  
<a name="l492"><span class="linenum"> 492</span></a>      <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('reduce ' + cand.tag.label + ' ' + cand.prec +
<a name="l493"><span class="linenum"> 493</span></a>               ' ahead ' + (ahead ? ahead.tag.label + ' ' + ahead.prec +
<a name="l494"><span class="linenum"> 494</span></a>                            (ahead.tag.left ? ' left' : '')
<a name="l495"><span class="linenum"> 495</span></a>                            : ' none '));
<a name="l496"><span class="linenum"> 496</span></a>  
<a name="l497"><span class="linenum"> 497</span></a>      var matchexpr = <a class="function" onClick="logFunction('mapExpr')" href="../../_functions/mapexpr.html" onMouseOver="funcPopup(event,'mapexpr')">mapExpr</a>(cand.match, function(m) { return m.expr; });
<a name="l498"><span class="linenum"> 498</span></a>      cand.expr = cand.rule[3].apply(null, matchexpr);
<a name="l499"><span class="linenum"> 499</span></a>  
<a name="l500"><span class="linenum"> 500</span></a>      stack.push(cand);
<a name="l501"><span class="linenum"> 501</span></a>      ret = true;
<a name="l502"><span class="linenum"> 502</span></a>  
<a name="l503"><span class="linenum"> 503</span></a>    } else {
<a name="l504"><span class="linenum"> 504</span></a>      if (ahead) {
<a name="l505"><span class="linenum"> 505</span></a>        <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('shift ' + ahead.tag.label + ' ' + ahead.prec +
<a name="l506"><span class="linenum"> 506</span></a>                 (ahead.tag.left ? ' left' : '') +
<a name="l507"><span class="linenum"> 507</span></a>                 ' over ' + (cand ? cand.tag.label + ' ' +
<a name="l508"><span class="linenum"> 508</span></a>                             cand.prec : ' none'));
<a name="l509"><span class="linenum"> 509</span></a>        stack.push(ahead);
<a name="l510"><span class="linenum"> 510</span></a>      }
<a name="l511"><span class="linenum"> 511</span></a>      ret = false;
<a name="l512"><span class="linenum"> 512</span></a>    }
<a name="l513"><span class="linenum"> 513</span></a>    return ret;
<a name="l514"><span class="linenum"> 514</span></a>  }
<a name="l515"><span class="linenum"> 515</span></a>  
<a name="l516"><span class="linenum"> 516</span></a>  function <a class="function" onClick="logFunction('xpathMatchStack')" href="../../_functions/xpathmatchstack.html" onMouseOver="funcPopup(event,'xpathmatchstack')">xpathMatchStack</a>(stack, pattern) {
<a name="l517"><span class="linenum"> 517</span></a>  
<a name="l518"><span class="linenum"> 518</span></a>  <span class="comment">  // NOTE(mesch): The stack matches for variable cardinality are</span>
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">  // greedy but don't do backtracking. This would be an issue only</span>
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">  // with rules of the form A* A, i.e. with an element with variable</span>
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">  // cardinality followed by the same element. Since that doesn't</span>
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment">  // occur in the grammar at hand, all matches on the stack are</span>
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">  // unambiguous.</span>
<a name="l524"><span class="linenum"> 524</span></a>  
<a name="l525"><span class="linenum"> 525</span></a>    var S = stack.length;
<a name="l526"><span class="linenum"> 526</span></a>    var P = pattern.length;
<a name="l527"><span class="linenum"> 527</span></a>    var p, s;
<a name="l528"><span class="linenum"> 528</span></a>    var match = [];
<a name="l529"><span class="linenum"> 529</span></a>    match.matchlength = 0;
<a name="l530"><span class="linenum"> 530</span></a>    var ds = 0;
<a name="l531"><span class="linenum"> 531</span></a>    for (p = P - 1, s = S - 1; p &gt;= 0 &amp;&amp; s &gt;= 0; --p, s -= ds) {
<a name="l532"><span class="linenum"> 532</span></a>      ds = 0;
<a name="l533"><span class="linenum"> 533</span></a>      var qmatch = [];
<a name="l534"><span class="linenum"> 534</span></a>      if (pattern[p] == Q_MM) {
<a name="l535"><span class="linenum"> 535</span></a>        p -= 1;
<a name="l536"><span class="linenum"> 536</span></a>        match.push(qmatch);
<a name="l537"><span class="linenum"> 537</span></a>        while (s - ds &gt;= 0 &amp;&amp; stack[s - ds].tag == pattern[p]) {
<a name="l538"><span class="linenum"> 538</span></a>          qmatch.push(stack[s - ds]);
<a name="l539"><span class="linenum"> 539</span></a>          ds += 1;
<a name="l540"><span class="linenum"> 540</span></a>          match.matchlength += 1;
<a name="l541"><span class="linenum"> 541</span></a>        }
<a name="l542"><span class="linenum"> 542</span></a>  
<a name="l543"><span class="linenum"> 543</span></a>      } else if (pattern[p] == Q_01) {
<a name="l544"><span class="linenum"> 544</span></a>        p -= 1;
<a name="l545"><span class="linenum"> 545</span></a>        match.push(qmatch);
<a name="l546"><span class="linenum"> 546</span></a>        while (s - ds &gt;= 0 &amp;&amp; ds &lt; 2 &amp;&amp; stack[s - ds].tag == pattern[p]) {
<a name="l547"><span class="linenum"> 547</span></a>          qmatch.push(stack[s - ds]);
<a name="l548"><span class="linenum"> 548</span></a>          ds += 1;
<a name="l549"><span class="linenum"> 549</span></a>          match.matchlength += 1;
<a name="l550"><span class="linenum"> 550</span></a>        }
<a name="l551"><span class="linenum"> 551</span></a>  
<a name="l552"><span class="linenum"> 552</span></a>      } else if (pattern[p] == Q_1M) {
<a name="l553"><span class="linenum"> 553</span></a>        p -= 1;
<a name="l554"><span class="linenum"> 554</span></a>        match.push(qmatch);
<a name="l555"><span class="linenum"> 555</span></a>        if (stack[s].tag == pattern[p]) {
<a name="l556"><span class="linenum"> 556</span></a>          while (s - ds &gt;= 0 &amp;&amp; stack[s - ds].tag == pattern[p]) {
<a name="l557"><span class="linenum"> 557</span></a>            qmatch.push(stack[s - ds]);
<a name="l558"><span class="linenum"> 558</span></a>            ds += 1;
<a name="l559"><span class="linenum"> 559</span></a>            match.matchlength += 1;
<a name="l560"><span class="linenum"> 560</span></a>          }
<a name="l561"><span class="linenum"> 561</span></a>        } else {
<a name="l562"><span class="linenum"> 562</span></a>          return [];
<a name="l563"><span class="linenum"> 563</span></a>        }
<a name="l564"><span class="linenum"> 564</span></a>  
<a name="l565"><span class="linenum"> 565</span></a>      } else if (stack[s].tag == pattern[p]) {
<a name="l566"><span class="linenum"> 566</span></a>        match.push(stack[s]);
<a name="l567"><span class="linenum"> 567</span></a>        ds += 1;
<a name="l568"><span class="linenum"> 568</span></a>        match.matchlength += 1;
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>      } else {
<a name="l571"><span class="linenum"> 571</span></a>        return [];
<a name="l572"><span class="linenum"> 572</span></a>      }
<a name="l573"><span class="linenum"> 573</span></a>  
<a name="l574"><span class="linenum"> 574</span></a>      <a class="function" onClick="logFunction('reverseInplace')" href="../../_functions/reverseinplace.html" onMouseOver="funcPopup(event,'reverseinplace')">reverseInplace</a>(qmatch);
<a name="l575"><span class="linenum"> 575</span></a>      qmatch.expr = <a class="function" onClick="logFunction('mapExpr')" href="../../_functions/mapexpr.html" onMouseOver="funcPopup(event,'mapexpr')">mapExpr</a>(qmatch, function(m) { return m.expr; });
<a name="l576"><span class="linenum"> 576</span></a>    }
<a name="l577"><span class="linenum"> 577</span></a>  
<a name="l578"><span class="linenum"> 578</span></a>    <a class="function" onClick="logFunction('reverseInplace')" href="../../_functions/reverseinplace.html" onMouseOver="funcPopup(event,'reverseinplace')">reverseInplace</a>(match);
<a name="l579"><span class="linenum"> 579</span></a>  
<a name="l580"><span class="linenum"> 580</span></a>    if (p == -1) {
<a name="l581"><span class="linenum"> 581</span></a>      return match;
<a name="l582"><span class="linenum"> 582</span></a>  
<a name="l583"><span class="linenum"> 583</span></a>    } else {
<a name="l584"><span class="linenum"> 584</span></a>      return [];
<a name="l585"><span class="linenum"> 585</span></a>    }
<a name="l586"><span class="linenum"> 586</span></a>  }
<a name="l587"><span class="linenum"> 587</span></a>  
<a name="l588"><span class="linenum"> 588</span></a>  function <a class="function" onClick="logFunction('xpathTokenPrecedence')" href="../../_functions/xpathtokenprecedence.html" onMouseOver="funcPopup(event,'xpathtokenprecedence')">xpathTokenPrecedence</a>(tag) {
<a name="l589"><span class="linenum"> 589</span></a>    return tag.prec || 2;
<a name="l590"><span class="linenum"> 590</span></a>  }
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  function <a class="function" onClick="logFunction('xpathGrammarPrecedence')" href="../../_functions/xpathgrammarprecedence.html" onMouseOver="funcPopup(event,'xpathgrammarprecedence')">xpathGrammarPrecedence</a>(frame) {
<a name="l593"><span class="linenum"> 593</span></a>    var ret = 0;
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>    if (frame.rule) { <span class="comment">/* normal reduce */</span>
<a name="l596"><span class="linenum"> 596</span></a>      if (frame.rule.length &gt;= 3 &amp;&amp; frame.rule[2] &gt;= 0) {
<a name="l597"><span class="linenum"> 597</span></a>        ret = frame.rule[2];
<a name="l598"><span class="linenum"> 598</span></a>  
<a name="l599"><span class="linenum"> 599</span></a>      } else {
<a name="l600"><span class="linenum"> 600</span></a>        for (var i = 0; i &lt; frame.rule[1].length; ++i) {
<a name="l601"><span class="linenum"> 601</span></a>          var p = <a class="function" onClick="logFunction('xpathTokenPrecedence')" href="../../_functions/xpathtokenprecedence.html" onMouseOver="funcPopup(event,'xpathtokenprecedence')">xpathTokenPrecedence</a>(frame.rule[1][i]);
<a name="l602"><span class="linenum"> 602</span></a>          ret = Math.<a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(ret, p);
<a name="l603"><span class="linenum"> 603</span></a>        }
<a name="l604"><span class="linenum"> 604</span></a>      }
<a name="l605"><span class="linenum"> 605</span></a>    } else if (frame.tag) { <span class="comment">/* TOKEN match */</span>
<a name="l606"><span class="linenum"> 606</span></a>      ret = <a class="function" onClick="logFunction('xpathTokenPrecedence')" href="../../_functions/xpathtokenprecedence.html" onMouseOver="funcPopup(event,'xpathtokenprecedence')">xpathTokenPrecedence</a>(frame.tag);
<a name="l607"><span class="linenum"> 607</span></a>  
<a name="l608"><span class="linenum"> 608</span></a>    } else if (frame.length) { <span class="comment">/* Q_ match */</span>
<a name="l609"><span class="linenum"> 609</span></a>      for (var j = 0; j &lt; frame.length; ++j) {
<a name="l610"><span class="linenum"> 610</span></a>        var p = <a class="function" onClick="logFunction('xpathGrammarPrecedence')" href="../../_functions/xpathgrammarprecedence.html" onMouseOver="funcPopup(event,'xpathgrammarprecedence')">xpathGrammarPrecedence</a>(frame[j]);
<a name="l611"><span class="linenum"> 611</span></a>        ret = Math.<a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(ret, p);
<a name="l612"><span class="linenum"> 612</span></a>      }
<a name="l613"><span class="linenum"> 613</span></a>    }
<a name="l614"><span class="linenum"> 614</span></a>  
<a name="l615"><span class="linenum"> 615</span></a>    return ret;
<a name="l616"><span class="linenum"> 616</span></a>  }
<a name="l617"><span class="linenum"> 617</span></a>  
<a name="l618"><span class="linenum"> 618</span></a>  function <a class="function" onClick="logFunction('stackToString')" href="../../_functions/stacktostring.html" onMouseOver="funcPopup(event,'stacktostring')">stackToString</a>(stack) {
<a name="l619"><span class="linenum"> 619</span></a>    var ret = '';
<a name="l620"><span class="linenum"> 620</span></a>    for (var i = 0; i &lt; stack.length; ++i) {
<a name="l621"><span class="linenum"> 621</span></a>      if (ret) {
<a name="l622"><span class="linenum"> 622</span></a>        ret += '\n';
<a name="l623"><span class="linenum"> 623</span></a>      }
<a name="l624"><span class="linenum"> 624</span></a>      ret += stack[i].tag.label;
<a name="l625"><span class="linenum"> 625</span></a>    }
<a name="l626"><span class="linenum"> 626</span></a>    return ret;
<a name="l627"><span class="linenum"> 627</span></a>  }
<a name="l628"><span class="linenum"> 628</span></a>  
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment">// XPath expression evaluation context. An XPath context consists of a</span>
<a name="l631"><span class="linenum"> 631</span></a>  <span class="comment">// DOM node, a list of DOM nodes that contains this node, a number</span>
<a name="l632"><span class="linenum"> 632</span></a>  <span class="comment">// that represents the position of the single node in the list, and a</span>
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">// current set of variable bindings. (See XPath spec.)</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">//</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">// The interface of the expression context:</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">//</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment">//   Constructor -- gets the node, its position, the node set it</span>
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">//   belongs to, and a parent context as arguments. The parent context</span>
<a name="l639"><span class="linenum"> 639</span></a>  <span class="comment">//   is used to implement scoping rules for variables: if a variable</span>
<a name="l640"><span class="linenum"> 640</span></a>  <span class="comment">//   is not found in the current context, it is looked for in the</span>
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">//   parent context, recursively. Except for node, all arguments have</span>
<a name="l642"><span class="linenum"> 642</span></a>  <span class="comment">//   default values: default position is 0, default node set is the</span>
<a name="l643"><span class="linenum"> 643</span></a>  <span class="comment">//   set that contains only the node, and the default parent is null.</span>
<a name="l644"><span class="linenum"> 644</span></a>  <span class="comment">//</span>
<a name="l645"><span class="linenum"> 645</span></a>  <span class="comment">//     Notice that position starts at 0 at the outside interface;</span>
<a name="l646"><span class="linenum"> 646</span></a>  <span class="comment">//     inside XPath expressions this shows up as position()=1.</span>
<a name="l647"><span class="linenum"> 647</span></a>  <span class="comment">//</span>
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">//   clone() -- creates a new context with the current context as</span>
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">//   parent. If passed as argument to clone(), the new context has a</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment">//   different node, position, or node set. What is not passed is</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">//   inherited from the cloned context.</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">//</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">//   setVariable(name, expr) -- binds given XPath expression to the</span>
<a name="l654"><span class="linenum"> 654</span></a>  <span class="comment">//   name.</span>
<a name="l655"><span class="linenum"> 655</span></a>  <span class="comment">//</span>
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment">//   getVariable(name) -- what the name says.</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">//</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment">//   setNode(position) -- sets the context to the node at the given</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment">//   position. Needed to implement scoping rules for variables in</span>
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment">//   XPath. (A variable is visible to all subsequent siblings, not</span>
<a name="l661"><span class="linenum"> 661</span></a>  <span class="comment">//   only to its children.)</span>
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>  function <a class="function" onClick="logFunction('ExprContext')" href="../../_functions/exprcontext.html" onMouseOver="funcPopup(event,'exprcontext')">ExprContext</a>(node, opt_position, opt_nodelist, opt_parent) {
<a name="l664"><span class="linenum"> 664</span></a>    this.node = node;
<a name="l665"><span class="linenum"> 665</span></a>    this.position = opt_position || 0;
<a name="l666"><span class="linenum"> 666</span></a>    this.nodelist = opt_nodelist || [ node ];
<a name="l667"><span class="linenum"> 667</span></a>    this.variables = {};
<a name="l668"><span class="linenum"> 668</span></a>    this.parent = opt_parent || null;
<a name="l669"><span class="linenum"> 669</span></a>    if (opt_parent) {
<a name="l670"><span class="linenum"> 670</span></a>      this.root = opt_parent.root;
<a name="l671"><span class="linenum"> 671</span></a>    } else if (this.node.nodeType == DOM_DOCUMENT_NODE) {
<a name="l672"><span class="linenum"> 672</span></a>  <span class="comment">    // NOTE(mesch): DOM Spec stipulates that the ownerDocument of a</span>
<a name="l673"><span class="linenum"> 673</span></a>  <span class="comment">    // document is null. Our root, however is the document that we are</span>
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment">    // processing, so the initial context is created from its document</span>
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment">    // node, which case we must handle here explcitly.</span>
<a name="l676"><span class="linenum"> 676</span></a>      this.root = node;
<a name="l677"><span class="linenum"> 677</span></a>    } else {
<a name="l678"><span class="linenum"> 678</span></a>      this.root = node.ownerDocument;
<a name="l679"><span class="linenum"> 679</span></a>    }
<a name="l680"><span class="linenum"> 680</span></a>  }
<a name="l681"><span class="linenum"> 681</span></a>  
<a name="l682"><span class="linenum"> 682</span></a>  ExprContext.prototype.clone = function(opt_node, opt_position, opt_nodelist) {
<a name="l683"><span class="linenum"> 683</span></a>    return new <a class="function" onClick="logFunction('ExprContext')" href="../../_functions/exprcontext.html" onMouseOver="funcPopup(event,'exprcontext')">ExprContext</a>(
<a name="l684"><span class="linenum"> 684</span></a>        opt_node || this.node,
<a name="l685"><span class="linenum"> 685</span></a>        typeof opt_position != 'undefined' ? opt_position : this.position,
<a name="l686"><span class="linenum"> 686</span></a>        opt_nodelist || this.nodelist, this);
<a name="l687"><span class="linenum"> 687</span></a>  };
<a name="l688"><span class="linenum"> 688</span></a>  
<a name="l689"><span class="linenum"> 689</span></a>  ExprContext.prototype.setVariable = function(name, value) {
<a name="l690"><span class="linenum"> 690</span></a>    this.variables[name] = value;
<a name="l691"><span class="linenum"> 691</span></a>  };
<a name="l692"><span class="linenum"> 692</span></a>  
<a name="l693"><span class="linenum"> 693</span></a>  ExprContext.prototype.getVariable = function(name) {
<a name="l694"><span class="linenum"> 694</span></a>    if (typeof this.variables[name] != 'undefined') {
<a name="l695"><span class="linenum"> 695</span></a>      return this.variables[name];
<a name="l696"><span class="linenum"> 696</span></a>  
<a name="l697"><span class="linenum"> 697</span></a>    } else if (this.parent) {
<a name="l698"><span class="linenum"> 698</span></a>      return this.parent.getVariable(name);
<a name="l699"><span class="linenum"> 699</span></a>  
<a name="l700"><span class="linenum"> 700</span></a>    } else {
<a name="l701"><span class="linenum"> 701</span></a>      return null;
<a name="l702"><span class="linenum"> 702</span></a>    }
<a name="l703"><span class="linenum"> 703</span></a>  };
<a name="l704"><span class="linenum"> 704</span></a>  
<a name="l705"><span class="linenum"> 705</span></a>  ExprContext.prototype.setNode = function(position) {
<a name="l706"><span class="linenum"> 706</span></a>    this.node = this.nodelist[position];
<a name="l707"><span class="linenum"> 707</span></a>    this.position = position;
<a name="l708"><span class="linenum"> 708</span></a>  };
<a name="l709"><span class="linenum"> 709</span></a>  
<a name="l710"><span class="linenum"> 710</span></a>  ExprContext.prototype.contextSize = function() {
<a name="l711"><span class="linenum"> 711</span></a>    return this.nodelist.length;
<a name="l712"><span class="linenum"> 712</span></a>  };
<a name="l713"><span class="linenum"> 713</span></a>  
<a name="l714"><span class="linenum"> 714</span></a>  
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment">// XPath expression values. They are what XPath expressions evaluate</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment">// to. Strangely, the different value types are not specified in the</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment">// XPath syntax, but only in the semantics, so they don't show up as</span>
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment">// nonterminals in the grammar. Yet, some expressions are required to</span>
<a name="l719"><span class="linenum"> 719</span></a>  <span class="comment">// evaluate to particular types, and not every type can be coerced</span>
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment">// into every other type. Although the types of XPath values are</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">// similar to the types present in JavaScript, the type coercion rules</span>
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment">// are a bit peculiar, so we explicitly model XPath types instead of</span>
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">// mapping them onto JavaScript types. (See XPath spec.)</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">//</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">// The four types are:</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment">//</span>
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">//   StringValue</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment">//</span>
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment">//   NumberValue</span>
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment">//</span>
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment">//   BooleanValue</span>
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">//</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment">//   NodeSetValue</span>
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment">//</span>
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment">// The common interface of the value classes consists of methods that</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment">// implement the XPath type coercion rules:</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment">//</span>
<a name="l738"><span class="linenum"> 738</span></a>  <span class="comment">//   stringValue() -- returns the value as a JavaScript String,</span>
<a name="l739"><span class="linenum"> 739</span></a>  <span class="comment">//</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment">//   numberValue() -- returns the value as a JavaScript Number,</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment">//</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">//   booleanValue() -- returns the value as a JavaScript Boolean,</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment">//</span>
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment">//   nodeSetValue() -- returns the value as a JavaScript Array of DOM</span>
<a name="l745"><span class="linenum"> 745</span></a>  <span class="comment">//   Node objects.</span>
<a name="l746"><span class="linenum"> 746</span></a>  <span class="comment">//</span>
<a name="l747"><span class="linenum"> 747</span></a>  
<a name="l748"><span class="linenum"> 748</span></a>  function <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(value) {
<a name="l749"><span class="linenum"> 749</span></a>    this.value = value;
<a name="l750"><span class="linenum"> 750</span></a>    this.type = 'string';
<a name="l751"><span class="linenum"> 751</span></a>  }
<a name="l752"><span class="linenum"> 752</span></a>  
<a name="l753"><span class="linenum"> 753</span></a>  StringValue.prototype.stringValue = function() {
<a name="l754"><span class="linenum"> 754</span></a>    return this.value;
<a name="l755"><span class="linenum"> 755</span></a>  };
<a name="l756"><span class="linenum"> 756</span></a>  
<a name="l757"><span class="linenum"> 757</span></a>  StringValue.prototype.booleanValue = function() {
<a name="l758"><span class="linenum"> 758</span></a>    return this.value.length &gt; 0;
<a name="l759"><span class="linenum"> 759</span></a>  };
<a name="l760"><span class="linenum"> 760</span></a>  
<a name="l761"><span class="linenum"> 761</span></a>  StringValue.prototype.numberValue = function() {
<a name="l762"><span class="linenum"> 762</span></a>    return this.value - 0;
<a name="l763"><span class="linenum"> 763</span></a>  };
<a name="l764"><span class="linenum"> 764</span></a>  
<a name="l765"><span class="linenum"> 765</span></a>  StringValue.prototype.nodeSetValue = function() {
<a name="l766"><span class="linenum"> 766</span></a>    throw this;
<a name="l767"><span class="linenum"> 767</span></a>  };
<a name="l768"><span class="linenum"> 768</span></a>  
<a name="l769"><span class="linenum"> 769</span></a>  function <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(value) {
<a name="l770"><span class="linenum"> 770</span></a>    this.value = value;
<a name="l771"><span class="linenum"> 771</span></a>    this.type = 'boolean';
<a name="l772"><span class="linenum"> 772</span></a>  }
<a name="l773"><span class="linenum"> 773</span></a>  
<a name="l774"><span class="linenum"> 774</span></a>  BooleanValue.prototype.stringValue = function() {
<a name="l775"><span class="linenum"> 775</span></a>    return '' + this.value;
<a name="l776"><span class="linenum"> 776</span></a>  };
<a name="l777"><span class="linenum"> 777</span></a>  
<a name="l778"><span class="linenum"> 778</span></a>  BooleanValue.prototype.booleanValue = function() {
<a name="l779"><span class="linenum"> 779</span></a>    return this.value;
<a name="l780"><span class="linenum"> 780</span></a>  };
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>  BooleanValue.prototype.numberValue = function() {
<a name="l783"><span class="linenum"> 783</span></a>    return this.value ? 1 : 0;
<a name="l784"><span class="linenum"> 784</span></a>  };
<a name="l785"><span class="linenum"> 785</span></a>  
<a name="l786"><span class="linenum"> 786</span></a>  BooleanValue.prototype.nodeSetValue = function() {
<a name="l787"><span class="linenum"> 787</span></a>    throw this;
<a name="l788"><span class="linenum"> 788</span></a>  };
<a name="l789"><span class="linenum"> 789</span></a>  
<a name="l790"><span class="linenum"> 790</span></a>  function <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(value) {
<a name="l791"><span class="linenum"> 791</span></a>    this.value = value;
<a name="l792"><span class="linenum"> 792</span></a>    this.type = 'number';
<a name="l793"><span class="linenum"> 793</span></a>  }
<a name="l794"><span class="linenum"> 794</span></a>  
<a name="l795"><span class="linenum"> 795</span></a>  NumberValue.prototype.stringValue = function() {
<a name="l796"><span class="linenum"> 796</span></a>    return '' + this.value;
<a name="l797"><span class="linenum"> 797</span></a>  };
<a name="l798"><span class="linenum"> 798</span></a>  
<a name="l799"><span class="linenum"> 799</span></a>  NumberValue.prototype.booleanValue = function() {
<a name="l800"><span class="linenum"> 800</span></a>    return !!this.value;
<a name="l801"><span class="linenum"> 801</span></a>  };
<a name="l802"><span class="linenum"> 802</span></a>  
<a name="l803"><span class="linenum"> 803</span></a>  NumberValue.prototype.numberValue = function() {
<a name="l804"><span class="linenum"> 804</span></a>    return this.value - 0;
<a name="l805"><span class="linenum"> 805</span></a>  };
<a name="l806"><span class="linenum"> 806</span></a>  
<a name="l807"><span class="linenum"> 807</span></a>  NumberValue.prototype.nodeSetValue = function() {
<a name="l808"><span class="linenum"> 808</span></a>    throw this;
<a name="l809"><span class="linenum"> 809</span></a>  };
<a name="l810"><span class="linenum"> 810</span></a>  
<a name="l811"><span class="linenum"> 811</span></a>  function <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(value) {
<a name="l812"><span class="linenum"> 812</span></a>    this.value = value;
<a name="l813"><span class="linenum"> 813</span></a>    this.type = 'node-set';
<a name="l814"><span class="linenum"> 814</span></a>  }
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>  NodeSetValue.prototype.stringValue = function() {
<a name="l817"><span class="linenum"> 817</span></a>    if (this.value.length == 0) {
<a name="l818"><span class="linenum"> 818</span></a>      return '';
<a name="l819"><span class="linenum"> 819</span></a>    } else {
<a name="l820"><span class="linenum"> 820</span></a>      return <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(this.value[0]);
<a name="l821"><span class="linenum"> 821</span></a>    }
<a name="l822"><span class="linenum"> 822</span></a>  };
<a name="l823"><span class="linenum"> 823</span></a>  
<a name="l824"><span class="linenum"> 824</span></a>  NodeSetValue.prototype.booleanValue = function() {
<a name="l825"><span class="linenum"> 825</span></a>    return this.value.length &gt; 0;
<a name="l826"><span class="linenum"> 826</span></a>  };
<a name="l827"><span class="linenum"> 827</span></a>  
<a name="l828"><span class="linenum"> 828</span></a>  NodeSetValue.prototype.numberValue = function() {
<a name="l829"><span class="linenum"> 829</span></a>    return this.<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>() - 0;
<a name="l830"><span class="linenum"> 830</span></a>  };
<a name="l831"><span class="linenum"> 831</span></a>  
<a name="l832"><span class="linenum"> 832</span></a>  NodeSetValue.prototype.nodeSetValue = function() {
<a name="l833"><span class="linenum"> 833</span></a>    return this.value;
<a name="l834"><span class="linenum"> 834</span></a>  };
<a name="l835"><span class="linenum"> 835</span></a>  
<a name="l836"><span class="linenum"> 836</span></a>  <span class="comment">// XPath expressions. They are used as nodes in the parse tree and</span>
<a name="l837"><span class="linenum"> 837</span></a>  <span class="comment">// possess an evaluate() method to compute an XPath value given an XPath</span>
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment">// context. Expressions are returned from the parser. Teh set of</span>
<a name="l839"><span class="linenum"> 839</span></a>  <span class="comment">// expression classes closely mirrors the set of non terminal symbols</span>
<a name="l840"><span class="linenum"> 840</span></a>  <span class="comment">// in the grammar. Every non trivial nonterminal symbol has a</span>
<a name="l841"><span class="linenum"> 841</span></a>  <span class="comment">// corresponding expression class.</span>
<a name="l842"><span class="linenum"> 842</span></a>  <span class="comment">//</span>
<a name="l843"><span class="linenum"> 843</span></a>  <span class="comment">// The common expression interface consists of the following methods:</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">//</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">// evaluate(context) -- evaluates the expression, returns a value.</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment">//</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment">// toString() -- returns the XPath text representation of the</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment">// expression (defined in xsltdebug.js).</span>
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment">//</span>
<a name="l850"><span class="linenum"> 850</span></a>  <span class="comment">// parseTree(indent) -- returns a parse tree representation of the</span>
<a name="l851"><span class="linenum"> 851</span></a>  <span class="comment">// expression (defined in xsltdebug.js).</span>
<a name="l852"><span class="linenum"> 852</span></a>  
<a name="l853"><span class="linenum"> 853</span></a>  function <a class="function" onClick="logFunction('TokenExpr')" href="../../_functions/tokenexpr.html" onMouseOver="funcPopup(event,'tokenexpr')">TokenExpr</a>(m) {
<a name="l854"><span class="linenum"> 854</span></a>    this.value = m;
<a name="l855"><span class="linenum"> 855</span></a>  }
<a name="l856"><span class="linenum"> 856</span></a>  
<a name="l857"><span class="linenum"> 857</span></a>  TokenExpr.prototype.evaluate = function() {
<a name="l858"><span class="linenum"> 858</span></a>    return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(this.value);
<a name="l859"><span class="linenum"> 859</span></a>  };
<a name="l860"><span class="linenum"> 860</span></a>  
<a name="l861"><span class="linenum"> 861</span></a>  function <a class="function" onClick="logFunction('LocationExpr')" href="../../_functions/locationexpr.html" onMouseOver="funcPopup(event,'locationexpr')">LocationExpr</a>() {
<a name="l862"><span class="linenum"> 862</span></a>    this.absolute = false;
<a name="l863"><span class="linenum"> 863</span></a>    this.steps = [];
<a name="l864"><span class="linenum"> 864</span></a>  }
<a name="l865"><span class="linenum"> 865</span></a>  
<a name="l866"><span class="linenum"> 866</span></a>  LocationExpr.prototype.appendStep = function(s) {
<a name="l867"><span class="linenum"> 867</span></a>    this.steps.push(s);
<a name="l868"><span class="linenum"> 868</span></a>  };
<a name="l869"><span class="linenum"> 869</span></a>  
<a name="l870"><span class="linenum"> 870</span></a>  LocationExpr.prototype.prependStep = function(s) {
<a name="l871"><span class="linenum"> 871</span></a>    var steps0 = this.steps;
<a name="l872"><span class="linenum"> 872</span></a>    this.steps = [ s ];
<a name="l873"><span class="linenum"> 873</span></a>    for (var i = 0; i &lt; steps0.length; ++i) {
<a name="l874"><span class="linenum"> 874</span></a>      this.steps.push(steps0[i]);
<a name="l875"><span class="linenum"> 875</span></a>    }
<a name="l876"><span class="linenum"> 876</span></a>  };
<a name="l877"><span class="linenum"> 877</span></a>  
<a name="l878"><span class="linenum"> 878</span></a>  LocationExpr.prototype.evaluate = function(ctx) {
<a name="l879"><span class="linenum"> 879</span></a>    var start;
<a name="l880"><span class="linenum"> 880</span></a>    if (this.absolute) {
<a name="l881"><span class="linenum"> 881</span></a>      start = ctx.root;
<a name="l882"><span class="linenum"> 882</span></a>  
<a name="l883"><span class="linenum"> 883</span></a>    } else {
<a name="l884"><span class="linenum"> 884</span></a>      start = ctx.node;
<a name="l885"><span class="linenum"> 885</span></a>    }
<a name="l886"><span class="linenum"> 886</span></a>  
<a name="l887"><span class="linenum"> 887</span></a>    var nodes = [];
<a name="l888"><span class="linenum"> 888</span></a>    <a class="function" onClick="logFunction('xPathStep')" href="../../_functions/xpathstep.html" onMouseOver="funcPopup(event,'xpathstep')">xPathStep</a>(nodes, this.steps, 0, start, ctx);
<a name="l889"><span class="linenum"> 889</span></a>    return new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(nodes);
<a name="l890"><span class="linenum"> 890</span></a>  };
<a name="l891"><span class="linenum"> 891</span></a>  
<a name="l892"><span class="linenum"> 892</span></a>  function <a class="function" onClick="logFunction('xPathStep')" href="../../_functions/xpathstep.html" onMouseOver="funcPopup(event,'xpathstep')">xPathStep</a>(nodes, steps, step, input, ctx) {
<a name="l893"><span class="linenum"> 893</span></a>    var s = steps[step];
<a name="l894"><span class="linenum"> 894</span></a>    var ctx2 = ctx.<a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(input);
<a name="l895"><span class="linenum"> 895</span></a>    var nodelist = s.evaluate(ctx2).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l896"><span class="linenum"> 896</span></a>  
<a name="l897"><span class="linenum"> 897</span></a>    for (var i = 0; i &lt; nodelist.length; ++i) {
<a name="l898"><span class="linenum"> 898</span></a>      if (step == steps.length - 1) {
<a name="l899"><span class="linenum"> 899</span></a>        nodes.push(nodelist[i]);
<a name="l900"><span class="linenum"> 900</span></a>      } else {
<a name="l901"><span class="linenum"> 901</span></a>        <a class="function" onClick="logFunction('xPathStep')" href="../../_functions/xpathstep.html" onMouseOver="funcPopup(event,'xpathstep')">xPathStep</a>(nodes, steps, step + 1, nodelist[i], ctx);
<a name="l902"><span class="linenum"> 902</span></a>      }
<a name="l903"><span class="linenum"> 903</span></a>    }
<a name="l904"><span class="linenum"> 904</span></a>  }
<a name="l905"><span class="linenum"> 905</span></a>  
<a name="l906"><span class="linenum"> 906</span></a>  function <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>(axis, nodetest, opt_predicate) {
<a name="l907"><span class="linenum"> 907</span></a>    this.axis = axis;
<a name="l908"><span class="linenum"> 908</span></a>    this.nodetest = nodetest;
<a name="l909"><span class="linenum"> 909</span></a>    this.predicate = opt_predicate || [];
<a name="l910"><span class="linenum"> 910</span></a>  }
<a name="l911"><span class="linenum"> 911</span></a>  
<a name="l912"><span class="linenum"> 912</span></a>  StepExpr.prototype.appendPredicate = function(p) {
<a name="l913"><span class="linenum"> 913</span></a>    this.predicate.push(p);
<a name="l914"><span class="linenum"> 914</span></a>  };
<a name="l915"><span class="linenum"> 915</span></a>  
<a name="l916"><span class="linenum"> 916</span></a>  StepExpr.prototype.evaluate = function(ctx) {
<a name="l917"><span class="linenum"> 917</span></a>    var input = ctx.node;
<a name="l918"><span class="linenum"> 918</span></a>    var nodelist = [];
<a name="l919"><span class="linenum"> 919</span></a>  
<a name="l920"><span class="linenum"> 920</span></a>  <span class="comment">  // NOTE(mesch): When this was a switch() statement, it didn't work</span>
<a name="l921"><span class="linenum"> 921</span></a>  <span class="comment">  // in Safari/2.0. Not sure why though; it resulted in the JavaScript</span>
<a name="l922"><span class="linenum"> 922</span></a>  <span class="comment">  // console output &quot;undefined&quot; (without any line number or so).</span>
<a name="l923"><span class="linenum"> 923</span></a>  
<a name="l924"><span class="linenum"> 924</span></a>    if (this.axis ==  xpathAxis.ANCESTOR_OR_SELF) {
<a name="l925"><span class="linenum"> 925</span></a>      nodelist.push(input);
<a name="l926"><span class="linenum"> 926</span></a>      for (var n = input.parentNode; n; n = n.parentNode) {
<a name="l927"><span class="linenum"> 927</span></a>        nodelist.push(n);
<a name="l928"><span class="linenum"> 928</span></a>      }
<a name="l929"><span class="linenum"> 929</span></a>  
<a name="l930"><span class="linenum"> 930</span></a>    } else if (this.axis == xpathAxis.ANCESTOR) {
<a name="l931"><span class="linenum"> 931</span></a>      for (var n = input.parentNode; n; n = n.parentNode) {
<a name="l932"><span class="linenum"> 932</span></a>        nodelist.push(n);
<a name="l933"><span class="linenum"> 933</span></a>      }
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>    } else if (this.axis == xpathAxis.ATTRIBUTE) {
<a name="l936"><span class="linenum"> 936</span></a>      <a class="function" onClick="logFunction('copyArray')" href="../../_functions/copyarray.html" onMouseOver="funcPopup(event,'copyarray')">copyArray</a>(nodelist, input.attributes);
<a name="l937"><span class="linenum"> 937</span></a>  
<a name="l938"><span class="linenum"> 938</span></a>    } else if (this.axis == xpathAxis.CHILD) {
<a name="l939"><span class="linenum"> 939</span></a>      <a class="function" onClick="logFunction('copyArray')" href="../../_functions/copyarray.html" onMouseOver="funcPopup(event,'copyarray')">copyArray</a>(nodelist, input.childNodes);
<a name="l940"><span class="linenum"> 940</span></a>  
<a name="l941"><span class="linenum"> 941</span></a>    } else if (this.axis == xpathAxis.DESCENDANT_OR_SELF) {
<a name="l942"><span class="linenum"> 942</span></a>      nodelist.push(input);
<a name="l943"><span class="linenum"> 943</span></a>      <a class="function" onClick="logFunction('xpathCollectDescendants')" href="../../_functions/xpathcollectdescendants.html" onMouseOver="funcPopup(event,'xpathcollectdescendants')">xpathCollectDescendants</a>(nodelist, input);
<a name="l944"><span class="linenum"> 944</span></a>  
<a name="l945"><span class="linenum"> 945</span></a>    } else if (this.axis == xpathAxis.DESCENDANT) {
<a name="l946"><span class="linenum"> 946</span></a>      <a class="function" onClick="logFunction('xpathCollectDescendants')" href="../../_functions/xpathcollectdescendants.html" onMouseOver="funcPopup(event,'xpathcollectdescendants')">xpathCollectDescendants</a>(nodelist, input);
<a name="l947"><span class="linenum"> 947</span></a>  
<a name="l948"><span class="linenum"> 948</span></a>    } else if (this.axis == xpathAxis.FOLLOWING) {
<a name="l949"><span class="linenum"> 949</span></a>      for (var n = input; n; n = n.parentNode) {
<a name="l950"><span class="linenum"> 950</span></a>        for (var nn = n.nextSibling; nn; nn = nn.nextSibling) {
<a name="l951"><span class="linenum"> 951</span></a>          nodelist.push(nn);
<a name="l952"><span class="linenum"> 952</span></a>          <a class="function" onClick="logFunction('xpathCollectDescendants')" href="../../_functions/xpathcollectdescendants.html" onMouseOver="funcPopup(event,'xpathcollectdescendants')">xpathCollectDescendants</a>(nodelist, nn);
<a name="l953"><span class="linenum"> 953</span></a>        }
<a name="l954"><span class="linenum"> 954</span></a>      }
<a name="l955"><span class="linenum"> 955</span></a>  
<a name="l956"><span class="linenum"> 956</span></a>    } else if (this.axis == xpathAxis.FOLLOWING_SIBLING) {
<a name="l957"><span class="linenum"> 957</span></a>      for (var n = input.nextSibling; n; n = n.nextSibling) {
<a name="l958"><span class="linenum"> 958</span></a>        nodelist.push(n);
<a name="l959"><span class="linenum"> 959</span></a>      }
<a name="l960"><span class="linenum"> 960</span></a>  
<a name="l961"><span class="linenum"> 961</span></a>    } else if (this.axis == xpathAxis.NAMESPACE) {
<a name="l962"><span class="linenum"> 962</span></a>      alert('not implemented: axis namespace');
<a name="l963"><span class="linenum"> 963</span></a>  
<a name="l964"><span class="linenum"> 964</span></a>    } else if (this.axis == xpathAxis.PARENT) {
<a name="l965"><span class="linenum"> 965</span></a>      if (input.parentNode) {
<a name="l966"><span class="linenum"> 966</span></a>        nodelist.push(input.parentNode);
<a name="l967"><span class="linenum"> 967</span></a>      }
<a name="l968"><span class="linenum"> 968</span></a>  
<a name="l969"><span class="linenum"> 969</span></a>    } else if (this.axis == xpathAxis.PRECEDING) {
<a name="l970"><span class="linenum"> 970</span></a>      for (var n = input; n; n = n.parentNode) {
<a name="l971"><span class="linenum"> 971</span></a>        for (var nn = n.previousSibling; nn; nn = nn.previousSibling) {
<a name="l972"><span class="linenum"> 972</span></a>          nodelist.push(nn);
<a name="l973"><span class="linenum"> 973</span></a>          <a class="function" onClick="logFunction('xpathCollectDescendantsReverse')" href="../../_functions/xpathcollectdescendantsreverse.html" onMouseOver="funcPopup(event,'xpathcollectdescendantsreverse')">xpathCollectDescendantsReverse</a>(nodelist, nn);
<a name="l974"><span class="linenum"> 974</span></a>        }
<a name="l975"><span class="linenum"> 975</span></a>      }
<a name="l976"><span class="linenum"> 976</span></a>  
<a name="l977"><span class="linenum"> 977</span></a>    } else if (this.axis == xpathAxis.PRECEDING_SIBLING) {
<a name="l978"><span class="linenum"> 978</span></a>      for (var n = input.previousSibling; n; n = n.previousSibling) {
<a name="l979"><span class="linenum"> 979</span></a>        nodelist.push(n);
<a name="l980"><span class="linenum"> 980</span></a>      }
<a name="l981"><span class="linenum"> 981</span></a>  
<a name="l982"><span class="linenum"> 982</span></a>    } else if (this.axis == xpathAxis.SELF) {
<a name="l983"><span class="linenum"> 983</span></a>      nodelist.push(input);
<a name="l984"><span class="linenum"> 984</span></a>  
<a name="l985"><span class="linenum"> 985</span></a>    } else {
<a name="l986"><span class="linenum"> 986</span></a>      throw 'ERROR -- NO SUCH AXIS: ' + this.axis;
<a name="l987"><span class="linenum"> 987</span></a>    }
<a name="l988"><span class="linenum"> 988</span></a>  
<a name="l989"><span class="linenum"> 989</span></a>  <span class="comment">  // process node test</span>
<a name="l990"><span class="linenum"> 990</span></a>    var nodelist0 = nodelist;
<a name="l991"><span class="linenum"> 991</span></a>    nodelist = [];
<a name="l992"><span class="linenum"> 992</span></a>    for (var i = 0; i &lt; nodelist0.length; ++i) {
<a name="l993"><span class="linenum"> 993</span></a>      var n = nodelist0[i];
<a name="l994"><span class="linenum"> 994</span></a>      if (this.nodetest.evaluate(ctx.<a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(n, i, nodelist0)).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>()) {
<a name="l995"><span class="linenum"> 995</span></a>        nodelist.push(n);
<a name="l996"><span class="linenum"> 996</span></a>      }
<a name="l997"><span class="linenum"> 997</span></a>    }
<a name="l998"><span class="linenum"> 998</span></a>  
<a name="l999"><span class="linenum"> 999</span></a>  <span class="comment">  // process predicates</span>
<a name="l1000"><span class="linenum">1000</span></a>    for (var i = 0; i &lt; this.predicate.length; ++i) {
<a name="l1001"><span class="linenum">1001</span></a>      var nodelist0 = nodelist;
<a name="l1002"><span class="linenum">1002</span></a>      nodelist = [];
<a name="l1003"><span class="linenum">1003</span></a>      for (var ii = 0; ii &lt; nodelist0.length; ++ii) {
<a name="l1004"><span class="linenum">1004</span></a>        var n = nodelist0[ii];
<a name="l1005"><span class="linenum">1005</span></a>        if (this.predicate[i].evaluate(ctx.<a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(n, ii, nodelist0)).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>()) {
<a name="l1006"><span class="linenum">1006</span></a>          nodelist.push(n);
<a name="l1007"><span class="linenum">1007</span></a>        }
<a name="l1008"><span class="linenum">1008</span></a>      }
<a name="l1009"><span class="linenum">1009</span></a>    }
<a name="l1010"><span class="linenum">1010</span></a>  
<a name="l1011"><span class="linenum">1011</span></a>    return new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(nodelist);
<a name="l1012"><span class="linenum">1012</span></a>  };
<a name="l1013"><span class="linenum">1013</span></a>  
<a name="l1014"><span class="linenum">1014</span></a>  function <a class="function" onClick="logFunction('NodeTestAny')" href="../../_functions/nodetestany.html" onMouseOver="funcPopup(event,'nodetestany')">NodeTestAny</a>() {
<a name="l1015"><span class="linenum">1015</span></a>    this.value = new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(true);
<a name="l1016"><span class="linenum">1016</span></a>  }
<a name="l1017"><span class="linenum">1017</span></a>  
<a name="l1018"><span class="linenum">1018</span></a>  NodeTestAny.prototype.evaluate = function(ctx) {
<a name="l1019"><span class="linenum">1019</span></a>    return this.value;
<a name="l1020"><span class="linenum">1020</span></a>  };
<a name="l1021"><span class="linenum">1021</span></a>  
<a name="l1022"><span class="linenum">1022</span></a>  function <a class="function" onClick="logFunction('NodeTestElementOrAttribute')" href="../../_functions/nodetestelementorattribute.html" onMouseOver="funcPopup(event,'nodetestelementorattribute')">NodeTestElementOrAttribute</a>() {}
<a name="l1023"><span class="linenum">1023</span></a>  
<a name="l1024"><span class="linenum">1024</span></a>  NodeTestElementOrAttribute.prototype.evaluate = function(ctx) {
<a name="l1025"><span class="linenum">1025</span></a>    return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(
<a name="l1026"><span class="linenum">1026</span></a>        ctx.node.nodeType == DOM_ELEMENT_NODE ||
<a name="l1027"><span class="linenum">1027</span></a>        ctx.node.nodeType == DOM_ATTRIBUTE_NODE);
<a name="l1028"><span class="linenum">1028</span></a>  };
<a name="l1029"><span class="linenum">1029</span></a>  
<a name="l1030"><span class="linenum">1030</span></a>  function <a class="function" onClick="logFunction('NodeTestText')" href="../../_functions/nodetesttext.html" onMouseOver="funcPopup(event,'nodetesttext')">NodeTestText</a>() {}
<a name="l1031"><span class="linenum">1031</span></a>  
<a name="l1032"><span class="linenum">1032</span></a>  NodeTestText.prototype.evaluate = function(ctx) {
<a name="l1033"><span class="linenum">1033</span></a>    return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(ctx.node.nodeType == DOM_TEXT_NODE);
<a name="l1034"><span class="linenum">1034</span></a>  };
<a name="l1035"><span class="linenum">1035</span></a>  
<a name="l1036"><span class="linenum">1036</span></a>  function <a class="function" onClick="logFunction('NodeTestComment')" href="../../_functions/nodetestcomment.html" onMouseOver="funcPopup(event,'nodetestcomment')">NodeTestComment</a>() {}
<a name="l1037"><span class="linenum">1037</span></a>  
<a name="l1038"><span class="linenum">1038</span></a>  NodeTestComment.prototype.evaluate = function(ctx) {
<a name="l1039"><span class="linenum">1039</span></a>    return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(ctx.node.nodeType == DOM_COMMENT_NODE);
<a name="l1040"><span class="linenum">1040</span></a>  };
<a name="l1041"><span class="linenum">1041</span></a>  
<a name="l1042"><span class="linenum">1042</span></a>  function <a class="function" onClick="logFunction('NodeTestPI')" href="../../_functions/nodetestpi.html" onMouseOver="funcPopup(event,'nodetestpi')">NodeTestPI</a>(target) {
<a name="l1043"><span class="linenum">1043</span></a>    this.target = target;
<a name="l1044"><span class="linenum">1044</span></a>  }
<a name="l1045"><span class="linenum">1045</span></a>  
<a name="l1046"><span class="linenum">1046</span></a>  NodeTestPI.prototype.evaluate = function(ctx) {
<a name="l1047"><span class="linenum">1047</span></a>    return new
<a name="l1048"><span class="linenum">1048</span></a>    <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(ctx.node.nodeType == DOM_PROCESSING_INSTRUCTION_NODE &amp;&amp;
<a name="l1049"><span class="linenum">1049</span></a>                 (!this.target || ctx.node.nodeName == this.target));
<a name="l1050"><span class="linenum">1050</span></a>  };
<a name="l1051"><span class="linenum">1051</span></a>  
<a name="l1052"><span class="linenum">1052</span></a>  function <a class="function" onClick="logFunction('NodeTestNC')" href="../../_functions/nodetestnc.html" onMouseOver="funcPopup(event,'nodetestnc')">NodeTestNC</a>(nsprefix) {
<a name="l1053"><span class="linenum">1053</span></a>    this.regex = new RegExp(&quot;^&quot; + nsprefix + &quot;:&quot;);
<a name="l1054"><span class="linenum">1054</span></a>    this.nsprefix = nsprefix;
<a name="l1055"><span class="linenum">1055</span></a>  }
<a name="l1056"><span class="linenum">1056</span></a>  
<a name="l1057"><span class="linenum">1057</span></a>  NodeTestNC.prototype.evaluate = function(ctx) {
<a name="l1058"><span class="linenum">1058</span></a>    var n = ctx.node;
<a name="l1059"><span class="linenum">1059</span></a>    return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(this.regex.match(n.nodeName));
<a name="l1060"><span class="linenum">1060</span></a>  };
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>  function <a class="function" onClick="logFunction('NodeTestName')" href="../../_functions/nodetestname.html" onMouseOver="funcPopup(event,'nodetestname')">NodeTestName</a>(name) {
<a name="l1063"><span class="linenum">1063</span></a>    this.name = name;
<a name="l1064"><span class="linenum">1064</span></a>  }
<a name="l1065"><span class="linenum">1065</span></a>  
<a name="l1066"><span class="linenum">1066</span></a>  NodeTestName.prototype.evaluate = function(ctx) {
<a name="l1067"><span class="linenum">1067</span></a>    var n = ctx.node;
<a name="l1068"><span class="linenum">1068</span></a>    return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(n.nodeName == this.name);
<a name="l1069"><span class="linenum">1069</span></a>  };
<a name="l1070"><span class="linenum">1070</span></a>  
<a name="l1071"><span class="linenum">1071</span></a>  function <a class="function" onClick="logFunction('PredicateExpr')" href="../../_functions/predicateexpr.html" onMouseOver="funcPopup(event,'predicateexpr')">PredicateExpr</a>(expr) {
<a name="l1072"><span class="linenum">1072</span></a>    this.expr = expr;
<a name="l1073"><span class="linenum">1073</span></a>  }
<a name="l1074"><span class="linenum">1074</span></a>  
<a name="l1075"><span class="linenum">1075</span></a>  PredicateExpr.prototype.evaluate = function(ctx) {
<a name="l1076"><span class="linenum">1076</span></a>    var v = this.expr.evaluate(ctx);
<a name="l1077"><span class="linenum">1077</span></a>    if (v.type == 'number') {
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">    // NOTE(mesch): Internally, position is represented starting with</span>
<a name="l1079"><span class="linenum">1079</span></a>  <span class="comment">    // 0, however in XPath position starts with 1. See functions</span>
<a name="l1080"><span class="linenum">1080</span></a>  <span class="comment">    // position() and last().</span>
<a name="l1081"><span class="linenum">1081</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(ctx.position == v.<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>() - 1);
<a name="l1082"><span class="linenum">1082</span></a>    } else {
<a name="l1083"><span class="linenum">1083</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(v.<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>());
<a name="l1084"><span class="linenum">1084</span></a>    }
<a name="l1085"><span class="linenum">1085</span></a>  };
<a name="l1086"><span class="linenum">1086</span></a>  
<a name="l1087"><span class="linenum">1087</span></a>  function <a class="function" onClick="logFunction('FunctionCallExpr')" href="../../_functions/functioncallexpr.html" onMouseOver="funcPopup(event,'functioncallexpr')">FunctionCallExpr</a>(name) {
<a name="l1088"><span class="linenum">1088</span></a>    this.name = name;
<a name="l1089"><span class="linenum">1089</span></a>    this.args = [];
<a name="l1090"><span class="linenum">1090</span></a>  }
<a name="l1091"><span class="linenum">1091</span></a>  
<a name="l1092"><span class="linenum">1092</span></a>  FunctionCallExpr.prototype.appendArg = function(arg) {
<a name="l1093"><span class="linenum">1093</span></a>    this.args.push(arg);
<a name="l1094"><span class="linenum">1094</span></a>  };
<a name="l1095"><span class="linenum">1095</span></a>  
<a name="l1096"><span class="linenum">1096</span></a>  FunctionCallExpr.prototype.evaluate = function(ctx) {
<a name="l1097"><span class="linenum">1097</span></a>    var fn = '' + this.name.value;
<a name="l1098"><span class="linenum">1098</span></a>    var f = this.xpathfunctions[fn];
<a name="l1099"><span class="linenum">1099</span></a>    if (f) {
<a name="l1100"><span class="linenum">1100</span></a>      return f.call(this, ctx);
<a name="l1101"><span class="linenum">1101</span></a>    } else {
<a name="l1102"><span class="linenum">1102</span></a>      <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('XPath NO SUCH FUNCTION ' + fn);
<a name="l1103"><span class="linenum">1103</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(false);
<a name="l1104"><span class="linenum">1104</span></a>    }
<a name="l1105"><span class="linenum">1105</span></a>  };
<a name="l1106"><span class="linenum">1106</span></a>  
<a name="l1107"><span class="linenum">1107</span></a>  FunctionCallExpr.prototype.xpathfunctions = {
<a name="l1108"><span class="linenum">1108</span></a>    'last': function(ctx) {
<a name="l1109"><span class="linenum">1109</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 0);
<a name="l1110"><span class="linenum">1110</span></a>  <span class="comment">    // NOTE(mesch): XPath position starts at 1.</span>
<a name="l1111"><span class="linenum">1111</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(ctx.contextSize());
<a name="l1112"><span class="linenum">1112</span></a>    },
<a name="l1113"><span class="linenum">1113</span></a>  
<a name="l1114"><span class="linenum">1114</span></a>    'position': function(ctx) {
<a name="l1115"><span class="linenum">1115</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 0);
<a name="l1116"><span class="linenum">1116</span></a>  <span class="comment">    // NOTE(mesch): XPath position starts at 1.</span>
<a name="l1117"><span class="linenum">1117</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(ctx.position + 1);
<a name="l1118"><span class="linenum">1118</span></a>    },
<a name="l1119"><span class="linenum">1119</span></a>  
<a name="l1120"><span class="linenum">1120</span></a>    'count': function(ctx) {
<a name="l1121"><span class="linenum">1121</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1122"><span class="linenum">1122</span></a>      var v = this.args[0].evaluate(ctx);
<a name="l1123"><span class="linenum">1123</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(v.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>().length);
<a name="l1124"><span class="linenum">1124</span></a>    },
<a name="l1125"><span class="linenum">1125</span></a>  
<a name="l1126"><span class="linenum">1126</span></a>    'id': function(ctx) {
<a name="l1127"><span class="linenum">1127</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1128"><span class="linenum">1128</span></a>      var e = this.args[0].evaluate(ctx);
<a name="l1129"><span class="linenum">1129</span></a>      var ret = [];
<a name="l1130"><span class="linenum">1130</span></a>      var ids;
<a name="l1131"><span class="linenum">1131</span></a>      if (e.type == 'node-set') {
<a name="l1132"><span class="linenum">1132</span></a>        ids = [];
<a name="l1133"><span class="linenum">1133</span></a>        var en = e.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1134"><span class="linenum">1134</span></a>        for (var i = 0; i &lt; en.length; ++i) {
<a name="l1135"><span class="linenum">1135</span></a>          var v = <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(en[i]).<a class="phpfunction" onClick="logFunction('split')" href="../../_functions/split.html" onMouseOver="phpfuncPopup(event,'split')">split</a>(/\s+/);
<a name="l1136"><span class="linenum">1136</span></a>          for (var ii = 0; ii &lt; v.length; ++ii) {
<a name="l1137"><span class="linenum">1137</span></a>            ids.push(v[ii]);
<a name="l1138"><span class="linenum">1138</span></a>          }
<a name="l1139"><span class="linenum">1139</span></a>        }
<a name="l1140"><span class="linenum">1140</span></a>      } else {
<a name="l1141"><span class="linenum">1141</span></a>        ids = e.<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>().<a class="phpfunction" onClick="logFunction('split')" href="../../_functions/split.html" onMouseOver="phpfuncPopup(event,'split')">split</a>(/\s+/);
<a name="l1142"><span class="linenum">1142</span></a>      }
<a name="l1143"><span class="linenum">1143</span></a>      var d = ctx.node.ownerDocument;
<a name="l1144"><span class="linenum">1144</span></a>      for (var i = 0; i &lt; ids.length; ++i) {
<a name="l1145"><span class="linenum">1145</span></a>        var n = d.getElementById(ids[i]);
<a name="l1146"><span class="linenum">1146</span></a>        if (n) {
<a name="l1147"><span class="linenum">1147</span></a>          ret.push(n);
<a name="l1148"><span class="linenum">1148</span></a>        }
<a name="l1149"><span class="linenum">1149</span></a>      }
<a name="l1150"><span class="linenum">1150</span></a>      return new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(ret);
<a name="l1151"><span class="linenum">1151</span></a>    },
<a name="l1152"><span class="linenum">1152</span></a>  
<a name="l1153"><span class="linenum">1153</span></a>    'local-name': function(ctx) {
<a name="l1154"><span class="linenum">1154</span></a>      alert('not implmented yet: XPath function local-<a class="phpfunction" onClick="logFunction('name')" href="../../_functions/name.html" onMouseOver="phpfuncPopup(event,'name')">name</a>()');
<a name="l1155"><span class="linenum">1155</span></a>    },
<a name="l1156"><span class="linenum">1156</span></a>  
<a name="l1157"><span class="linenum">1157</span></a>    'namespace-uri': function(ctx) {
<a name="l1158"><span class="linenum">1158</span></a>      alert('not implmented yet: XPath function namespace-uri()');
<a name="l1159"><span class="linenum">1159</span></a>    },
<a name="l1160"><span class="linenum">1160</span></a>  
<a name="l1161"><span class="linenum">1161</span></a>    'name': function(ctx) {
<a name="l1162"><span class="linenum">1162</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1 || this.args.length == 0);
<a name="l1163"><span class="linenum">1163</span></a>      var n;
<a name="l1164"><span class="linenum">1164</span></a>      if (this.args.length == 0) {
<a name="l1165"><span class="linenum">1165</span></a>        n = [ ctx.node ];
<a name="l1166"><span class="linenum">1166</span></a>      } else {
<a name="l1167"><span class="linenum">1167</span></a>        n = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1168"><span class="linenum">1168</span></a>      }
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>      if (n.length == 0) {
<a name="l1171"><span class="linenum">1171</span></a>        return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>('');
<a name="l1172"><span class="linenum">1172</span></a>      } else {
<a name="l1173"><span class="linenum">1173</span></a>        return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(n[0].nodeName);
<a name="l1174"><span class="linenum">1174</span></a>      }
<a name="l1175"><span class="linenum">1175</span></a>    },
<a name="l1176"><span class="linenum">1176</span></a>  
<a name="l1177"><span class="linenum">1177</span></a>    'string':  function(ctx) {
<a name="l1178"><span class="linenum">1178</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1 || this.args.length == 0);
<a name="l1179"><span class="linenum">1179</span></a>      if (this.args.length == 0) {
<a name="l1180"><span class="linenum">1180</span></a>        return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>([ ctx.node ]).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>());
<a name="l1181"><span class="linenum">1181</span></a>      } else {
<a name="l1182"><span class="linenum">1182</span></a>        return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>());
<a name="l1183"><span class="linenum">1183</span></a>      }
<a name="l1184"><span class="linenum">1184</span></a>    },
<a name="l1185"><span class="linenum">1185</span></a>  
<a name="l1186"><span class="linenum">1186</span></a>    'concat': function(ctx) {
<a name="l1187"><span class="linenum">1187</span></a>      var ret = '';
<a name="l1188"><span class="linenum">1188</span></a>      for (var i = 0; i &lt; this.args.length; ++i) {
<a name="l1189"><span class="linenum">1189</span></a>        ret += this.args[i].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1190"><span class="linenum">1190</span></a>      }
<a name="l1191"><span class="linenum">1191</span></a>      return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(ret);
<a name="l1192"><span class="linenum">1192</span></a>    },
<a name="l1193"><span class="linenum">1193</span></a>  
<a name="l1194"><span class="linenum">1194</span></a>    'starts-with': function(ctx) {
<a name="l1195"><span class="linenum">1195</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 2);
<a name="l1196"><span class="linenum">1196</span></a>      var s0 = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1197"><span class="linenum">1197</span></a>      var s1 = this.args[1].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1198"><span class="linenum">1198</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(s0.indexOf(s1) == 0);
<a name="l1199"><span class="linenum">1199</span></a>    },
<a name="l1200"><span class="linenum">1200</span></a>  
<a name="l1201"><span class="linenum">1201</span></a>    'contains': function(ctx) {
<a name="l1202"><span class="linenum">1202</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 2);
<a name="l1203"><span class="linenum">1203</span></a>      var s0 = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1204"><span class="linenum">1204</span></a>      var s1 = this.args[1].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1205"><span class="linenum">1205</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(s0.indexOf(s1) != -1);
<a name="l1206"><span class="linenum">1206</span></a>    },
<a name="l1207"><span class="linenum">1207</span></a>  
<a name="l1208"><span class="linenum">1208</span></a>    'substring-before': function(ctx) {
<a name="l1209"><span class="linenum">1209</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 2);
<a name="l1210"><span class="linenum">1210</span></a>      var s0 = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1211"><span class="linenum">1211</span></a>      var s1 = this.args[1].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1212"><span class="linenum">1212</span></a>      var i = s0.indexOf(s1);
<a name="l1213"><span class="linenum">1213</span></a>      var ret;
<a name="l1214"><span class="linenum">1214</span></a>      if (i == -1) {
<a name="l1215"><span class="linenum">1215</span></a>        ret = '';
<a name="l1216"><span class="linenum">1216</span></a>      } else {
<a name="l1217"><span class="linenum">1217</span></a>        ret = s0.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(0,i);
<a name="l1218"><span class="linenum">1218</span></a>      }
<a name="l1219"><span class="linenum">1219</span></a>      return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(ret);
<a name="l1220"><span class="linenum">1220</span></a>    },
<a name="l1221"><span class="linenum">1221</span></a>  
<a name="l1222"><span class="linenum">1222</span></a>    'substring-after': function(ctx) {
<a name="l1223"><span class="linenum">1223</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 2);
<a name="l1224"><span class="linenum">1224</span></a>      var s0 = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1225"><span class="linenum">1225</span></a>      var s1 = this.args[1].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1226"><span class="linenum">1226</span></a>      var i = s0.indexOf(s1);
<a name="l1227"><span class="linenum">1227</span></a>      var ret;
<a name="l1228"><span class="linenum">1228</span></a>      if (i == -1) {
<a name="l1229"><span class="linenum">1229</span></a>        ret = '';
<a name="l1230"><span class="linenum">1230</span></a>      } else {
<a name="l1231"><span class="linenum">1231</span></a>        ret = s0.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(i + s1.length);
<a name="l1232"><span class="linenum">1232</span></a>      }
<a name="l1233"><span class="linenum">1233</span></a>      return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(ret);
<a name="l1234"><span class="linenum">1234</span></a>    },
<a name="l1235"><span class="linenum">1235</span></a>  
<a name="l1236"><span class="linenum">1236</span></a>    'substring': function(ctx) {
<a name="l1237"><span class="linenum">1237</span></a>  <span class="comment">    // NOTE: XPath defines the position of the first character in a</span>
<a name="l1238"><span class="linenum">1238</span></a>  <span class="comment">    // string to be 1, in JavaScript this is 0 ([XPATH] Section 4.2).</span>
<a name="l1239"><span class="linenum">1239</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 2 || this.args.length == 3);
<a name="l1240"><span class="linenum">1240</span></a>      var s0 = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1241"><span class="linenum">1241</span></a>      var s1 = this.args[1].evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1242"><span class="linenum">1242</span></a>      var ret;
<a name="l1243"><span class="linenum">1243</span></a>      if (this.args.length == 2) {
<a name="l1244"><span class="linenum">1244</span></a>        var i1 = Math.<a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(0, Math.<a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(s1) - 1);
<a name="l1245"><span class="linenum">1245</span></a>        ret = s0.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(i1);
<a name="l1246"><span class="linenum">1246</span></a>  
<a name="l1247"><span class="linenum">1247</span></a>      } else {
<a name="l1248"><span class="linenum">1248</span></a>        var s2 = this.args[2].evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1249"><span class="linenum">1249</span></a>        var i0 = Math.<a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(s1) - 1;
<a name="l1250"><span class="linenum">1250</span></a>        var i1 = Math.<a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(0, i0);
<a name="l1251"><span class="linenum">1251</span></a>        var i2 = Math.<a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(s2) - Math.<a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(0, -i0);
<a name="l1252"><span class="linenum">1252</span></a>        ret = s0.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(i1, i2);
<a name="l1253"><span class="linenum">1253</span></a>      }
<a name="l1254"><span class="linenum">1254</span></a>      return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(ret);
<a name="l1255"><span class="linenum">1255</span></a>    },
<a name="l1256"><span class="linenum">1256</span></a>  
<a name="l1257"><span class="linenum">1257</span></a>    'string-length': function(ctx) {
<a name="l1258"><span class="linenum">1258</span></a>      var s;
<a name="l1259"><span class="linenum">1259</span></a>      if (this.args.length &gt; 0) {
<a name="l1260"><span class="linenum">1260</span></a>        s = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1261"><span class="linenum">1261</span></a>      } else {
<a name="l1262"><span class="linenum">1262</span></a>        s = new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>([ ctx.node ]).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1263"><span class="linenum">1263</span></a>      }
<a name="l1264"><span class="linenum">1264</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(s.length);
<a name="l1265"><span class="linenum">1265</span></a>    },
<a name="l1266"><span class="linenum">1266</span></a>  
<a name="l1267"><span class="linenum">1267</span></a>    'normalize-space': function(ctx) {
<a name="l1268"><span class="linenum">1268</span></a>      var s;
<a name="l1269"><span class="linenum">1269</span></a>      if (this.args.length &gt; 0) {
<a name="l1270"><span class="linenum">1270</span></a>        s = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1271"><span class="linenum">1271</span></a>      } else {
<a name="l1272"><span class="linenum">1272</span></a>        s = new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>([ ctx.node ]).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1273"><span class="linenum">1273</span></a>      }
<a name="l1274"><span class="linenum">1274</span></a>      s = s.replace(/^\s*/,'').replace(/\s*$/,'').replace(/\s+/g, ' ');
<a name="l1275"><span class="linenum">1275</span></a>      return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(s);
<a name="l1276"><span class="linenum">1276</span></a>    },
<a name="l1277"><span class="linenum">1277</span></a>  
<a name="l1278"><span class="linenum">1278</span></a>    'translate': function(ctx) {
<a name="l1279"><span class="linenum">1279</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 3);
<a name="l1280"><span class="linenum">1280</span></a>      var s0 = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1281"><span class="linenum">1281</span></a>      var s1 = this.args[1].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1282"><span class="linenum">1282</span></a>      var s2 = this.args[2].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1283"><span class="linenum">1283</span></a>  
<a name="l1284"><span class="linenum">1284</span></a>      for (var i = 0; i &lt; s1.length; ++i) {
<a name="l1285"><span class="linenum">1285</span></a>        s0 = s0.replace(new RegExp(s1.charAt(i), 'g'), s2.charAt(i));
<a name="l1286"><span class="linenum">1286</span></a>      }
<a name="l1287"><span class="linenum">1287</span></a>      return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(s0);
<a name="l1288"><span class="linenum">1288</span></a>    },
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>    'boolean': function(ctx) {
<a name="l1291"><span class="linenum">1291</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1292"><span class="linenum">1292</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>());
<a name="l1293"><span class="linenum">1293</span></a>    },
<a name="l1294"><span class="linenum">1294</span></a>  
<a name="l1295"><span class="linenum">1295</span></a>    'not': function(ctx) {
<a name="l1296"><span class="linenum">1296</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1297"><span class="linenum">1297</span></a>      var ret = !this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>();
<a name="l1298"><span class="linenum">1298</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(ret);
<a name="l1299"><span class="linenum">1299</span></a>    },
<a name="l1300"><span class="linenum">1300</span></a>  
<a name="l1301"><span class="linenum">1301</span></a>    'true': function(ctx) {
<a name="l1302"><span class="linenum">1302</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 0);
<a name="l1303"><span class="linenum">1303</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(true);
<a name="l1304"><span class="linenum">1304</span></a>    },
<a name="l1305"><span class="linenum">1305</span></a>  
<a name="l1306"><span class="linenum">1306</span></a>    'false': function(ctx) {
<a name="l1307"><span class="linenum">1307</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 0);
<a name="l1308"><span class="linenum">1308</span></a>      return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(false);
<a name="l1309"><span class="linenum">1309</span></a>    },
<a name="l1310"><span class="linenum">1310</span></a>  
<a name="l1311"><span class="linenum">1311</span></a>    'lang': function(ctx) {
<a name="l1312"><span class="linenum">1312</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1313"><span class="linenum">1313</span></a>      var lang = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1314"><span class="linenum">1314</span></a>      var xmllang;
<a name="l1315"><span class="linenum">1315</span></a>      var n = ctx.node;
<a name="l1316"><span class="linenum">1316</span></a>      while (n &amp;&amp; n != n.parentNode <span class="comment">/* just in case ... */</span>) {
<a name="l1317"><span class="linenum">1317</span></a>        xmllang = n.<a class="function" onClick="logFunction('getAttribute')" href="../../_functions/getattribute.html" onMouseOver="funcPopup(event,'getattribute')">getAttribute</a>('xml:lang');
<a name="l1318"><span class="linenum">1318</span></a>        if (xmllang) {
<a name="l1319"><span class="linenum">1319</span></a>          break;
<a name="l1320"><span class="linenum">1320</span></a>        }
<a name="l1321"><span class="linenum">1321</span></a>        n = n.parentNode;
<a name="l1322"><span class="linenum">1322</span></a>      }
<a name="l1323"><span class="linenum">1323</span></a>      if (!xmllang) {
<a name="l1324"><span class="linenum">1324</span></a>        return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(false);
<a name="l1325"><span class="linenum">1325</span></a>      } else {
<a name="l1326"><span class="linenum">1326</span></a>        var re = new RegExp('^' + lang + '$', 'i');
<a name="l1327"><span class="linenum">1327</span></a>        return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(xmllang.match(re) ||
<a name="l1328"><span class="linenum">1328</span></a>                                xmllang.replace(/_.*$/,'').match(re));
<a name="l1329"><span class="linenum">1329</span></a>      }
<a name="l1330"><span class="linenum">1330</span></a>    },
<a name="l1331"><span class="linenum">1331</span></a>  
<a name="l1332"><span class="linenum">1332</span></a>    'number': function(ctx) {
<a name="l1333"><span class="linenum">1333</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1 || this.args.length == 0);
<a name="l1334"><span class="linenum">1334</span></a>  
<a name="l1335"><span class="linenum">1335</span></a>      if (this.args.length == 1) {
<a name="l1336"><span class="linenum">1336</span></a>        return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1337"><span class="linenum">1337</span></a>      } else {
<a name="l1338"><span class="linenum">1338</span></a>        return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>([ ctx.node ]).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1339"><span class="linenum">1339</span></a>      }
<a name="l1340"><span class="linenum">1340</span></a>    },
<a name="l1341"><span class="linenum">1341</span></a>  
<a name="l1342"><span class="linenum">1342</span></a>    'sum': function(ctx) {
<a name="l1343"><span class="linenum">1343</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1344"><span class="linenum">1344</span></a>      var n = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1345"><span class="linenum">1345</span></a>      var sum = 0;
<a name="l1346"><span class="linenum">1346</span></a>      for (var i = 0; i &lt; n.length; ++i) {
<a name="l1347"><span class="linenum">1347</span></a>        sum += <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(n[i]) - 0;
<a name="l1348"><span class="linenum">1348</span></a>      }
<a name="l1349"><span class="linenum">1349</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(sum);
<a name="l1350"><span class="linenum">1350</span></a>    },
<a name="l1351"><span class="linenum">1351</span></a>  
<a name="l1352"><span class="linenum">1352</span></a>    'floor': function(ctx) {
<a name="l1353"><span class="linenum">1353</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1354"><span class="linenum">1354</span></a>      var num = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1355"><span class="linenum">1355</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(Math.<a class="phpfunction" onClick="logFunction('floor')" href="../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>(num));
<a name="l1356"><span class="linenum">1356</span></a>    },
<a name="l1357"><span class="linenum">1357</span></a>  
<a name="l1358"><span class="linenum">1358</span></a>    'ceiling': function(ctx) {
<a name="l1359"><span class="linenum">1359</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1360"><span class="linenum">1360</span></a>      var num = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1361"><span class="linenum">1361</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(Math.<a class="phpfunction" onClick="logFunction('ceil')" href="../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>(num));
<a name="l1362"><span class="linenum">1362</span></a>    },
<a name="l1363"><span class="linenum">1363</span></a>  
<a name="l1364"><span class="linenum">1364</span></a>    'round': function(ctx) {
<a name="l1365"><span class="linenum">1365</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 1);
<a name="l1366"><span class="linenum">1366</span></a>      var num = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1367"><span class="linenum">1367</span></a>      return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(Math.<a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(num));
<a name="l1368"><span class="linenum">1368</span></a>    },
<a name="l1369"><span class="linenum">1369</span></a>  
<a name="l1370"><span class="linenum">1370</span></a>  <span class="comment">  // TODO(mesch): The following functions are custom. There is a</span>
<a name="l1371"><span class="linenum">1371</span></a>  <span class="comment">  // standard that defines how to add functions, which should be</span>
<a name="l1372"><span class="linenum">1372</span></a>  <span class="comment">  // applied here.</span>
<a name="l1373"><span class="linenum">1373</span></a>  
<a name="l1374"><span class="linenum">1374</span></a>    'ext-join': function(ctx) {
<a name="l1375"><span class="linenum">1375</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 2);
<a name="l1376"><span class="linenum">1376</span></a>      var nodes = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1377"><span class="linenum">1377</span></a>      var delim = this.args[1].evaluate(ctx).<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1378"><span class="linenum">1378</span></a>      var ret = '';
<a name="l1379"><span class="linenum">1379</span></a>      for (var i = 0; i &lt; nodes.length; ++i) {
<a name="l1380"><span class="linenum">1380</span></a>        if (ret) {
<a name="l1381"><span class="linenum">1381</span></a>          ret += delim;
<a name="l1382"><span class="linenum">1382</span></a>        }
<a name="l1383"><span class="linenum">1383</span></a>        ret += <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(nodes[i]);
<a name="l1384"><span class="linenum">1384</span></a>      }
<a name="l1385"><span class="linenum">1385</span></a>      return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(ret);
<a name="l1386"><span class="linenum">1386</span></a>    },
<a name="l1387"><span class="linenum">1387</span></a>  
<a name="l1388"><span class="linenum">1388</span></a>  <span class="comment">  // ext-if() evaluates and returns its second argument, if the</span>
<a name="l1389"><span class="linenum">1389</span></a>  <span class="comment">  // boolean value of its first argument is true, otherwise it</span>
<a name="l1390"><span class="linenum">1390</span></a>  <span class="comment">  // evaluates and returns its third argument.</span>
<a name="l1391"><span class="linenum">1391</span></a>  
<a name="l1392"><span class="linenum">1392</span></a>    'ext-if': function(ctx) {
<a name="l1393"><span class="linenum">1393</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length == 3);
<a name="l1394"><span class="linenum">1394</span></a>      if (this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>()) {
<a name="l1395"><span class="linenum">1395</span></a>        return this.args[1].evaluate(ctx);
<a name="l1396"><span class="linenum">1396</span></a>      } else {
<a name="l1397"><span class="linenum">1397</span></a>        return this.args[2].evaluate(ctx);
<a name="l1398"><span class="linenum">1398</span></a>      }
<a name="l1399"><span class="linenum">1399</span></a>    },
<a name="l1400"><span class="linenum">1400</span></a>  
<a name="l1401"><span class="linenum">1401</span></a>  <span class="comment">  // ext-cardinal() evaluates its single argument as a number, and</span>
<a name="l1402"><span class="linenum">1402</span></a>  <span class="comment">  // returns the current node that many times. It can be used in the</span>
<a name="l1403"><span class="linenum">1403</span></a>  <span class="comment">  // select attribute to iterate over an integer range.</span>
<a name="l1404"><span class="linenum">1404</span></a>  
<a name="l1405"><span class="linenum">1405</span></a>    'ext-cardinal': function(ctx) {
<a name="l1406"><span class="linenum">1406</span></a>      <a class="phpfunction" onClick="logFunction('assert')" href="../../_functions/assert.html" onMouseOver="phpfuncPopup(event,'assert')">assert</a>(this.args.length &gt;= 1);
<a name="l1407"><span class="linenum">1407</span></a>      var c = this.args[0].evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1408"><span class="linenum">1408</span></a>      var ret = [];
<a name="l1409"><span class="linenum">1409</span></a>      for (var i = 0; i &lt; c; ++i) {
<a name="l1410"><span class="linenum">1410</span></a>        ret.push(ctx.node);
<a name="l1411"><span class="linenum">1411</span></a>      }
<a name="l1412"><span class="linenum">1412</span></a>      return new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(ret);
<a name="l1413"><span class="linenum">1413</span></a>    }
<a name="l1414"><span class="linenum">1414</span></a>  };
<a name="l1415"><span class="linenum">1415</span></a>  
<a name="l1416"><span class="linenum">1416</span></a>  function <a class="function" onClick="logFunction('UnionExpr')" href="../../_functions/unionexpr.html" onMouseOver="funcPopup(event,'unionexpr')">UnionExpr</a>(expr1, expr2) {
<a name="l1417"><span class="linenum">1417</span></a>    this.expr1 = expr1;
<a name="l1418"><span class="linenum">1418</span></a>    this.expr2 = expr2;
<a name="l1419"><span class="linenum">1419</span></a>  }
<a name="l1420"><span class="linenum">1420</span></a>  
<a name="l1421"><span class="linenum">1421</span></a>  UnionExpr.prototype.evaluate = function(ctx) {
<a name="l1422"><span class="linenum">1422</span></a>    var nodes1 = this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1423"><span class="linenum">1423</span></a>    var nodes2 = this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1424"><span class="linenum">1424</span></a>    var I1 = nodes1.length;
<a name="l1425"><span class="linenum">1425</span></a>    for (var i2 = 0; i2 &lt; nodes2.length; ++i2) {
<a name="l1426"><span class="linenum">1426</span></a>      var n = nodes2[i2];
<a name="l1427"><span class="linenum">1427</span></a>      var inBoth = false;
<a name="l1428"><span class="linenum">1428</span></a>      for (var i1 = 0; i1 &lt; I1; ++i1) {
<a name="l1429"><span class="linenum">1429</span></a>        if (nodes1[i1] == n) {
<a name="l1430"><span class="linenum">1430</span></a>          inBoth = true;
<a name="l1431"><span class="linenum">1431</span></a>          i1 = I1; <span class="comment">// break inner loop</span>
<a name="l1432"><span class="linenum">1432</span></a>        }
<a name="l1433"><span class="linenum">1433</span></a>      }
<a name="l1434"><span class="linenum">1434</span></a>      if (!inBoth) {
<a name="l1435"><span class="linenum">1435</span></a>        nodes1.push(n);
<a name="l1436"><span class="linenum">1436</span></a>      }
<a name="l1437"><span class="linenum">1437</span></a>    }
<a name="l1438"><span class="linenum">1438</span></a>    return new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(nodes1);
<a name="l1439"><span class="linenum">1439</span></a>  };
<a name="l1440"><span class="linenum">1440</span></a>  
<a name="l1441"><span class="linenum">1441</span></a>  function <a class="function" onClick="logFunction('PathExpr')" href="../../_functions/pathexpr.html" onMouseOver="funcPopup(event,'pathexpr')">PathExpr</a>(filter, rel) {
<a name="l1442"><span class="linenum">1442</span></a>    this.filter = filter;
<a name="l1443"><span class="linenum">1443</span></a>    this.rel = rel;
<a name="l1444"><span class="linenum">1444</span></a>  }
<a name="l1445"><span class="linenum">1445</span></a>  
<a name="l1446"><span class="linenum">1446</span></a>  PathExpr.prototype.evaluate = function(ctx) {
<a name="l1447"><span class="linenum">1447</span></a>    var nodes = this.filter.evaluate(ctx).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1448"><span class="linenum">1448</span></a>    var nodes1 = [];
<a name="l1449"><span class="linenum">1449</span></a>    for (var i = 0; i &lt; nodes.length; ++i) {
<a name="l1450"><span class="linenum">1450</span></a>      var nodes0 = this.rel.evaluate(ctx.<a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(nodes[i], i, nodes)).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1451"><span class="linenum">1451</span></a>      for (var ii = 0; ii &lt; nodes0.length; ++ii) {
<a name="l1452"><span class="linenum">1452</span></a>        nodes1.push(nodes0[ii]);
<a name="l1453"><span class="linenum">1453</span></a>      }
<a name="l1454"><span class="linenum">1454</span></a>    }
<a name="l1455"><span class="linenum">1455</span></a>    return new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(nodes1);
<a name="l1456"><span class="linenum">1456</span></a>  };
<a name="l1457"><span class="linenum">1457</span></a>  
<a name="l1458"><span class="linenum">1458</span></a>  function <a class="function" onClick="logFunction('FilterExpr')" href="../../_functions/filterexpr.html" onMouseOver="funcPopup(event,'filterexpr')">FilterExpr</a>(expr, predicate) {
<a name="l1459"><span class="linenum">1459</span></a>    this.expr = expr;
<a name="l1460"><span class="linenum">1460</span></a>    this.predicate = predicate;
<a name="l1461"><span class="linenum">1461</span></a>  }
<a name="l1462"><span class="linenum">1462</span></a>  
<a name="l1463"><span class="linenum">1463</span></a>  FilterExpr.prototype.evaluate = function(ctx) {
<a name="l1464"><span class="linenum">1464</span></a>    var nodes = this.expr.evaluate(ctx).<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1465"><span class="linenum">1465</span></a>    for (var i = 0; i &lt; this.predicate.length; ++i) {
<a name="l1466"><span class="linenum">1466</span></a>      var nodes0 = nodes;
<a name="l1467"><span class="linenum">1467</span></a>      nodes = [];
<a name="l1468"><span class="linenum">1468</span></a>      for (var j = 0; j &lt; nodes0.length; ++j) {
<a name="l1469"><span class="linenum">1469</span></a>        var n = nodes0[j];
<a name="l1470"><span class="linenum">1470</span></a>        if (this.predicate[i].evaluate(ctx.<a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(n, j, nodes0)).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>()) {
<a name="l1471"><span class="linenum">1471</span></a>          nodes.push(n);
<a name="l1472"><span class="linenum">1472</span></a>        }
<a name="l1473"><span class="linenum">1473</span></a>      }
<a name="l1474"><span class="linenum">1474</span></a>    }
<a name="l1475"><span class="linenum">1475</span></a>  
<a name="l1476"><span class="linenum">1476</span></a>    return new <a class="function" onClick="logFunction('NodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">NodeSetValue</a>(nodes);
<a name="l1477"><span class="linenum">1477</span></a>  };
<a name="l1478"><span class="linenum">1478</span></a>  
<a name="l1479"><span class="linenum">1479</span></a>  function <a class="function" onClick="logFunction('UnaryMinusExpr')" href="../../_functions/unaryminusexpr.html" onMouseOver="funcPopup(event,'unaryminusexpr')">UnaryMinusExpr</a>(expr) {
<a name="l1480"><span class="linenum">1480</span></a>    this.expr = expr;
<a name="l1481"><span class="linenum">1481</span></a>  }
<a name="l1482"><span class="linenum">1482</span></a>  
<a name="l1483"><span class="linenum">1483</span></a>  UnaryMinusExpr.prototype.evaluate = function(ctx) {
<a name="l1484"><span class="linenum">1484</span></a>    return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(-this.expr.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1485"><span class="linenum">1485</span></a>  };
<a name="l1486"><span class="linenum">1486</span></a>  
<a name="l1487"><span class="linenum">1487</span></a>  function <a class="function" onClick="logFunction('BinaryExpr')" href="../../_functions/binaryexpr.html" onMouseOver="funcPopup(event,'binaryexpr')">BinaryExpr</a>(expr1, op, expr2) {
<a name="l1488"><span class="linenum">1488</span></a>    this.expr1 = expr1;
<a name="l1489"><span class="linenum">1489</span></a>    this.expr2 = expr2;
<a name="l1490"><span class="linenum">1490</span></a>    this.op = op;
<a name="l1491"><span class="linenum">1491</span></a>  }
<a name="l1492"><span class="linenum">1492</span></a>  
<a name="l1493"><span class="linenum">1493</span></a>  BinaryExpr.prototype.evaluate = function(ctx) {
<a name="l1494"><span class="linenum">1494</span></a>    var ret;
<a name="l1495"><span class="linenum">1495</span></a>    switch (this.op.value) {
<a name="l1496"><span class="linenum">1496</span></a>      case 'or':
<a name="l1497"><span class="linenum">1497</span></a>        ret = new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>() ||
<a name="l1498"><span class="linenum">1498</span></a>                               this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>());
<a name="l1499"><span class="linenum">1499</span></a>        break;
<a name="l1500"><span class="linenum">1500</span></a>  
<a name="l1501"><span class="linenum">1501</span></a>      case 'and':
<a name="l1502"><span class="linenum">1502</span></a>        ret = new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>() &amp;&amp;
<a name="l1503"><span class="linenum">1503</span></a>                               this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>());
<a name="l1504"><span class="linenum">1504</span></a>        break;
<a name="l1505"><span class="linenum">1505</span></a>  
<a name="l1506"><span class="linenum">1506</span></a>      case '+':
<a name="l1507"><span class="linenum">1507</span></a>        ret = new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>() +
<a name="l1508"><span class="linenum">1508</span></a>                              this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1509"><span class="linenum">1509</span></a>        break;
<a name="l1510"><span class="linenum">1510</span></a>  
<a name="l1511"><span class="linenum">1511</span></a>      case '-':
<a name="l1512"><span class="linenum">1512</span></a>        ret = new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>() -
<a name="l1513"><span class="linenum">1513</span></a>                              this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1514"><span class="linenum">1514</span></a>        break;
<a name="l1515"><span class="linenum">1515</span></a>  
<a name="l1516"><span class="linenum">1516</span></a>      case '*':
<a name="l1517"><span class="linenum">1517</span></a>        ret = new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>() *
<a name="l1518"><span class="linenum">1518</span></a>                              this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1519"><span class="linenum">1519</span></a>        break;
<a name="l1520"><span class="linenum">1520</span></a>  
<a name="l1521"><span class="linenum">1521</span></a>      case 'mod':
<a name="l1522"><span class="linenum">1522</span></a>        ret = new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>() %
<a name="l1523"><span class="linenum">1523</span></a>                              this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1524"><span class="linenum">1524</span></a>        break;
<a name="l1525"><span class="linenum">1525</span></a>  
<a name="l1526"><span class="linenum">1526</span></a>      case 'div':
<a name="l1527"><span class="linenum">1527</span></a>        ret = new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(this.expr1.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>() /
<a name="l1528"><span class="linenum">1528</span></a>                              this.expr2.evaluate(ctx).<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1529"><span class="linenum">1529</span></a>        break;
<a name="l1530"><span class="linenum">1530</span></a>  
<a name="l1531"><span class="linenum">1531</span></a>      case '=':
<a name="l1532"><span class="linenum">1532</span></a>        ret = this.compare(ctx, function(x1, x2) { return x1 == x2; });
<a name="l1533"><span class="linenum">1533</span></a>        break;
<a name="l1534"><span class="linenum">1534</span></a>  
<a name="l1535"><span class="linenum">1535</span></a>      case '!=':
<a name="l1536"><span class="linenum">1536</span></a>        ret = this.compare(ctx, function(x1, x2) { return x1 != x2; });
<a name="l1537"><span class="linenum">1537</span></a>        break;
<a name="l1538"><span class="linenum">1538</span></a>  
<a name="l1539"><span class="linenum">1539</span></a>      case '&lt;':
<a name="l1540"><span class="linenum">1540</span></a>        ret = this.compare(ctx, function(x1, x2) { return x1 &lt; x2; });
<a name="l1541"><span class="linenum">1541</span></a>        break;
<a name="l1542"><span class="linenum">1542</span></a>  
<a name="l1543"><span class="linenum">1543</span></a>      case '&lt;=':
<a name="l1544"><span class="linenum">1544</span></a>        ret = this.compare(ctx, function(x1, x2) { return x1 &lt;= x2; });
<a name="l1545"><span class="linenum">1545</span></a>        break;
<a name="l1546"><span class="linenum">1546</span></a>  
<a name="l1547"><span class="linenum">1547</span></a>      case '&gt;':
<a name="l1548"><span class="linenum">1548</span></a>        ret = this.compare(ctx, function(x1, x2) { return x1 &gt; x2; });
<a name="l1549"><span class="linenum">1549</span></a>        break;
<a name="l1550"><span class="linenum">1550</span></a>  
<a name="l1551"><span class="linenum">1551</span></a>      case '&gt;=':
<a name="l1552"><span class="linenum">1552</span></a>        ret = this.compare(ctx, function(x1, x2) { return x1 &gt;= x2; });
<a name="l1553"><span class="linenum">1553</span></a>        break;
<a name="l1554"><span class="linenum">1554</span></a>  
<a name="l1555"><span class="linenum">1555</span></a>      default:
<a name="l1556"><span class="linenum">1556</span></a>        alert('BinaryExpr.evaluate: ' + this.op.value);
<a name="l1557"><span class="linenum">1557</span></a>    }
<a name="l1558"><span class="linenum">1558</span></a>    return ret;
<a name="l1559"><span class="linenum">1559</span></a>  };
<a name="l1560"><span class="linenum">1560</span></a>  
<a name="l1561"><span class="linenum">1561</span></a>  BinaryExpr.prototype.compare = function(ctx, cmp) {
<a name="l1562"><span class="linenum">1562</span></a>    var v1 = this.expr1.evaluate(ctx);
<a name="l1563"><span class="linenum">1563</span></a>    var v2 = this.expr2.evaluate(ctx);
<a name="l1564"><span class="linenum">1564</span></a>  
<a name="l1565"><span class="linenum">1565</span></a>    var ret;
<a name="l1566"><span class="linenum">1566</span></a>    if (v1.type == 'node-set' &amp;&amp; v2.type == 'node-set') {
<a name="l1567"><span class="linenum">1567</span></a>      var n1 = v1.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1568"><span class="linenum">1568</span></a>      var n2 = v2.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1569"><span class="linenum">1569</span></a>      ret = false;
<a name="l1570"><span class="linenum">1570</span></a>      for (var i1 = 0; i1 &lt; n1.length; ++i1) {
<a name="l1571"><span class="linenum">1571</span></a>        for (var i2 = 0; i2 &lt; n2.length; ++i2) {
<a name="l1572"><span class="linenum">1572</span></a>          if (<a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(<a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(n1[i1]), <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(n2[i2]))) {
<a name="l1573"><span class="linenum">1573</span></a>            ret = true;
<a name="l1574"><span class="linenum">1574</span></a>  <span class="comment">          // Break outer loop. Labels confuse the jscompiler and we</span>
<a name="l1575"><span class="linenum">1575</span></a>  <span class="comment">          // don't use them.</span>
<a name="l1576"><span class="linenum">1576</span></a>            i2 = n2.length;
<a name="l1577"><span class="linenum">1577</span></a>            i1 = n1.length;
<a name="l1578"><span class="linenum">1578</span></a>          }
<a name="l1579"><span class="linenum">1579</span></a>        }
<a name="l1580"><span class="linenum">1580</span></a>      }
<a name="l1581"><span class="linenum">1581</span></a>  
<a name="l1582"><span class="linenum">1582</span></a>    } else if (v1.type == 'node-set' || v2.type == 'node-set') {
<a name="l1583"><span class="linenum">1583</span></a>  
<a name="l1584"><span class="linenum">1584</span></a>      if (v1.type == 'number') {
<a name="l1585"><span class="linenum">1585</span></a>        var s = v1.<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1586"><span class="linenum">1586</span></a>        var n = v2.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1587"><span class="linenum">1587</span></a>  
<a name="l1588"><span class="linenum">1588</span></a>        ret = false;
<a name="l1589"><span class="linenum">1589</span></a>        for (var i = 0;  i &lt; n.length; ++i) {
<a name="l1590"><span class="linenum">1590</span></a>          var nn = <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(n[i]) - 0;
<a name="l1591"><span class="linenum">1591</span></a>          if (<a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(s, nn)) {
<a name="l1592"><span class="linenum">1592</span></a>            ret = true;
<a name="l1593"><span class="linenum">1593</span></a>            break;
<a name="l1594"><span class="linenum">1594</span></a>          }
<a name="l1595"><span class="linenum">1595</span></a>        }
<a name="l1596"><span class="linenum">1596</span></a>  
<a name="l1597"><span class="linenum">1597</span></a>      } else if (v2.type == 'number') {
<a name="l1598"><span class="linenum">1598</span></a>        var n = v1.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1599"><span class="linenum">1599</span></a>        var s = v2.<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l1600"><span class="linenum">1600</span></a>  
<a name="l1601"><span class="linenum">1601</span></a>        ret = false;
<a name="l1602"><span class="linenum">1602</span></a>        for (var i = 0;  i &lt; n.length; ++i) {
<a name="l1603"><span class="linenum">1603</span></a>          var nn = <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(n[i]) - 0;
<a name="l1604"><span class="linenum">1604</span></a>          if (<a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(nn, s)) {
<a name="l1605"><span class="linenum">1605</span></a>            ret = true;
<a name="l1606"><span class="linenum">1606</span></a>            break;
<a name="l1607"><span class="linenum">1607</span></a>          }
<a name="l1608"><span class="linenum">1608</span></a>        }
<a name="l1609"><span class="linenum">1609</span></a>  
<a name="l1610"><span class="linenum">1610</span></a>      } else if (v1.type == 'string') {
<a name="l1611"><span class="linenum">1611</span></a>        var s = v1.<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1612"><span class="linenum">1612</span></a>        var n = v2.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1613"><span class="linenum">1613</span></a>  
<a name="l1614"><span class="linenum">1614</span></a>        ret = false;
<a name="l1615"><span class="linenum">1615</span></a>        for (var i = 0;  i &lt; n.length; ++i) {
<a name="l1616"><span class="linenum">1616</span></a>          var nn = <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(n[i]);
<a name="l1617"><span class="linenum">1617</span></a>          if (<a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(s, nn)) {
<a name="l1618"><span class="linenum">1618</span></a>            ret = true;
<a name="l1619"><span class="linenum">1619</span></a>            break;
<a name="l1620"><span class="linenum">1620</span></a>          }
<a name="l1621"><span class="linenum">1621</span></a>        }
<a name="l1622"><span class="linenum">1622</span></a>  
<a name="l1623"><span class="linenum">1623</span></a>      } else if (v2.type == 'string') {
<a name="l1624"><span class="linenum">1624</span></a>        var n = v1.<a class="function" onClick="logFunction('nodeSetValue')" href="../../_functions/nodesetvalue.html" onMouseOver="funcPopup(event,'nodesetvalue')">nodeSetValue</a>();
<a name="l1625"><span class="linenum">1625</span></a>        var s = v2.<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l1626"><span class="linenum">1626</span></a>  
<a name="l1627"><span class="linenum">1627</span></a>        ret = false;
<a name="l1628"><span class="linenum">1628</span></a>        for (var i = 0;  i &lt; n.length; ++i) {
<a name="l1629"><span class="linenum">1629</span></a>          var nn = <a class="function" onClick="logFunction('xmlValue')" href="../../_functions/xmlvalue.html" onMouseOver="funcPopup(event,'xmlvalue')">xmlValue</a>(n[i]);
<a name="l1630"><span class="linenum">1630</span></a>          if (<a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(nn, s)) {
<a name="l1631"><span class="linenum">1631</span></a>            ret = true;
<a name="l1632"><span class="linenum">1632</span></a>            break;
<a name="l1633"><span class="linenum">1633</span></a>          }
<a name="l1634"><span class="linenum">1634</span></a>        }
<a name="l1635"><span class="linenum">1635</span></a>  
<a name="l1636"><span class="linenum">1636</span></a>      } else {
<a name="l1637"><span class="linenum">1637</span></a>        ret = <a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(v1.<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>(), v2.<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>());
<a name="l1638"><span class="linenum">1638</span></a>      }
<a name="l1639"><span class="linenum">1639</span></a>  
<a name="l1640"><span class="linenum">1640</span></a>    } else if (v1.type == 'boolean' || v2.type == 'boolean') {
<a name="l1641"><span class="linenum">1641</span></a>      ret = <a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(v1.<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>(), v2.<a class="function" onClick="logFunction('booleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">booleanValue</a>());
<a name="l1642"><span class="linenum">1642</span></a>  
<a name="l1643"><span class="linenum">1643</span></a>    } else if (v1.type == 'number' || v2.type == 'number') {
<a name="l1644"><span class="linenum">1644</span></a>      ret = <a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(v1.<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>(), v2.<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>());
<a name="l1645"><span class="linenum">1645</span></a>  
<a name="l1646"><span class="linenum">1646</span></a>    } else {
<a name="l1647"><span class="linenum">1647</span></a>      ret = <a class="function" onClick="logFunction('cmp')" href="../../_functions/cmp.html" onMouseOver="funcPopup(event,'cmp')">cmp</a>(v1.<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>(), v2.<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>());
<a name="l1648"><span class="linenum">1648</span></a>    }
<a name="l1649"><span class="linenum">1649</span></a>  
<a name="l1650"><span class="linenum">1650</span></a>    return new <a class="function" onClick="logFunction('BooleanValue')" href="../../_functions/booleanvalue.html" onMouseOver="funcPopup(event,'booleanvalue')">BooleanValue</a>(ret);
<a name="l1651"><span class="linenum">1651</span></a>  };
<a name="l1652"><span class="linenum">1652</span></a>  
<a name="l1653"><span class="linenum">1653</span></a>  function <a class="function" onClick="logFunction('LiteralExpr')" href="../../_functions/literalexpr.html" onMouseOver="funcPopup(event,'literalexpr')">LiteralExpr</a>(value) {
<a name="l1654"><span class="linenum">1654</span></a>    this.value = value;
<a name="l1655"><span class="linenum">1655</span></a>  }
<a name="l1656"><span class="linenum">1656</span></a>  
<a name="l1657"><span class="linenum">1657</span></a>  LiteralExpr.prototype.evaluate = function(ctx) {
<a name="l1658"><span class="linenum">1658</span></a>    return new <a class="function" onClick="logFunction('StringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">StringValue</a>(this.value);
<a name="l1659"><span class="linenum">1659</span></a>  };
<a name="l1660"><span class="linenum">1660</span></a>  
<a name="l1661"><span class="linenum">1661</span></a>  function <a class="function" onClick="logFunction('NumberExpr')" href="../../_functions/numberexpr.html" onMouseOver="funcPopup(event,'numberexpr')">NumberExpr</a>(value) {
<a name="l1662"><span class="linenum">1662</span></a>    this.value = value;
<a name="l1663"><span class="linenum">1663</span></a>  }
<a name="l1664"><span class="linenum">1664</span></a>  
<a name="l1665"><span class="linenum">1665</span></a>  NumberExpr.prototype.evaluate = function(ctx) {
<a name="l1666"><span class="linenum">1666</span></a>    return new <a class="function" onClick="logFunction('NumberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">NumberValue</a>(this.value);
<a name="l1667"><span class="linenum">1667</span></a>  };
<a name="l1668"><span class="linenum">1668</span></a>  
<a name="l1669"><span class="linenum">1669</span></a>  function <a class="function" onClick="logFunction('VariableExpr')" href="../../_functions/variableexpr.html" onMouseOver="funcPopup(event,'variableexpr')">VariableExpr</a>(name) {
<a name="l1670"><span class="linenum">1670</span></a>    this.name = name;
<a name="l1671"><span class="linenum">1671</span></a>  }
<a name="l1672"><span class="linenum">1672</span></a>  
<a name="l1673"><span class="linenum">1673</span></a>  VariableExpr.prototype.evaluate = function(ctx) {
<a name="l1674"><span class="linenum">1674</span></a>    return ctx.getVariable(this.name);
<a name="l1675"><span class="linenum">1675</span></a>  };
<a name="l1676"><span class="linenum">1676</span></a>  
<a name="l1677"><span class="linenum">1677</span></a>  <span class="comment">// Factory functions for semantic values (i.e. Expressions) of the</span>
<a name="l1678"><span class="linenum">1678</span></a>  <span class="comment">// productions in the grammar. When a production is matched to reduce</span>
<a name="l1679"><span class="linenum">1679</span></a>  <span class="comment">// the current parse state stack, the function is called with the</span>
<a name="l1680"><span class="linenum">1680</span></a>  <span class="comment">// semantic values of the matched elements as arguments, and returns</span>
<a name="l1681"><span class="linenum">1681</span></a>  <span class="comment">// another semantic value. The semantic value is a node of the parse</span>
<a name="l1682"><span class="linenum">1682</span></a>  <span class="comment">// tree, an expression object with an evaluate() method that evaluates the</span>
<a name="l1683"><span class="linenum">1683</span></a>  <span class="comment">// expression in an actual context. These factory functions are used</span>
<a name="l1684"><span class="linenum">1684</span></a>  <span class="comment">// in the specification of the grammar rules, below.</span>
<a name="l1685"><span class="linenum">1685</span></a>  
<a name="l1686"><span class="linenum">1686</span></a>  function <a class="function" onClick="logFunction('makeTokenExpr')" href="../../_functions/maketokenexpr.html" onMouseOver="funcPopup(event,'maketokenexpr')">makeTokenExpr</a>(m) {
<a name="l1687"><span class="linenum">1687</span></a>    return new <a class="function" onClick="logFunction('TokenExpr')" href="../../_functions/tokenexpr.html" onMouseOver="funcPopup(event,'tokenexpr')">TokenExpr</a>(m);
<a name="l1688"><span class="linenum">1688</span></a>  }
<a name="l1689"><span class="linenum">1689</span></a>  
<a name="l1690"><span class="linenum">1690</span></a>  function <a class="function" onClick="logFunction('passExpr')" href="../../_functions/passexpr.html" onMouseOver="funcPopup(event,'passexpr')">passExpr</a>(e) {
<a name="l1691"><span class="linenum">1691</span></a>    return e;
<a name="l1692"><span class="linenum">1692</span></a>  }
<a name="l1693"><span class="linenum">1693</span></a>  
<a name="l1694"><span class="linenum">1694</span></a>  function <a class="function" onClick="logFunction('makeLocationExpr1')" href="../../_functions/makelocationexpr1.html" onMouseOver="funcPopup(event,'makelocationexpr1')">makeLocationExpr1</a>(slash, rel) {
<a name="l1695"><span class="linenum">1695</span></a>    rel.absolute = true;
<a name="l1696"><span class="linenum">1696</span></a>    return rel;
<a name="l1697"><span class="linenum">1697</span></a>  }
<a name="l1698"><span class="linenum">1698</span></a>  
<a name="l1699"><span class="linenum">1699</span></a>  function <a class="function" onClick="logFunction('makeLocationExpr2')" href="../../_functions/makelocationexpr2.html" onMouseOver="funcPopup(event,'makelocationexpr2')">makeLocationExpr2</a>(dslash, rel) {
<a name="l1700"><span class="linenum">1700</span></a>    rel.absolute = true;
<a name="l1701"><span class="linenum">1701</span></a>    rel.prependStep(<a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>(dslash.value));
<a name="l1702"><span class="linenum">1702</span></a>    return rel;
<a name="l1703"><span class="linenum">1703</span></a>  }
<a name="l1704"><span class="linenum">1704</span></a>  
<a name="l1705"><span class="linenum">1705</span></a>  function <a class="function" onClick="logFunction('makeLocationExpr3')" href="../../_functions/makelocationexpr3.html" onMouseOver="funcPopup(event,'makelocationexpr3')">makeLocationExpr3</a>(slash) {
<a name="l1706"><span class="linenum">1706</span></a>    var ret = new <a class="function" onClick="logFunction('LocationExpr')" href="../../_functions/locationexpr.html" onMouseOver="funcPopup(event,'locationexpr')">LocationExpr</a>();
<a name="l1707"><span class="linenum">1707</span></a>    ret.appendStep(<a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>('.'));
<a name="l1708"><span class="linenum">1708</span></a>    ret.absolute = true;
<a name="l1709"><span class="linenum">1709</span></a>    return ret;
<a name="l1710"><span class="linenum">1710</span></a>  }
<a name="l1711"><span class="linenum">1711</span></a>  
<a name="l1712"><span class="linenum">1712</span></a>  function <a class="function" onClick="logFunction('makeLocationExpr4')" href="../../_functions/makelocationexpr4.html" onMouseOver="funcPopup(event,'makelocationexpr4')">makeLocationExpr4</a>(dslash) {
<a name="l1713"><span class="linenum">1713</span></a>    var ret = new <a class="function" onClick="logFunction('LocationExpr')" href="../../_functions/locationexpr.html" onMouseOver="funcPopup(event,'locationexpr')">LocationExpr</a>();
<a name="l1714"><span class="linenum">1714</span></a>    ret.absolute = true;
<a name="l1715"><span class="linenum">1715</span></a>    ret.appendStep(<a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>(dslash.value));
<a name="l1716"><span class="linenum">1716</span></a>    return ret;
<a name="l1717"><span class="linenum">1717</span></a>  }
<a name="l1718"><span class="linenum">1718</span></a>  
<a name="l1719"><span class="linenum">1719</span></a>  function <a class="function" onClick="logFunction('makeLocationExpr5')" href="../../_functions/makelocationexpr5.html" onMouseOver="funcPopup(event,'makelocationexpr5')">makeLocationExpr5</a>(step) {
<a name="l1720"><span class="linenum">1720</span></a>    var ret = new <a class="function" onClick="logFunction('LocationExpr')" href="../../_functions/locationexpr.html" onMouseOver="funcPopup(event,'locationexpr')">LocationExpr</a>();
<a name="l1721"><span class="linenum">1721</span></a>    ret.appendStep(step);
<a name="l1722"><span class="linenum">1722</span></a>    return ret;
<a name="l1723"><span class="linenum">1723</span></a>  }
<a name="l1724"><span class="linenum">1724</span></a>  
<a name="l1725"><span class="linenum">1725</span></a>  function <a class="function" onClick="logFunction('makeLocationExpr6')" href="../../_functions/makelocationexpr6.html" onMouseOver="funcPopup(event,'makelocationexpr6')">makeLocationExpr6</a>(rel, slash, step) {
<a name="l1726"><span class="linenum">1726</span></a>    rel.appendStep(step);
<a name="l1727"><span class="linenum">1727</span></a>    return rel;
<a name="l1728"><span class="linenum">1728</span></a>  }
<a name="l1729"><span class="linenum">1729</span></a>  
<a name="l1730"><span class="linenum">1730</span></a>  function <a class="function" onClick="logFunction('makeLocationExpr7')" href="../../_functions/makelocationexpr7.html" onMouseOver="funcPopup(event,'makelocationexpr7')">makeLocationExpr7</a>(rel, dslash, step) {
<a name="l1731"><span class="linenum">1731</span></a>    rel.appendStep(<a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>(dslash.value));
<a name="l1732"><span class="linenum">1732</span></a>    return rel;
<a name="l1733"><span class="linenum">1733</span></a>  }
<a name="l1734"><span class="linenum">1734</span></a>  
<a name="l1735"><span class="linenum">1735</span></a>  function <a class="function" onClick="logFunction('makeStepExpr1')" href="../../_functions/makestepexpr1.html" onMouseOver="funcPopup(event,'makestepexpr1')">makeStepExpr1</a>(dot) {
<a name="l1736"><span class="linenum">1736</span></a>    return <a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>(dot.value);
<a name="l1737"><span class="linenum">1737</span></a>  }
<a name="l1738"><span class="linenum">1738</span></a>  
<a name="l1739"><span class="linenum">1739</span></a>  function <a class="function" onClick="logFunction('makeStepExpr2')" href="../../_functions/makestepexpr2.html" onMouseOver="funcPopup(event,'makestepexpr2')">makeStepExpr2</a>(ddot) {
<a name="l1740"><span class="linenum">1740</span></a>    return <a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>(ddot.value);
<a name="l1741"><span class="linenum">1741</span></a>  }
<a name="l1742"><span class="linenum">1742</span></a>  
<a name="l1743"><span class="linenum">1743</span></a>  function <a class="function" onClick="logFunction('makeStepExpr3')" href="../../_functions/makestepexpr3.html" onMouseOver="funcPopup(event,'makestepexpr3')">makeStepExpr3</a>(axisname, axis, nodetest) {
<a name="l1744"><span class="linenum">1744</span></a>    return new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>(axisname.value, nodetest);
<a name="l1745"><span class="linenum">1745</span></a>  }
<a name="l1746"><span class="linenum">1746</span></a>  
<a name="l1747"><span class="linenum">1747</span></a>  function <a class="function" onClick="logFunction('makeStepExpr4')" href="../../_functions/makestepexpr4.html" onMouseOver="funcPopup(event,'makestepexpr4')">makeStepExpr4</a>(at, nodetest) {
<a name="l1748"><span class="linenum">1748</span></a>    return new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('attribute', nodetest);
<a name="l1749"><span class="linenum">1749</span></a>  }
<a name="l1750"><span class="linenum">1750</span></a>  
<a name="l1751"><span class="linenum">1751</span></a>  function <a class="function" onClick="logFunction('makeStepExpr5')" href="../../_functions/makestepexpr5.html" onMouseOver="funcPopup(event,'makestepexpr5')">makeStepExpr5</a>(nodetest) {
<a name="l1752"><span class="linenum">1752</span></a>    return new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('child', nodetest);
<a name="l1753"><span class="linenum">1753</span></a>  }
<a name="l1754"><span class="linenum">1754</span></a>  
<a name="l1755"><span class="linenum">1755</span></a>  function <a class="function" onClick="logFunction('makeStepExpr6')" href="../../_functions/makestepexpr6.html" onMouseOver="funcPopup(event,'makestepexpr6')">makeStepExpr6</a>(step, predicate) {
<a name="l1756"><span class="linenum">1756</span></a>    step.appendPredicate(predicate);
<a name="l1757"><span class="linenum">1757</span></a>    return step;
<a name="l1758"><span class="linenum">1758</span></a>  }
<a name="l1759"><span class="linenum">1759</span></a>  
<a name="l1760"><span class="linenum">1760</span></a>  function <a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>(abbrev) {
<a name="l1761"><span class="linenum">1761</span></a>    switch (abbrev) {
<a name="l1762"><span class="linenum">1762</span></a>    case '//':
<a name="l1763"><span class="linenum">1763</span></a>      return new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('descendant-or-self', new NodeTestAny);
<a name="l1764"><span class="linenum">1764</span></a>  
<a name="l1765"><span class="linenum">1765</span></a>    case '.':
<a name="l1766"><span class="linenum">1766</span></a>      return new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('self', new NodeTestAny);
<a name="l1767"><span class="linenum">1767</span></a>  
<a name="l1768"><span class="linenum">1768</span></a>    case '..':
<a name="l1769"><span class="linenum">1769</span></a>      return new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('parent', new NodeTestAny);
<a name="l1770"><span class="linenum">1770</span></a>    }
<a name="l1771"><span class="linenum">1771</span></a>  }
<a name="l1772"><span class="linenum">1772</span></a>  
<a name="l1773"><span class="linenum">1773</span></a>  function <a class="function" onClick="logFunction('makeNodeTestExpr1')" href="../../_functions/makenodetestexpr1.html" onMouseOver="funcPopup(event,'makenodetestexpr1')">makeNodeTestExpr1</a>(asterisk) {
<a name="l1774"><span class="linenum">1774</span></a>    return new NodeTestElementOrAttribute;
<a name="l1775"><span class="linenum">1775</span></a>  }
<a name="l1776"><span class="linenum">1776</span></a>  
<a name="l1777"><span class="linenum">1777</span></a>  function <a class="function" onClick="logFunction('makeNodeTestExpr2')" href="../../_functions/makenodetestexpr2.html" onMouseOver="funcPopup(event,'makenodetestexpr2')">makeNodeTestExpr2</a>(ncname, colon, asterisk) {
<a name="l1778"><span class="linenum">1778</span></a>    return new <a class="function" onClick="logFunction('NodeTestNC')" href="../../_functions/nodetestnc.html" onMouseOver="funcPopup(event,'nodetestnc')">NodeTestNC</a>(ncname.value);
<a name="l1779"><span class="linenum">1779</span></a>  }
<a name="l1780"><span class="linenum">1780</span></a>  
<a name="l1781"><span class="linenum">1781</span></a>  function <a class="function" onClick="logFunction('makeNodeTestExpr3')" href="../../_functions/makenodetestexpr3.html" onMouseOver="funcPopup(event,'makenodetestexpr3')">makeNodeTestExpr3</a>(qname) {
<a name="l1782"><span class="linenum">1782</span></a>    return new <a class="function" onClick="logFunction('NodeTestName')" href="../../_functions/nodetestname.html" onMouseOver="funcPopup(event,'nodetestname')">NodeTestName</a>(qname.value);
<a name="l1783"><span class="linenum">1783</span></a>  }
<a name="l1784"><span class="linenum">1784</span></a>  
<a name="l1785"><span class="linenum">1785</span></a>  function <a class="function" onClick="logFunction('makeNodeTestExpr4')" href="../../_functions/makenodetestexpr4.html" onMouseOver="funcPopup(event,'makenodetestexpr4')">makeNodeTestExpr4</a>(typeo, parenc) {
<a name="l1786"><span class="linenum">1786</span></a>    var type = typeo.value.replace(/\s*\($/, '');
<a name="l1787"><span class="linenum">1787</span></a>    switch(type) {
<a name="l1788"><span class="linenum">1788</span></a>    case 'node':
<a name="l1789"><span class="linenum">1789</span></a>      return new NodeTestAny;
<a name="l1790"><span class="linenum">1790</span></a>  
<a name="l1791"><span class="linenum">1791</span></a>    case 'text':
<a name="l1792"><span class="linenum">1792</span></a>      return new NodeTestText;
<a name="l1793"><span class="linenum">1793</span></a>  
<a name="l1794"><span class="linenum">1794</span></a>    case 'comment':
<a name="l1795"><span class="linenum">1795</span></a>      return new NodeTestComment;
<a name="l1796"><span class="linenum">1796</span></a>  
<a name="l1797"><span class="linenum">1797</span></a>    case 'processing-instruction':
<a name="l1798"><span class="linenum">1798</span></a>      return new <a class="function" onClick="logFunction('NodeTestPI')" href="../../_functions/nodetestpi.html" onMouseOver="funcPopup(event,'nodetestpi')">NodeTestPI</a>('');
<a name="l1799"><span class="linenum">1799</span></a>    }
<a name="l1800"><span class="linenum">1800</span></a>  }
<a name="l1801"><span class="linenum">1801</span></a>  
<a name="l1802"><span class="linenum">1802</span></a>  function <a class="function" onClick="logFunction('makeNodeTestExpr5')" href="../../_functions/makenodetestexpr5.html" onMouseOver="funcPopup(event,'makenodetestexpr5')">makeNodeTestExpr5</a>(typeo, target, parenc) {
<a name="l1803"><span class="linenum">1803</span></a>    var type = typeo.replace(/\s*\($/, '');
<a name="l1804"><span class="linenum">1804</span></a>    if (type != 'processing-instruction') {
<a name="l1805"><span class="linenum">1805</span></a>      throw type;
<a name="l1806"><span class="linenum">1806</span></a>    }
<a name="l1807"><span class="linenum">1807</span></a>    return new <a class="function" onClick="logFunction('NodeTestPI')" href="../../_functions/nodetestpi.html" onMouseOver="funcPopup(event,'nodetestpi')">NodeTestPI</a>(target.value);
<a name="l1808"><span class="linenum">1808</span></a>  }
<a name="l1809"><span class="linenum">1809</span></a>  
<a name="l1810"><span class="linenum">1810</span></a>  function <a class="function" onClick="logFunction('makePredicateExpr')" href="../../_functions/makepredicateexpr.html" onMouseOver="funcPopup(event,'makepredicateexpr')">makePredicateExpr</a>(pareno, expr, parenc) {
<a name="l1811"><span class="linenum">1811</span></a>    return new <a class="function" onClick="logFunction('PredicateExpr')" href="../../_functions/predicateexpr.html" onMouseOver="funcPopup(event,'predicateexpr')">PredicateExpr</a>(expr);
<a name="l1812"><span class="linenum">1812</span></a>  }
<a name="l1813"><span class="linenum">1813</span></a>  
<a name="l1814"><span class="linenum">1814</span></a>  function <a class="function" onClick="logFunction('makePrimaryExpr')" href="../../_functions/makeprimaryexpr.html" onMouseOver="funcPopup(event,'makeprimaryexpr')">makePrimaryExpr</a>(pareno, expr, parenc) {
<a name="l1815"><span class="linenum">1815</span></a>    return expr;
<a name="l1816"><span class="linenum">1816</span></a>  }
<a name="l1817"><span class="linenum">1817</span></a>  
<a name="l1818"><span class="linenum">1818</span></a>  function <a class="function" onClick="logFunction('makeFunctionCallExpr1')" href="../../_functions/makefunctioncallexpr1.html" onMouseOver="funcPopup(event,'makefunctioncallexpr1')">makeFunctionCallExpr1</a>(name, pareno, parenc) {
<a name="l1819"><span class="linenum">1819</span></a>    return new <a class="function" onClick="logFunction('FunctionCallExpr')" href="../../_functions/functioncallexpr.html" onMouseOver="funcPopup(event,'functioncallexpr')">FunctionCallExpr</a>(name);
<a name="l1820"><span class="linenum">1820</span></a>  }
<a name="l1821"><span class="linenum">1821</span></a>  
<a name="l1822"><span class="linenum">1822</span></a>  function <a class="function" onClick="logFunction('makeFunctionCallExpr2')" href="../../_functions/makefunctioncallexpr2.html" onMouseOver="funcPopup(event,'makefunctioncallexpr2')">makeFunctionCallExpr2</a>(name, pareno, arg1, args, parenc) {
<a name="l1823"><span class="linenum">1823</span></a>    var ret = new <a class="function" onClick="logFunction('FunctionCallExpr')" href="../../_functions/functioncallexpr.html" onMouseOver="funcPopup(event,'functioncallexpr')">FunctionCallExpr</a>(name);
<a name="l1824"><span class="linenum">1824</span></a>    ret.appendArg(arg1);
<a name="l1825"><span class="linenum">1825</span></a>    for (var i = 0; i &lt; args.length; ++i) {
<a name="l1826"><span class="linenum">1826</span></a>      ret.appendArg(args[i]);
<a name="l1827"><span class="linenum">1827</span></a>    }
<a name="l1828"><span class="linenum">1828</span></a>    return ret;
<a name="l1829"><span class="linenum">1829</span></a>  }
<a name="l1830"><span class="linenum">1830</span></a>  
<a name="l1831"><span class="linenum">1831</span></a>  function <a class="function" onClick="logFunction('makeArgumentExpr')" href="../../_functions/makeargumentexpr.html" onMouseOver="funcPopup(event,'makeargumentexpr')">makeArgumentExpr</a>(comma, expr) {
<a name="l1832"><span class="linenum">1832</span></a>    return expr;
<a name="l1833"><span class="linenum">1833</span></a>  }
<a name="l1834"><span class="linenum">1834</span></a>  
<a name="l1835"><span class="linenum">1835</span></a>  function <a class="function" onClick="logFunction('makeUnionExpr')" href="../../_functions/makeunionexpr.html" onMouseOver="funcPopup(event,'makeunionexpr')">makeUnionExpr</a>(expr1, pipe, expr2) {
<a name="l1836"><span class="linenum">1836</span></a>    return new <a class="function" onClick="logFunction('UnionExpr')" href="../../_functions/unionexpr.html" onMouseOver="funcPopup(event,'unionexpr')">UnionExpr</a>(expr1, expr2);
<a name="l1837"><span class="linenum">1837</span></a>  }
<a name="l1838"><span class="linenum">1838</span></a>  
<a name="l1839"><span class="linenum">1839</span></a>  function <a class="function" onClick="logFunction('makePathExpr1')" href="../../_functions/makepathexpr1.html" onMouseOver="funcPopup(event,'makepathexpr1')">makePathExpr1</a>(filter, slash, rel) {
<a name="l1840"><span class="linenum">1840</span></a>    return new <a class="function" onClick="logFunction('PathExpr')" href="../../_functions/pathexpr.html" onMouseOver="funcPopup(event,'pathexpr')">PathExpr</a>(filter, rel);
<a name="l1841"><span class="linenum">1841</span></a>  }
<a name="l1842"><span class="linenum">1842</span></a>  
<a name="l1843"><span class="linenum">1843</span></a>  function <a class="function" onClick="logFunction('makePathExpr2')" href="../../_functions/makepathexpr2.html" onMouseOver="funcPopup(event,'makepathexpr2')">makePathExpr2</a>(filter, dslash, rel) {
<a name="l1844"><span class="linenum">1844</span></a>    rel.prependStep(<a class="function" onClick="logFunction('makeAbbrevStep')" href="../../_functions/makeabbrevstep.html" onMouseOver="funcPopup(event,'makeabbrevstep')">makeAbbrevStep</a>(dslash.value));
<a name="l1845"><span class="linenum">1845</span></a>    return new <a class="function" onClick="logFunction('PathExpr')" href="../../_functions/pathexpr.html" onMouseOver="funcPopup(event,'pathexpr')">PathExpr</a>(filter, rel);
<a name="l1846"><span class="linenum">1846</span></a>  }
<a name="l1847"><span class="linenum">1847</span></a>  
<a name="l1848"><span class="linenum">1848</span></a>  function <a class="function" onClick="logFunction('makeFilterExpr')" href="../../_functions/makefilterexpr.html" onMouseOver="funcPopup(event,'makefilterexpr')">makeFilterExpr</a>(expr, predicates) {
<a name="l1849"><span class="linenum">1849</span></a>    if (predicates.length &gt; 0) {
<a name="l1850"><span class="linenum">1850</span></a>      return new <a class="function" onClick="logFunction('FilterExpr')" href="../../_functions/filterexpr.html" onMouseOver="funcPopup(event,'filterexpr')">FilterExpr</a>(expr, predicates);
<a name="l1851"><span class="linenum">1851</span></a>    } else {
<a name="l1852"><span class="linenum">1852</span></a>      return expr;
<a name="l1853"><span class="linenum">1853</span></a>    }
<a name="l1854"><span class="linenum">1854</span></a>  }
<a name="l1855"><span class="linenum">1855</span></a>  
<a name="l1856"><span class="linenum">1856</span></a>  function <a class="function" onClick="logFunction('makeUnaryMinusExpr')" href="../../_functions/makeunaryminusexpr.html" onMouseOver="funcPopup(event,'makeunaryminusexpr')">makeUnaryMinusExpr</a>(minus, expr) {
<a name="l1857"><span class="linenum">1857</span></a>    return new <a class="function" onClick="logFunction('UnaryMinusExpr')" href="../../_functions/unaryminusexpr.html" onMouseOver="funcPopup(event,'unaryminusexpr')">UnaryMinusExpr</a>(expr);
<a name="l1858"><span class="linenum">1858</span></a>  }
<a name="l1859"><span class="linenum">1859</span></a>  
<a name="l1860"><span class="linenum">1860</span></a>  function <a class="function" onClick="logFunction('makeBinaryExpr')" href="../../_functions/makebinaryexpr.html" onMouseOver="funcPopup(event,'makebinaryexpr')">makeBinaryExpr</a>(expr1, op, expr2) {
<a name="l1861"><span class="linenum">1861</span></a>    return new <a class="function" onClick="logFunction('BinaryExpr')" href="../../_functions/binaryexpr.html" onMouseOver="funcPopup(event,'binaryexpr')">BinaryExpr</a>(expr1, op, expr2);
<a name="l1862"><span class="linenum">1862</span></a>  }
<a name="l1863"><span class="linenum">1863</span></a>  
<a name="l1864"><span class="linenum">1864</span></a>  function <a class="function" onClick="logFunction('makeLiteralExpr')" href="../../_functions/makeliteralexpr.html" onMouseOver="funcPopup(event,'makeliteralexpr')">makeLiteralExpr</a>(token) {
<a name="l1865"><span class="linenum">1865</span></a>  <span class="comment">  // remove quotes from the parsed value:</span>
<a name="l1866"><span class="linenum">1866</span></a>    var value = token.value.substring(1, token.value.length - 1);
<a name="l1867"><span class="linenum">1867</span></a>    return new <a class="function" onClick="logFunction('LiteralExpr')" href="../../_functions/literalexpr.html" onMouseOver="funcPopup(event,'literalexpr')">LiteralExpr</a>(value);
<a name="l1868"><span class="linenum">1868</span></a>  }
<a name="l1869"><span class="linenum">1869</span></a>  
<a name="l1870"><span class="linenum">1870</span></a>  function <a class="function" onClick="logFunction('makeNumberExpr')" href="../../_functions/makenumberexpr.html" onMouseOver="funcPopup(event,'makenumberexpr')">makeNumberExpr</a>(token) {
<a name="l1871"><span class="linenum">1871</span></a>    return new <a class="function" onClick="logFunction('NumberExpr')" href="../../_functions/numberexpr.html" onMouseOver="funcPopup(event,'numberexpr')">NumberExpr</a>(token.value);
<a name="l1872"><span class="linenum">1872</span></a>  }
<a name="l1873"><span class="linenum">1873</span></a>  
<a name="l1874"><span class="linenum">1874</span></a>  function <a class="function" onClick="logFunction('makeVariableReference')" href="../../_functions/makevariablereference.html" onMouseOver="funcPopup(event,'makevariablereference')">makeVariableReference</a>(dollar, name) {
<a name="l1875"><span class="linenum">1875</span></a>    return new <a class="function" onClick="logFunction('VariableExpr')" href="../../_functions/variableexpr.html" onMouseOver="funcPopup(event,'variableexpr')">VariableExpr</a>(name.value);
<a name="l1876"><span class="linenum">1876</span></a>  }
<a name="l1877"><span class="linenum">1877</span></a>  
<a name="l1878"><span class="linenum">1878</span></a>  <span class="comment">// Used before parsing for optimization of common simple cases. See</span>
<a name="l1879"><span class="linenum">1879</span></a>  <span class="comment">// the begin of xpathParse() for which they are.</span>
<a name="l1880"><span class="linenum">1880</span></a>  function <a class="function" onClick="logFunction('makeSimpleExpr')" href="../../_functions/makesimpleexpr.html" onMouseOver="funcPopup(event,'makesimpleexpr')">makeSimpleExpr</a>(expr) {
<a name="l1881"><span class="linenum">1881</span></a>    if (expr.charAt(0) == '$') {
<a name="l1882"><span class="linenum">1882</span></a>      return new <a class="function" onClick="logFunction('VariableExpr')" href="../../_functions/variableexpr.html" onMouseOver="funcPopup(event,'variableexpr')">VariableExpr</a>(expr.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(1));
<a name="l1883"><span class="linenum">1883</span></a>    } else if (expr.charAt(0) == '@') {
<a name="l1884"><span class="linenum">1884</span></a>      var a = new <a class="function" onClick="logFunction('NodeTestName')" href="../../_functions/nodetestname.html" onMouseOver="funcPopup(event,'nodetestname')">NodeTestName</a>(expr.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(1));
<a name="l1885"><span class="linenum">1885</span></a>      var b = new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('attribute', a);
<a name="l1886"><span class="linenum">1886</span></a>      var c = new <a class="function" onClick="logFunction('LocationExpr')" href="../../_functions/locationexpr.html" onMouseOver="funcPopup(event,'locationexpr')">LocationExpr</a>();
<a name="l1887"><span class="linenum">1887</span></a>      c.appendStep(b);
<a name="l1888"><span class="linenum">1888</span></a>      return c;
<a name="l1889"><span class="linenum">1889</span></a>    } else if (expr.match(/^[0-9]+$/)) {
<a name="l1890"><span class="linenum">1890</span></a>      return new <a class="function" onClick="logFunction('NumberExpr')" href="../../_functions/numberexpr.html" onMouseOver="funcPopup(event,'numberexpr')">NumberExpr</a>(expr);
<a name="l1891"><span class="linenum">1891</span></a>    } else {
<a name="l1892"><span class="linenum">1892</span></a>      var a = new <a class="function" onClick="logFunction('NodeTestName')" href="../../_functions/nodetestname.html" onMouseOver="funcPopup(event,'nodetestname')">NodeTestName</a>(expr);
<a name="l1893"><span class="linenum">1893</span></a>      var b = new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('child', a);
<a name="l1894"><span class="linenum">1894</span></a>      var c = new <a class="function" onClick="logFunction('LocationExpr')" href="../../_functions/locationexpr.html" onMouseOver="funcPopup(event,'locationexpr')">LocationExpr</a>();
<a name="l1895"><span class="linenum">1895</span></a>      c.appendStep(b);
<a name="l1896"><span class="linenum">1896</span></a>      return c;
<a name="l1897"><span class="linenum">1897</span></a>    }
<a name="l1898"><span class="linenum">1898</span></a>  }
<a name="l1899"><span class="linenum">1899</span></a>  
<a name="l1900"><span class="linenum">1900</span></a>  function <a class="function" onClick="logFunction('makeSimpleExpr2')" href="../../_functions/makesimpleexpr2.html" onMouseOver="funcPopup(event,'makesimpleexpr2')">makeSimpleExpr2</a>(expr) {
<a name="l1901"><span class="linenum">1901</span></a>    var steps = <a class="function" onClick="logFunction('stringSplit')" href="../../_functions/stringsplit.html" onMouseOver="funcPopup(event,'stringsplit')">stringSplit</a>(expr, '/');
<a name="l1902"><span class="linenum">1902</span></a>    var c = new <a class="function" onClick="logFunction('LocationExpr')" href="../../_functions/locationexpr.html" onMouseOver="funcPopup(event,'locationexpr')">LocationExpr</a>();
<a name="l1903"><span class="linenum">1903</span></a>    for (var i = 0; i &lt; steps.length; ++i) {
<a name="l1904"><span class="linenum">1904</span></a>      var a = new <a class="function" onClick="logFunction('NodeTestName')" href="../../_functions/nodetestname.html" onMouseOver="funcPopup(event,'nodetestname')">NodeTestName</a>(steps[i]);
<a name="l1905"><span class="linenum">1905</span></a>      var b = new <a class="function" onClick="logFunction('StepExpr')" href="../../_functions/stepexpr.html" onMouseOver="funcPopup(event,'stepexpr')">StepExpr</a>('child', a);
<a name="l1906"><span class="linenum">1906</span></a>      c.appendStep(b);
<a name="l1907"><span class="linenum">1907</span></a>    }
<a name="l1908"><span class="linenum">1908</span></a>    return c;
<a name="l1909"><span class="linenum">1909</span></a>  }
<a name="l1910"><span class="linenum">1910</span></a>  
<a name="l1911"><span class="linenum">1911</span></a>  <span class="comment">// The axes of XPath expressions.</span>
<a name="l1912"><span class="linenum">1912</span></a>  
<a name="l1913"><span class="linenum">1913</span></a>  var xpathAxis = {
<a name="l1914"><span class="linenum">1914</span></a>    ANCESTOR_OR_SELF: 'ancestor-or-self',
<a name="l1915"><span class="linenum">1915</span></a>    ANCESTOR: 'ancestor',
<a name="l1916"><span class="linenum">1916</span></a>    ATTRIBUTE: 'attribute',
<a name="l1917"><span class="linenum">1917</span></a>    CHILD: 'child',
<a name="l1918"><span class="linenum">1918</span></a>    DESCENDANT_OR_SELF: 'descendant-or-self',
<a name="l1919"><span class="linenum">1919</span></a>    DESCENDANT: 'descendant',
<a name="l1920"><span class="linenum">1920</span></a>    FOLLOWING_SIBLING: 'following-sibling',
<a name="l1921"><span class="linenum">1921</span></a>    FOLLOWING: 'following',
<a name="l1922"><span class="linenum">1922</span></a>    NAMESPACE: 'namespace',
<a name="l1923"><span class="linenum">1923</span></a>    PARENT: 'parent',
<a name="l1924"><span class="linenum">1924</span></a>    PRECEDING_SIBLING: 'preceding-sibling',
<a name="l1925"><span class="linenum">1925</span></a>    PRECEDING: 'preceding',
<a name="l1926"><span class="linenum">1926</span></a>    SELF: 'self'
<a name="l1927"><span class="linenum">1927</span></a>  };
<a name="l1928"><span class="linenum">1928</span></a>  
<a name="l1929"><span class="linenum">1929</span></a>  var xpathAxesRe = [
<a name="l1930"><span class="linenum">1930</span></a>      xpathAxis.ANCESTOR_OR_SELF,
<a name="l1931"><span class="linenum">1931</span></a>      xpathAxis.ANCESTOR,
<a name="l1932"><span class="linenum">1932</span></a>      xpathAxis.ATTRIBUTE,
<a name="l1933"><span class="linenum">1933</span></a>      xpathAxis.CHILD,
<a name="l1934"><span class="linenum">1934</span></a>      xpathAxis.DESCENDANT_OR_SELF,
<a name="l1935"><span class="linenum">1935</span></a>      xpathAxis.DESCENDANT,
<a name="l1936"><span class="linenum">1936</span></a>      xpathAxis.FOLLOWING_SIBLING,
<a name="l1937"><span class="linenum">1937</span></a>      xpathAxis.FOLLOWING,
<a name="l1938"><span class="linenum">1938</span></a>      xpathAxis.NAMESPACE,
<a name="l1939"><span class="linenum">1939</span></a>      xpathAxis.PARENT,
<a name="l1940"><span class="linenum">1940</span></a>      xpathAxis.PRECEDING_SIBLING,
<a name="l1941"><span class="linenum">1941</span></a>      xpathAxis.PRECEDING,
<a name="l1942"><span class="linenum">1942</span></a>      xpathAxis.SELF
<a name="l1943"><span class="linenum">1943</span></a>  ].join('|');
<a name="l1944"><span class="linenum">1944</span></a>  
<a name="l1945"><span class="linenum">1945</span></a>  
<a name="l1946"><span class="linenum">1946</span></a>  <span class="comment">// The tokens of the language. The label property is just used for</span>
<a name="l1947"><span class="linenum">1947</span></a>  <span class="comment">// generating debug output. The prec property is the precedence used</span>
<a name="l1948"><span class="linenum">1948</span></a>  <span class="comment">// for shift/reduce resolution. Default precedence is 0 as a lookahead</span>
<a name="l1949"><span class="linenum">1949</span></a>  <span class="comment">// token and 2 on the stack. TODO(mesch): this is certainly not</span>
<a name="l1950"><span class="linenum">1950</span></a>  <span class="comment">// necessary and too complicated. Simplify this!</span>
<a name="l1951"><span class="linenum">1951</span></a>  
<a name="l1952"><span class="linenum">1952</span></a>  <span class="comment">// NOTE: tabular formatting is the big exception, but here it should</span>
<a name="l1953"><span class="linenum">1953</span></a>  <span class="comment">// be OK.</span>
<a name="l1954"><span class="linenum">1954</span></a>  
<a name="l1955"><span class="linenum">1955</span></a>  var TOK_PIPE =   { label: &quot;|&quot;,   prec:   17, re: new RegExp(&quot;^\\|&quot;) };
<a name="l1956"><span class="linenum">1956</span></a>  var TOK_DSLASH = { label: &quot;//&quot;,  prec:   19, re: new RegExp(&quot;^//&quot;)  };
<a name="l1957"><span class="linenum">1957</span></a>  var TOK_SLASH =  { label: &quot;/&quot;,   prec:   30, re: new RegExp(&quot;^/&quot;)   };
<a name="l1958"><span class="linenum">1958</span></a>  var TOK_AXIS =   { label: &quot;::&quot;,  prec:   20, re: new RegExp(&quot;^::&quot;)  };
<a name="l1959"><span class="linenum">1959</span></a>  var TOK_COLON =  { label: &quot;:&quot;,   prec: 1000, re: new RegExp(&quot;^:&quot;)  };
<a name="l1960"><span class="linenum">1960</span></a>  var TOK_AXISNAME = { label: &quot;[axis]&quot;, re: new RegExp('^(' + xpathAxesRe + ')') };
<a name="l1961"><span class="linenum">1961</span></a>  var TOK_PARENO = { label: &quot;(&quot;,   prec:   34, re: new RegExp(&quot;^\\(&quot;) };
<a name="l1962"><span class="linenum">1962</span></a>  var TOK_PARENC = { label: &quot;)&quot;,               re: new RegExp(&quot;^\\)&quot;) };
<a name="l1963"><span class="linenum">1963</span></a>  var TOK_DDOT =   { label: &quot;..&quot;,  prec:   34, re: new RegExp(&quot;^\\.\\.&quot;) };
<a name="l1964"><span class="linenum">1964</span></a>  var TOK_DOT =    { label: &quot;.&quot;,   prec:   34, re: new RegExp(&quot;^\\.&quot;) };
<a name="l1965"><span class="linenum">1965</span></a>  var TOK_AT =     { label: &quot;@&quot;,   prec:   34, re: new RegExp(&quot;^@&quot;)   };
<a name="l1966"><span class="linenum">1966</span></a>  
<a name="l1967"><span class="linenum">1967</span></a>  var TOK_COMMA =  { label: &quot;,&quot;,               re: new RegExp(&quot;^,&quot;) };
<a name="l1968"><span class="linenum">1968</span></a>  
<a name="l1969"><span class="linenum">1969</span></a>  var TOK_OR =     { label: &quot;or&quot;,  prec:   10, re: new RegExp(&quot;^or\\b&quot;) };
<a name="l1970"><span class="linenum">1970</span></a>  var TOK_AND =    { label: &quot;and&quot;, prec:   11, re: new RegExp(&quot;^and\\b&quot;) };
<a name="l1971"><span class="linenum">1971</span></a>  var TOK_EQ =     { label: &quot;=&quot;,   prec:   12, re: new RegExp(&quot;^=&quot;)   };
<a name="l1972"><span class="linenum">1972</span></a>  var TOK_NEQ =    { label: &quot;!=&quot;,  prec:   12, re: new RegExp(&quot;^!=&quot;)  };
<a name="l1973"><span class="linenum">1973</span></a>  var TOK_GE =     { label: &quot;&gt;=&quot;,  prec:   13, re: new RegExp(&quot;^&gt;=&quot;)  };
<a name="l1974"><span class="linenum">1974</span></a>  var TOK_GT =     { label: &quot;&gt;&quot;,   prec:   13, re: new RegExp(&quot;^&gt;&quot;)   };
<a name="l1975"><span class="linenum">1975</span></a>  var TOK_LE =     { label: &quot;&lt;=&quot;,  prec:   13, re: new RegExp(&quot;^&lt;=&quot;)  };
<a name="l1976"><span class="linenum">1976</span></a>  var TOK_LT =     { label: &quot;&lt;&quot;,   prec:   13, re: new RegExp(&quot;^&lt;&quot;)   };
<a name="l1977"><span class="linenum">1977</span></a>  var TOK_PLUS =   { label: &quot;+&quot;,   prec:   14, re: new RegExp(&quot;^\\+&quot;), left: true };
<a name="l1978"><span class="linenum">1978</span></a>  var TOK_MINUS =  { label: &quot;-&quot;,   prec:   14, re: new RegExp(&quot;^\\-&quot;), left: true };
<a name="l1979"><span class="linenum">1979</span></a>  var TOK_DIV =    { label: &quot;div&quot;, prec:   15, re: new RegExp(&quot;^div\\b&quot;), left: true };
<a name="l1980"><span class="linenum">1980</span></a>  var TOK_MOD =    { label: &quot;mod&quot;, prec:   15, re: new RegExp(&quot;^mod\\b&quot;), left: true };
<a name="l1981"><span class="linenum">1981</span></a>  
<a name="l1982"><span class="linenum">1982</span></a>  var TOK_BRACKO = { label: &quot;[&quot;,   prec:   32, re: new RegExp(&quot;^\\[&quot;) };
<a name="l1983"><span class="linenum">1983</span></a>  var TOK_BRACKC = { label: &quot;]&quot;,               re: new RegExp(&quot;^\\]&quot;) };
<a name="l1984"><span class="linenum">1984</span></a>  var TOK_DOLLAR = { label: &quot;$&quot;,               re: new RegExp(&quot;^\\$&quot;) };
<a name="l1985"><span class="linenum">1985</span></a>  
<a name="l1986"><span class="linenum">1986</span></a>  var TOK_NCNAME = { label: &quot;[ncname]&quot;, re: new RegExp('^' + XML_NC_NAME) };
<a name="l1987"><span class="linenum">1987</span></a>  
<a name="l1988"><span class="linenum">1988</span></a>  var TOK_ASTERISK = { label: &quot;*&quot;, prec: 15, re: new RegExp(&quot;^\\*&quot;), left: true };
<a name="l1989"><span class="linenum">1989</span></a>  var TOK_LITERALQ = { label: &quot;[litq]&quot;, prec: 20, re: new RegExp(&quot;^'[^\\']*'&quot;) };
<a name="l1990"><span class="linenum">1990</span></a>  var TOK_LITERALQQ = {
<a name="l1991"><span class="linenum">1991</span></a>    label: &quot;[litqq]&quot;,
<a name="l1992"><span class="linenum">1992</span></a>    prec: 20,
<a name="l1993"><span class="linenum">1993</span></a>    re: new RegExp('^&quot;[^\\&quot;]*&quot;')
<a name="l1994"><span class="linenum">1994</span></a>  };
<a name="l1995"><span class="linenum">1995</span></a>  
<a name="l1996"><span class="linenum">1996</span></a>  var TOK_NUMBER  = {
<a name="l1997"><span class="linenum">1997</span></a>    label: &quot;[number]&quot;,
<a name="l1998"><span class="linenum">1998</span></a>    prec: 35,
<a name="l1999"><span class="linenum">1999</span></a>    re: new RegExp('^\\d+(\\.\\d*)?') };
<a name="l2000"><span class="linenum">2000</span></a>  
<a name="l2001"><span class="linenum">2001</span></a>  var TOK_QNAME = {
<a name="l2002"><span class="linenum">2002</span></a>    label: &quot;[qname]&quot;,
<a name="l2003"><span class="linenum">2003</span></a>    re: new RegExp('^(' + XML_NC_NAME + ':)?' + XML_NC_NAME)
<a name="l2004"><span class="linenum">2004</span></a>  };
<a name="l2005"><span class="linenum">2005</span></a>  
<a name="l2006"><span class="linenum">2006</span></a>  var TOK_NODEO = {
<a name="l2007"><span class="linenum">2007</span></a>    label: &quot;[nodetest-start]&quot;,
<a name="l2008"><span class="linenum">2008</span></a>    re: new RegExp('^(processing-instruction|comment|text|node)\\(')
<a name="l2009"><span class="linenum">2009</span></a>  };
<a name="l2010"><span class="linenum">2010</span></a>  
<a name="l2011"><span class="linenum">2011</span></a>  <span class="comment">// The table of the tokens of our grammar, used by the lexer: first</span>
<a name="l2012"><span class="linenum">2012</span></a>  <span class="comment">// column the tag, second column a regexp to recognize it in the</span>
<a name="l2013"><span class="linenum">2013</span></a>  <span class="comment">// input, third column the precedence of the token, fourth column a</span>
<a name="l2014"><span class="linenum">2014</span></a>  <span class="comment">// factory function for the semantic value of the token.</span>
<a name="l2015"><span class="linenum">2015</span></a>  <span class="comment">//</span>
<a name="l2016"><span class="linenum">2016</span></a>  <span class="comment">// NOTE: order of this list is important, because the first match</span>
<a name="l2017"><span class="linenum">2017</span></a>  <span class="comment">// counts. Cf. DDOT and DOT, and AXIS and COLON.</span>
<a name="l2018"><span class="linenum">2018</span></a>  
<a name="l2019"><span class="linenum">2019</span></a>  var xpathTokenRules = [
<a name="l2020"><span class="linenum">2020</span></a>      TOK_DSLASH,
<a name="l2021"><span class="linenum">2021</span></a>      TOK_SLASH,
<a name="l2022"><span class="linenum">2022</span></a>      TOK_DDOT,
<a name="l2023"><span class="linenum">2023</span></a>      TOK_DOT,
<a name="l2024"><span class="linenum">2024</span></a>      TOK_AXIS,
<a name="l2025"><span class="linenum">2025</span></a>      TOK_COLON,
<a name="l2026"><span class="linenum">2026</span></a>      TOK_AXISNAME,
<a name="l2027"><span class="linenum">2027</span></a>      TOK_NODEO,
<a name="l2028"><span class="linenum">2028</span></a>      TOK_PARENO,
<a name="l2029"><span class="linenum">2029</span></a>      TOK_PARENC,
<a name="l2030"><span class="linenum">2030</span></a>      TOK_BRACKO,
<a name="l2031"><span class="linenum">2031</span></a>      TOK_BRACKC,
<a name="l2032"><span class="linenum">2032</span></a>      TOK_AT,
<a name="l2033"><span class="linenum">2033</span></a>      TOK_COMMA,
<a name="l2034"><span class="linenum">2034</span></a>      TOK_OR,
<a name="l2035"><span class="linenum">2035</span></a>      TOK_AND,
<a name="l2036"><span class="linenum">2036</span></a>      TOK_NEQ,
<a name="l2037"><span class="linenum">2037</span></a>      TOK_EQ,
<a name="l2038"><span class="linenum">2038</span></a>      TOK_GE,
<a name="l2039"><span class="linenum">2039</span></a>      TOK_GT,
<a name="l2040"><span class="linenum">2040</span></a>      TOK_LE,
<a name="l2041"><span class="linenum">2041</span></a>      TOK_LT,
<a name="l2042"><span class="linenum">2042</span></a>      TOK_PLUS,
<a name="l2043"><span class="linenum">2043</span></a>      TOK_MINUS,
<a name="l2044"><span class="linenum">2044</span></a>      TOK_ASTERISK,
<a name="l2045"><span class="linenum">2045</span></a>      TOK_PIPE,
<a name="l2046"><span class="linenum">2046</span></a>      TOK_MOD,
<a name="l2047"><span class="linenum">2047</span></a>      TOK_DIV,
<a name="l2048"><span class="linenum">2048</span></a>      TOK_LITERALQ,
<a name="l2049"><span class="linenum">2049</span></a>      TOK_LITERALQQ,
<a name="l2050"><span class="linenum">2050</span></a>      TOK_NUMBER,
<a name="l2051"><span class="linenum">2051</span></a>      TOK_QNAME,
<a name="l2052"><span class="linenum">2052</span></a>      TOK_NCNAME,
<a name="l2053"><span class="linenum">2053</span></a>      TOK_DOLLAR
<a name="l2054"><span class="linenum">2054</span></a>  ];
<a name="l2055"><span class="linenum">2055</span></a>  
<a name="l2056"><span class="linenum">2056</span></a>  <span class="comment">// All the nonterminals of the grammar. The nonterminal objects are</span>
<a name="l2057"><span class="linenum">2057</span></a>  <span class="comment">// identified by object identity; the labels are used in the debug</span>
<a name="l2058"><span class="linenum">2058</span></a>  <span class="comment">// output only.</span>
<a name="l2059"><span class="linenum">2059</span></a>  var XPathLocationPath = { label: &quot;LocationPath&quot; };
<a name="l2060"><span class="linenum">2060</span></a>  var XPathRelativeLocationPath = { label: &quot;RelativeLocationPath&quot; };
<a name="l2061"><span class="linenum">2061</span></a>  var XPathAbsoluteLocationPath = { label: &quot;AbsoluteLocationPath&quot; };
<a name="l2062"><span class="linenum">2062</span></a>  var XPathStep = { label: &quot;Step&quot; };
<a name="l2063"><span class="linenum">2063</span></a>  var XPathNodeTest = { label: &quot;NodeTest&quot; };
<a name="l2064"><span class="linenum">2064</span></a>  var XPathPredicate = { label: &quot;Predicate&quot; };
<a name="l2065"><span class="linenum">2065</span></a>  var XPathLiteral = { label: &quot;Literal&quot; };
<a name="l2066"><span class="linenum">2066</span></a>  var XPathExpr = { label: &quot;Expr&quot; };
<a name="l2067"><span class="linenum">2067</span></a>  var XPathPrimaryExpr = { label: &quot;PrimaryExpr&quot; };
<a name="l2068"><span class="linenum">2068</span></a>  var XPathVariableReference = { label: &quot;Variablereference&quot; };
<a name="l2069"><span class="linenum">2069</span></a>  var XPathNumber = { label: &quot;Number&quot; };
<a name="l2070"><span class="linenum">2070</span></a>  var XPathFunctionCall = { label: &quot;FunctionCall&quot; };
<a name="l2071"><span class="linenum">2071</span></a>  var XPathArgumentRemainder = { label: &quot;ArgumentRemainder&quot; };
<a name="l2072"><span class="linenum">2072</span></a>  var XPathPathExpr = { label: &quot;PathExpr&quot; };
<a name="l2073"><span class="linenum">2073</span></a>  var XPathUnionExpr = { label: &quot;UnionExpr&quot; };
<a name="l2074"><span class="linenum">2074</span></a>  var XPathFilterExpr = { label: &quot;FilterExpr&quot; };
<a name="l2075"><span class="linenum">2075</span></a>  var XPathDigits = { label: &quot;Digits&quot; };
<a name="l2076"><span class="linenum">2076</span></a>  
<a name="l2077"><span class="linenum">2077</span></a>  var xpathNonTerminals = [
<a name="l2078"><span class="linenum">2078</span></a>      XPathLocationPath,
<a name="l2079"><span class="linenum">2079</span></a>      XPathRelativeLocationPath,
<a name="l2080"><span class="linenum">2080</span></a>      XPathAbsoluteLocationPath,
<a name="l2081"><span class="linenum">2081</span></a>      XPathStep,
<a name="l2082"><span class="linenum">2082</span></a>      XPathNodeTest,
<a name="l2083"><span class="linenum">2083</span></a>      XPathPredicate,
<a name="l2084"><span class="linenum">2084</span></a>      XPathLiteral,
<a name="l2085"><span class="linenum">2085</span></a>      XPathExpr,
<a name="l2086"><span class="linenum">2086</span></a>      XPathPrimaryExpr,
<a name="l2087"><span class="linenum">2087</span></a>      XPathVariableReference,
<a name="l2088"><span class="linenum">2088</span></a>      XPathNumber,
<a name="l2089"><span class="linenum">2089</span></a>      XPathFunctionCall,
<a name="l2090"><span class="linenum">2090</span></a>      XPathArgumentRemainder,
<a name="l2091"><span class="linenum">2091</span></a>      XPathPathExpr,
<a name="l2092"><span class="linenum">2092</span></a>      XPathUnionExpr,
<a name="l2093"><span class="linenum">2093</span></a>      XPathFilterExpr,
<a name="l2094"><span class="linenum">2094</span></a>      XPathDigits
<a name="l2095"><span class="linenum">2095</span></a>  ];
<a name="l2096"><span class="linenum">2096</span></a>  
<a name="l2097"><span class="linenum">2097</span></a>  <span class="comment">// Quantifiers that are used in the productions of the grammar.</span>
<a name="l2098"><span class="linenum">2098</span></a>  var Q_01 = { label: &quot;?&quot; };
<a name="l2099"><span class="linenum">2099</span></a>  var Q_MM = { label: &quot;*&quot; };
<a name="l2100"><span class="linenum">2100</span></a>  var Q_1M = { label: &quot;+&quot; };
<a name="l2101"><span class="linenum">2101</span></a>  
<a name="l2102"><span class="linenum">2102</span></a>  <span class="comment">// Tag for left associativity (right assoc is implied by undefined).</span>
<a name="l2103"><span class="linenum">2103</span></a>  var ASSOC_LEFT = true;
<a name="l2104"><span class="linenum">2104</span></a>  
<a name="l2105"><span class="linenum">2105</span></a>  <span class="comment">// The productions of the grammar. Columns of the table:</span>
<a name="l2106"><span class="linenum">2106</span></a>  <span class="comment">//</span>
<a name="l2107"><span class="linenum">2107</span></a>  <span class="comment">// - target nonterminal,</span>
<a name="l2108"><span class="linenum">2108</span></a>  <span class="comment">// - pattern,</span>
<a name="l2109"><span class="linenum">2109</span></a>  <span class="comment">// - precedence,</span>
<a name="l2110"><span class="linenum">2110</span></a>  <span class="comment">// - semantic value factory</span>
<a name="l2111"><span class="linenum">2111</span></a>  <span class="comment">//</span>
<a name="l2112"><span class="linenum">2112</span></a>  <span class="comment">// The semantic value factory is a function that receives parse tree</span>
<a name="l2113"><span class="linenum">2113</span></a>  <span class="comment">// nodes from the stack frames of the matched symbols as arguments and</span>
<a name="l2114"><span class="linenum">2114</span></a>  <span class="comment">// returns an a node of the parse tree. The node is stored in the top</span>
<a name="l2115"><span class="linenum">2115</span></a>  <span class="comment">// stack frame along with the target object of the rule. The node in</span>
<a name="l2116"><span class="linenum">2116</span></a>  <span class="comment">// the parse tree is an expression object that has an evaluate() method</span>
<a name="l2117"><span class="linenum">2117</span></a>  <span class="comment">// and thus evaluates XPath expressions.</span>
<a name="l2118"><span class="linenum">2118</span></a>  <span class="comment">//</span>
<a name="l2119"><span class="linenum">2119</span></a>  <span class="comment">// The precedence is used to decide between reducing and shifting by</span>
<a name="l2120"><span class="linenum">2120</span></a>  <span class="comment">// comparing the precendence of the rule that is candidate for</span>
<a name="l2121"><span class="linenum">2121</span></a>  <span class="comment">// reducing with the precedence of the look ahead token. Precedence of</span>
<a name="l2122"><span class="linenum">2122</span></a>  <span class="comment">// -1 means that the precedence of the tokens in the pattern is used</span>
<a name="l2123"><span class="linenum">2123</span></a>  <span class="comment">// instead. TODO: It shouldn't be necessary to explicitly assign</span>
<a name="l2124"><span class="linenum">2124</span></a>  <span class="comment">// precedences to rules.</span>
<a name="l2125"><span class="linenum">2125</span></a>  
<a name="l2126"><span class="linenum">2126</span></a>  var xpathGrammarRules =
<a name="l2127"><span class="linenum">2127</span></a>    [
<a name="l2128"><span class="linenum">2128</span></a>     [ XPathLocationPath, [ XPathRelativeLocationPath ], 18,
<a name="l2129"><span class="linenum">2129</span></a>       passExpr ],
<a name="l2130"><span class="linenum">2130</span></a>     [ XPathLocationPath, [ XPathAbsoluteLocationPath ], 18,
<a name="l2131"><span class="linenum">2131</span></a>       passExpr ],
<a name="l2132"><span class="linenum">2132</span></a>  
<a name="l2133"><span class="linenum">2133</span></a>     [ XPathAbsoluteLocationPath, [ TOK_SLASH, XPathRelativeLocationPath ], 18,
<a name="l2134"><span class="linenum">2134</span></a>       makeLocationExpr1 ],
<a name="l2135"><span class="linenum">2135</span></a>     [ XPathAbsoluteLocationPath, [ TOK_DSLASH, XPathRelativeLocationPath ], 18,
<a name="l2136"><span class="linenum">2136</span></a>       makeLocationExpr2 ],
<a name="l2137"><span class="linenum">2137</span></a>  
<a name="l2138"><span class="linenum">2138</span></a>     [ XPathAbsoluteLocationPath, [ TOK_SLASH ], 0,
<a name="l2139"><span class="linenum">2139</span></a>       makeLocationExpr3 ],
<a name="l2140"><span class="linenum">2140</span></a>     [ XPathAbsoluteLocationPath, [ TOK_DSLASH ], 0,
<a name="l2141"><span class="linenum">2141</span></a>       makeLocationExpr4 ],
<a name="l2142"><span class="linenum">2142</span></a>  
<a name="l2143"><span class="linenum">2143</span></a>     [ XPathRelativeLocationPath, [ XPathStep ], 31,
<a name="l2144"><span class="linenum">2144</span></a>       makeLocationExpr5 ],
<a name="l2145"><span class="linenum">2145</span></a>     [ XPathRelativeLocationPath,
<a name="l2146"><span class="linenum">2146</span></a>       [ XPathRelativeLocationPath, TOK_SLASH, XPathStep ], 31,
<a name="l2147"><span class="linenum">2147</span></a>       makeLocationExpr6 ],
<a name="l2148"><span class="linenum">2148</span></a>     [ XPathRelativeLocationPath,
<a name="l2149"><span class="linenum">2149</span></a>       [ XPathRelativeLocationPath, TOK_DSLASH, XPathStep ], 31,
<a name="l2150"><span class="linenum">2150</span></a>       makeLocationExpr7 ],
<a name="l2151"><span class="linenum">2151</span></a>  
<a name="l2152"><span class="linenum">2152</span></a>     [ XPathStep, [ TOK_DOT ], 33,
<a name="l2153"><span class="linenum">2153</span></a>       makeStepExpr1 ],
<a name="l2154"><span class="linenum">2154</span></a>     [ XPathStep, [ TOK_DDOT ], 33,
<a name="l2155"><span class="linenum">2155</span></a>       makeStepExpr2 ],
<a name="l2156"><span class="linenum">2156</span></a>     [ XPathStep,
<a name="l2157"><span class="linenum">2157</span></a>       [ TOK_AXISNAME, TOK_AXIS, XPathNodeTest ], 33,
<a name="l2158"><span class="linenum">2158</span></a>       makeStepExpr3 ],
<a name="l2159"><span class="linenum">2159</span></a>     [ XPathStep, [ TOK_AT, XPathNodeTest ], 33,
<a name="l2160"><span class="linenum">2160</span></a>       makeStepExpr4 ],
<a name="l2161"><span class="linenum">2161</span></a>     [ XPathStep, [ XPathNodeTest ], 33,
<a name="l2162"><span class="linenum">2162</span></a>       makeStepExpr5 ],
<a name="l2163"><span class="linenum">2163</span></a>     [ XPathStep, [ XPathStep, XPathPredicate ], 33,
<a name="l2164"><span class="linenum">2164</span></a>       makeStepExpr6 ],
<a name="l2165"><span class="linenum">2165</span></a>  
<a name="l2166"><span class="linenum">2166</span></a>     [ XPathNodeTest, [ TOK_ASTERISK ], 33,
<a name="l2167"><span class="linenum">2167</span></a>       makeNodeTestExpr1 ],
<a name="l2168"><span class="linenum">2168</span></a>     [ XPathNodeTest, [ TOK_NCNAME, TOK_COLON, TOK_ASTERISK ], 33,
<a name="l2169"><span class="linenum">2169</span></a>       makeNodeTestExpr2 ],
<a name="l2170"><span class="linenum">2170</span></a>     [ XPathNodeTest, [ TOK_QNAME ], 33,
<a name="l2171"><span class="linenum">2171</span></a>       makeNodeTestExpr3 ],
<a name="l2172"><span class="linenum">2172</span></a>     [ XPathNodeTest, [ TOK_NODEO, TOK_PARENC ], 33,
<a name="l2173"><span class="linenum">2173</span></a>       makeNodeTestExpr4 ],
<a name="l2174"><span class="linenum">2174</span></a>     [ XPathNodeTest, [ TOK_NODEO, XPathLiteral, TOK_PARENC ], 33,
<a name="l2175"><span class="linenum">2175</span></a>       makeNodeTestExpr5 ],
<a name="l2176"><span class="linenum">2176</span></a>  
<a name="l2177"><span class="linenum">2177</span></a>     [ XPathPredicate, [ TOK_BRACKO, XPathExpr, TOK_BRACKC ], 33,
<a name="l2178"><span class="linenum">2178</span></a>       makePredicateExpr ],
<a name="l2179"><span class="linenum">2179</span></a>  
<a name="l2180"><span class="linenum">2180</span></a>     [ XPathPrimaryExpr, [ XPathVariableReference ], 33,
<a name="l2181"><span class="linenum">2181</span></a>       passExpr ],
<a name="l2182"><span class="linenum">2182</span></a>     [ XPathPrimaryExpr, [ TOK_PARENO, XPathExpr, TOK_PARENC ], 33,
<a name="l2183"><span class="linenum">2183</span></a>       makePrimaryExpr ],
<a name="l2184"><span class="linenum">2184</span></a>     [ XPathPrimaryExpr, [ XPathLiteral ], 30,
<a name="l2185"><span class="linenum">2185</span></a>       passExpr ],
<a name="l2186"><span class="linenum">2186</span></a>     [ XPathPrimaryExpr, [ XPathNumber ], 30,
<a name="l2187"><span class="linenum">2187</span></a>       passExpr ],
<a name="l2188"><span class="linenum">2188</span></a>     [ XPathPrimaryExpr, [ XPathFunctionCall ], 30,
<a name="l2189"><span class="linenum">2189</span></a>       passExpr ],
<a name="l2190"><span class="linenum">2190</span></a>  
<a name="l2191"><span class="linenum">2191</span></a>     [ XPathFunctionCall, [ TOK_QNAME, TOK_PARENO, TOK_PARENC ], -1,
<a name="l2192"><span class="linenum">2192</span></a>       makeFunctionCallExpr1 ],
<a name="l2193"><span class="linenum">2193</span></a>     [ XPathFunctionCall,
<a name="l2194"><span class="linenum">2194</span></a>       [ TOK_QNAME, TOK_PARENO, XPathExpr, XPathArgumentRemainder, Q_MM,
<a name="l2195"><span class="linenum">2195</span></a>         TOK_PARENC ], -1,
<a name="l2196"><span class="linenum">2196</span></a>       makeFunctionCallExpr2 ],
<a name="l2197"><span class="linenum">2197</span></a>     [ XPathArgumentRemainder, [ TOK_COMMA, XPathExpr ], -1,
<a name="l2198"><span class="linenum">2198</span></a>       makeArgumentExpr ],
<a name="l2199"><span class="linenum">2199</span></a>  
<a name="l2200"><span class="linenum">2200</span></a>     [ XPathUnionExpr, [ XPathPathExpr ], 20,
<a name="l2201"><span class="linenum">2201</span></a>       passExpr ],
<a name="l2202"><span class="linenum">2202</span></a>     [ XPathUnionExpr, [ XPathUnionExpr, TOK_PIPE, XPathPathExpr ], 20,
<a name="l2203"><span class="linenum">2203</span></a>       makeUnionExpr ],
<a name="l2204"><span class="linenum">2204</span></a>  
<a name="l2205"><span class="linenum">2205</span></a>     [ XPathPathExpr, [ XPathLocationPath ], 20,
<a name="l2206"><span class="linenum">2206</span></a>       passExpr ],
<a name="l2207"><span class="linenum">2207</span></a>     [ XPathPathExpr, [ XPathFilterExpr ], 19,
<a name="l2208"><span class="linenum">2208</span></a>       passExpr ],
<a name="l2209"><span class="linenum">2209</span></a>     [ XPathPathExpr,
<a name="l2210"><span class="linenum">2210</span></a>       [ XPathFilterExpr, TOK_SLASH, XPathRelativeLocationPath ], 20,
<a name="l2211"><span class="linenum">2211</span></a>       makePathExpr1 ],
<a name="l2212"><span class="linenum">2212</span></a>     [ XPathPathExpr,
<a name="l2213"><span class="linenum">2213</span></a>       [ XPathFilterExpr, TOK_DSLASH, XPathRelativeLocationPath ], 20,
<a name="l2214"><span class="linenum">2214</span></a>       makePathExpr2 ],
<a name="l2215"><span class="linenum">2215</span></a>  
<a name="l2216"><span class="linenum">2216</span></a>     [ XPathFilterExpr, [ XPathPrimaryExpr, XPathPredicate, Q_MM ], 20,
<a name="l2217"><span class="linenum">2217</span></a>       makeFilterExpr ],
<a name="l2218"><span class="linenum">2218</span></a>  
<a name="l2219"><span class="linenum">2219</span></a>     [ XPathExpr, [ XPathPrimaryExpr ], 16,
<a name="l2220"><span class="linenum">2220</span></a>       passExpr ],
<a name="l2221"><span class="linenum">2221</span></a>     [ XPathExpr, [ XPathUnionExpr ], 16,
<a name="l2222"><span class="linenum">2222</span></a>       passExpr ],
<a name="l2223"><span class="linenum">2223</span></a>  
<a name="l2224"><span class="linenum">2224</span></a>     [ XPathExpr, [ TOK_MINUS, XPathExpr ], -1,
<a name="l2225"><span class="linenum">2225</span></a>       makeUnaryMinusExpr ],
<a name="l2226"><span class="linenum">2226</span></a>  
<a name="l2227"><span class="linenum">2227</span></a>     [ XPathExpr, [ XPathExpr, TOK_OR, XPathExpr ], -1,
<a name="l2228"><span class="linenum">2228</span></a>       makeBinaryExpr ],
<a name="l2229"><span class="linenum">2229</span></a>     [ XPathExpr, [ XPathExpr, TOK_AND, XPathExpr ], -1,
<a name="l2230"><span class="linenum">2230</span></a>       makeBinaryExpr ],
<a name="l2231"><span class="linenum">2231</span></a>  
<a name="l2232"><span class="linenum">2232</span></a>     [ XPathExpr, [ XPathExpr, TOK_EQ, XPathExpr ], -1,
<a name="l2233"><span class="linenum">2233</span></a>       makeBinaryExpr ],
<a name="l2234"><span class="linenum">2234</span></a>     [ XPathExpr, [ XPathExpr, TOK_NEQ, XPathExpr ], -1,
<a name="l2235"><span class="linenum">2235</span></a>       makeBinaryExpr ],
<a name="l2236"><span class="linenum">2236</span></a>  
<a name="l2237"><span class="linenum">2237</span></a>     [ XPathExpr, [ XPathExpr, TOK_LT, XPathExpr ], -1,
<a name="l2238"><span class="linenum">2238</span></a>       makeBinaryExpr ],
<a name="l2239"><span class="linenum">2239</span></a>     [ XPathExpr, [ XPathExpr, TOK_LE, XPathExpr ], -1,
<a name="l2240"><span class="linenum">2240</span></a>       makeBinaryExpr ],
<a name="l2241"><span class="linenum">2241</span></a>     [ XPathExpr, [ XPathExpr, TOK_GT, XPathExpr ], -1,
<a name="l2242"><span class="linenum">2242</span></a>       makeBinaryExpr ],
<a name="l2243"><span class="linenum">2243</span></a>     [ XPathExpr, [ XPathExpr, TOK_GE, XPathExpr ], -1,
<a name="l2244"><span class="linenum">2244</span></a>       makeBinaryExpr ],
<a name="l2245"><span class="linenum">2245</span></a>  
<a name="l2246"><span class="linenum">2246</span></a>     [ XPathExpr, [ XPathExpr, TOK_PLUS, XPathExpr ], -1,
<a name="l2247"><span class="linenum">2247</span></a>       makeBinaryExpr, ASSOC_LEFT ],
<a name="l2248"><span class="linenum">2248</span></a>     [ XPathExpr, [ XPathExpr, TOK_MINUS, XPathExpr ], -1,
<a name="l2249"><span class="linenum">2249</span></a>       makeBinaryExpr, ASSOC_LEFT ],
<a name="l2250"><span class="linenum">2250</span></a>  
<a name="l2251"><span class="linenum">2251</span></a>     [ XPathExpr, [ XPathExpr, TOK_ASTERISK, XPathExpr ], -1,
<a name="l2252"><span class="linenum">2252</span></a>       makeBinaryExpr, ASSOC_LEFT ],
<a name="l2253"><span class="linenum">2253</span></a>     [ XPathExpr, [ XPathExpr, TOK_DIV, XPathExpr ], -1,
<a name="l2254"><span class="linenum">2254</span></a>       makeBinaryExpr, ASSOC_LEFT ],
<a name="l2255"><span class="linenum">2255</span></a>     [ XPathExpr, [ XPathExpr, TOK_MOD, XPathExpr ], -1,
<a name="l2256"><span class="linenum">2256</span></a>       makeBinaryExpr, ASSOC_LEFT ],
<a name="l2257"><span class="linenum">2257</span></a>  
<a name="l2258"><span class="linenum">2258</span></a>     [ XPathLiteral, [ TOK_LITERALQ ], -1,
<a name="l2259"><span class="linenum">2259</span></a>       makeLiteralExpr ],
<a name="l2260"><span class="linenum">2260</span></a>     [ XPathLiteral, [ TOK_LITERALQQ ], -1,
<a name="l2261"><span class="linenum">2261</span></a>       makeLiteralExpr ],
<a name="l2262"><span class="linenum">2262</span></a>  
<a name="l2263"><span class="linenum">2263</span></a>     [ XPathNumber, [ TOK_NUMBER ], -1,
<a name="l2264"><span class="linenum">2264</span></a>       makeNumberExpr ],
<a name="l2265"><span class="linenum">2265</span></a>  
<a name="l2266"><span class="linenum">2266</span></a>     [ XPathVariableReference, [ TOK_DOLLAR, TOK_QNAME ], 200,
<a name="l2267"><span class="linenum">2267</span></a>       makeVariableReference ]
<a name="l2268"><span class="linenum">2268</span></a>     ];
<a name="l2269"><span class="linenum">2269</span></a>  
<a name="l2270"><span class="linenum">2270</span></a>  <span class="comment">// That function computes some optimizations of the above data</span>
<a name="l2271"><span class="linenum">2271</span></a>  <span class="comment">// structures and will be called right here. It merely takes the</span>
<a name="l2272"><span class="linenum">2272</span></a>  <span class="comment">// counter variables out of the global scope.</span>
<a name="l2273"><span class="linenum">2273</span></a>  
<a name="l2274"><span class="linenum">2274</span></a>  var xpathRules = [];
<a name="l2275"><span class="linenum">2275</span></a>  
<a name="l2276"><span class="linenum">2276</span></a>  function <a class="function" onClick="logFunction('xpathParseInit')" href="../../_functions/xpathparseinit.html" onMouseOver="funcPopup(event,'xpathparseinit')">xpathParseInit</a>() {
<a name="l2277"><span class="linenum">2277</span></a>    if (xpathRules.length) {
<a name="l2278"><span class="linenum">2278</span></a>      return;
<a name="l2279"><span class="linenum">2279</span></a>    }
<a name="l2280"><span class="linenum">2280</span></a>  
<a name="l2281"><span class="linenum">2281</span></a>  <span class="comment">  // Some simple optimizations for the xpath expression parser: sort</span>
<a name="l2282"><span class="linenum">2282</span></a>  <span class="comment">  // grammar rules descending by length, so that the longest match is</span>
<a name="l2283"><span class="linenum">2283</span></a>  <span class="comment">  // first found.</span>
<a name="l2284"><span class="linenum">2284</span></a>  
<a name="l2285"><span class="linenum">2285</span></a>    xpathGrammarRules.<a class="phpfunction" onClick="logFunction('sort')" href="../../_functions/sort.html" onMouseOver="phpfuncPopup(event,'sort')">sort</a>(function(a,b) {
<a name="l2286"><span class="linenum">2286</span></a>      var la = a[1].length;
<a name="l2287"><span class="linenum">2287</span></a>      var lb = b[1].length;
<a name="l2288"><span class="linenum">2288</span></a>      if (la &lt; lb) {
<a name="l2289"><span class="linenum">2289</span></a>        return 1;
<a name="l2290"><span class="linenum">2290</span></a>      } else if (la &gt; lb) {
<a name="l2291"><span class="linenum">2291</span></a>        return -1;
<a name="l2292"><span class="linenum">2292</span></a>      } else {
<a name="l2293"><span class="linenum">2293</span></a>        return 0;
<a name="l2294"><span class="linenum">2294</span></a>      }
<a name="l2295"><span class="linenum">2295</span></a>    });
<a name="l2296"><span class="linenum">2296</span></a>  
<a name="l2297"><span class="linenum">2297</span></a>    var k = 1;
<a name="l2298"><span class="linenum">2298</span></a>    for (var i = 0; i &lt; xpathNonTerminals.length; ++i) {
<a name="l2299"><span class="linenum">2299</span></a>      xpathNonTerminals[i].key = k++;
<a name="l2300"><span class="linenum">2300</span></a>    }
<a name="l2301"><span class="linenum">2301</span></a>  
<a name="l2302"><span class="linenum">2302</span></a>    for (i = 0; i &lt; xpathTokenRules.length; ++i) {
<a name="l2303"><span class="linenum">2303</span></a>      xpathTokenRules[i].key = k++;
<a name="l2304"><span class="linenum">2304</span></a>    }
<a name="l2305"><span class="linenum">2305</span></a>  
<a name="l2306"><span class="linenum">2306</span></a>    <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('XPath parse INIT: ' + k + ' rules');
<a name="l2307"><span class="linenum">2307</span></a>  
<a name="l2308"><span class="linenum">2308</span></a>  <span class="comment">  // Another slight optimization: sort the rules into bins according</span>
<a name="l2309"><span class="linenum">2309</span></a>  <span class="comment">  // to the last element (observing quantifiers), so we can restrict</span>
<a name="l2310"><span class="linenum">2310</span></a>  <span class="comment">  // the match against the stack to the subest of rules that match the</span>
<a name="l2311"><span class="linenum">2311</span></a>  <span class="comment">  // top of the stack.</span>
<a name="l2312"><span class="linenum">2312</span></a>  <span class="comment">  //</span>
<a name="l2313"><span class="linenum">2313</span></a>  <span class="comment">  // TODO(mesch): What we actually want is to compute states as in</span>
<a name="l2314"><span class="linenum">2314</span></a>  <span class="comment">  // bison, so that we don't have to do any explicit and iterated</span>
<a name="l2315"><span class="linenum">2315</span></a>  <span class="comment">  // match against the stack.</span>
<a name="l2316"><span class="linenum">2316</span></a>  
<a name="l2317"><span class="linenum">2317</span></a>    function <a class="function" onClick="logFunction('push_')" href="../../_functions/push_.html" onMouseOver="funcPopup(event,'push_')">push_</a>(array, position, element) {
<a name="l2318"><span class="linenum">2318</span></a>      if (!array[position]) {
<a name="l2319"><span class="linenum">2319</span></a>        array[position] = [];
<a name="l2320"><span class="linenum">2320</span></a>      }
<a name="l2321"><span class="linenum">2321</span></a>      array[position].push(element);
<a name="l2322"><span class="linenum">2322</span></a>    }
<a name="l2323"><span class="linenum">2323</span></a>  
<a name="l2324"><span class="linenum">2324</span></a>    for (i = 0; i &lt; xpathGrammarRules.length; ++i) {
<a name="l2325"><span class="linenum">2325</span></a>      var rule = xpathGrammarRules[i];
<a name="l2326"><span class="linenum">2326</span></a>      var pattern = rule[1];
<a name="l2327"><span class="linenum">2327</span></a>  
<a name="l2328"><span class="linenum">2328</span></a>      for (var j = pattern.length - 1; j &gt;= 0; --j) {
<a name="l2329"><span class="linenum">2329</span></a>        if (pattern[j] == Q_1M) {
<a name="l2330"><span class="linenum">2330</span></a>          <a class="function" onClick="logFunction('push_')" href="../../_functions/push_.html" onMouseOver="funcPopup(event,'push_')">push_</a>(xpathRules, pattern[j-1].key, rule);
<a name="l2331"><span class="linenum">2331</span></a>          break;
<a name="l2332"><span class="linenum">2332</span></a>  
<a name="l2333"><span class="linenum">2333</span></a>        } else if (pattern[j] == Q_MM || pattern[j] == Q_01) {
<a name="l2334"><span class="linenum">2334</span></a>          <a class="function" onClick="logFunction('push_')" href="../../_functions/push_.html" onMouseOver="funcPopup(event,'push_')">push_</a>(xpathRules, pattern[j-1].key, rule);
<a name="l2335"><span class="linenum">2335</span></a>          --j;
<a name="l2336"><span class="linenum">2336</span></a>  
<a name="l2337"><span class="linenum">2337</span></a>        } else {
<a name="l2338"><span class="linenum">2338</span></a>          <a class="function" onClick="logFunction('push_')" href="../../_functions/push_.html" onMouseOver="funcPopup(event,'push_')">push_</a>(xpathRules, pattern[j].key, rule);
<a name="l2339"><span class="linenum">2339</span></a>          break;
<a name="l2340"><span class="linenum">2340</span></a>        }
<a name="l2341"><span class="linenum">2341</span></a>      }
<a name="l2342"><span class="linenum">2342</span></a>    }
<a name="l2343"><span class="linenum">2343</span></a>  
<a name="l2344"><span class="linenum">2344</span></a>    <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('XPath parse INIT: ' + xpathRules.length + ' rule bins');
<a name="l2345"><span class="linenum">2345</span></a>  
<a name="l2346"><span class="linenum">2346</span></a>    var sum = 0;
<a name="l2347"><span class="linenum">2347</span></a>    <a class="function" onClick="logFunction('mapExec')" href="../../_functions/mapexec.html" onMouseOver="funcPopup(event,'mapexec')">mapExec</a>(xpathRules, function(i) {
<a name="l2348"><span class="linenum">2348</span></a>      if (i) {
<a name="l2349"><span class="linenum">2349</span></a>        sum += i.length;
<a name="l2350"><span class="linenum">2350</span></a>      }
<a name="l2351"><span class="linenum">2351</span></a>    });
<a name="l2352"><span class="linenum">2352</span></a>  
<a name="l2353"><span class="linenum">2353</span></a>    <a class="function" onClick="logFunction('xpathLog')" href="../../_functions/xpathlog.html" onMouseOver="funcPopup(event,'xpathlog')">xpathLog</a>('XPath parse INIT: ' + (sum / xpathRules.length) +
<a name="l2354"><span class="linenum">2354</span></a>             ' average bin size');
<a name="l2355"><span class="linenum">2355</span></a>  }
<a name="l2356"><span class="linenum">2356</span></a>  
<a name="l2357"><span class="linenum">2357</span></a>  <span class="comment">// Local utility functions that are used by the lexer or parser.</span>
<a name="l2358"><span class="linenum">2358</span></a>  
<a name="l2359"><span class="linenum">2359</span></a>  function <a class="function" onClick="logFunction('xpathCollectDescendants')" href="../../_functions/xpathcollectdescendants.html" onMouseOver="funcPopup(event,'xpathcollectdescendants')">xpathCollectDescendants</a>(nodelist, node) {
<a name="l2360"><span class="linenum">2360</span></a>    for (var n = node.firstChild; n; n = n.nextSibling) {
<a name="l2361"><span class="linenum">2361</span></a>      nodelist.push(n);
<a name="l2362"><span class="linenum">2362</span></a>      arguments.callee(nodelist, n);
<a name="l2363"><span class="linenum">2363</span></a>    }
<a name="l2364"><span class="linenum">2364</span></a>  }
<a name="l2365"><span class="linenum">2365</span></a>  
<a name="l2366"><span class="linenum">2366</span></a>  function <a class="function" onClick="logFunction('xpathCollectDescendantsReverse')" href="../../_functions/xpathcollectdescendantsreverse.html" onMouseOver="funcPopup(event,'xpathcollectdescendantsreverse')">xpathCollectDescendantsReverse</a>(nodelist, node) {
<a name="l2367"><span class="linenum">2367</span></a>    for (var n = node.lastChild; n; n = n.previousSibling) {
<a name="l2368"><span class="linenum">2368</span></a>      nodelist.push(n);
<a name="l2369"><span class="linenum">2369</span></a>      arguments.callee(nodelist, n);
<a name="l2370"><span class="linenum">2370</span></a>    }
<a name="l2371"><span class="linenum">2371</span></a>  }
<a name="l2372"><span class="linenum">2372</span></a>  
<a name="l2373"><span class="linenum">2373</span></a>  
<a name="l2374"><span class="linenum">2374</span></a>  <span class="comment">// The entry point for the library: match an expression against a DOM</span>
<a name="l2375"><span class="linenum">2375</span></a>  <span class="comment">// node. Returns an XPath value.</span>
<a name="l2376"><span class="linenum">2376</span></a>  function <a class="function" onClick="logFunction('xpathDomEval')" href="../../_functions/xpathdomeval.html" onMouseOver="funcPopup(event,'xpathdomeval')">xpathDomEval</a>(expr, node) {
<a name="l2377"><span class="linenum">2377</span></a>    var expr1 = <a class="function" onClick="logFunction('xpathParse')" href="../../_functions/xpathparse.html" onMouseOver="funcPopup(event,'xpathparse')">xpathParse</a>(expr);
<a name="l2378"><span class="linenum">2378</span></a>    var ret = expr1.evaluate(new <a class="function" onClick="logFunction('ExprContext')" href="../../_functions/exprcontext.html" onMouseOver="funcPopup(event,'exprcontext')">ExprContext</a>(node));
<a name="l2379"><span class="linenum">2379</span></a>    return ret;
<a name="l2380"><span class="linenum">2380</span></a>  }
<a name="l2381"><span class="linenum">2381</span></a>  
<a name="l2382"><span class="linenum">2382</span></a>  <span class="comment">// Utility function to sort a list of nodes. Used by xsltSort() and</span>
<a name="l2383"><span class="linenum">2383</span></a>  <span class="comment">// nxslSelect().</span>
<a name="l2384"><span class="linenum">2384</span></a>  function <a class="function" onClick="logFunction('xpathSort')" href="../../_functions/xpathsort.html" onMouseOver="funcPopup(event,'xpathsort')">xpathSort</a>(input, sort) {
<a name="l2385"><span class="linenum">2385</span></a>    if (sort.length == 0) {
<a name="l2386"><span class="linenum">2386</span></a>      return;
<a name="l2387"><span class="linenum">2387</span></a>    }
<a name="l2388"><span class="linenum">2388</span></a>  
<a name="l2389"><span class="linenum">2389</span></a>    var sortlist = [];
<a name="l2390"><span class="linenum">2390</span></a>  
<a name="l2391"><span class="linenum">2391</span></a>    for (var i = 0; i &lt; input.contextSize(); ++i) {
<a name="l2392"><span class="linenum">2392</span></a>      var node = input.nodelist[i];
<a name="l2393"><span class="linenum">2393</span></a>      var sortitem = { node: node, key: [] };
<a name="l2394"><span class="linenum">2394</span></a>      var context = input.<a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(node, 0, [ node ]);
<a name="l2395"><span class="linenum">2395</span></a>  
<a name="l2396"><span class="linenum">2396</span></a>      for (var j = 0; j &lt; sort.length; ++j) {
<a name="l2397"><span class="linenum">2397</span></a>        var s = sort[j];
<a name="l2398"><span class="linenum">2398</span></a>        var value = s.expr.evaluate(context);
<a name="l2399"><span class="linenum">2399</span></a>  
<a name="l2400"><span class="linenum">2400</span></a>        var evalue;
<a name="l2401"><span class="linenum">2401</span></a>        if (s.type == 'text') {
<a name="l2402"><span class="linenum">2402</span></a>          evalue = value.<a class="function" onClick="logFunction('stringValue')" href="../../_functions/stringvalue.html" onMouseOver="funcPopup(event,'stringvalue')">stringValue</a>();
<a name="l2403"><span class="linenum">2403</span></a>        } else if (s.type == 'number') {
<a name="l2404"><span class="linenum">2404</span></a>          evalue = value.<a class="function" onClick="logFunction('numberValue')" href="../../_functions/numbervalue.html" onMouseOver="funcPopup(event,'numbervalue')">numberValue</a>();
<a name="l2405"><span class="linenum">2405</span></a>        }
<a name="l2406"><span class="linenum">2406</span></a>        sortitem.key.push({ value: evalue, order: s.order });
<a name="l2407"><span class="linenum">2407</span></a>      }
<a name="l2408"><span class="linenum">2408</span></a>  
<a name="l2409"><span class="linenum">2409</span></a>  <span class="comment">    // Make the sort stable by adding a lowest priority sort by</span>
<a name="l2410"><span class="linenum">2410</span></a>  <span class="comment">    // id. This is very convenient and furthermore required by the</span>
<a name="l2411"><span class="linenum">2411</span></a>  <span class="comment">    // spec ([XSLT] - Section 10 Sorting).</span>
<a name="l2412"><span class="linenum">2412</span></a>      sortitem.key.push({ value: i, order: 'ascending' });
<a name="l2413"><span class="linenum">2413</span></a>  
<a name="l2414"><span class="linenum">2414</span></a>      sortlist.push(sortitem);
<a name="l2415"><span class="linenum">2415</span></a>    }
<a name="l2416"><span class="linenum">2416</span></a>  
<a name="l2417"><span class="linenum">2417</span></a>    sortlist.<a class="phpfunction" onClick="logFunction('sort')" href="../../_functions/sort.html" onMouseOver="phpfuncPopup(event,'sort')">sort</a>(xpathSortByKey);
<a name="l2418"><span class="linenum">2418</span></a>  
<a name="l2419"><span class="linenum">2419</span></a>    var nodes = [];
<a name="l2420"><span class="linenum">2420</span></a>    for (var i = 0; i &lt; sortlist.length; ++i) {
<a name="l2421"><span class="linenum">2421</span></a>      nodes.push(sortlist[i].node);
<a name="l2422"><span class="linenum">2422</span></a>    }
<a name="l2423"><span class="linenum">2423</span></a>    input.nodelist = nodes;
<a name="l2424"><span class="linenum">2424</span></a>    input.setNode(0);
<a name="l2425"><span class="linenum">2425</span></a>  }
<a name="l2426"><span class="linenum">2426</span></a>  
<a name="l2427"><span class="linenum">2427</span></a>  
<a name="l2428"><span class="linenum">2428</span></a>  <span class="comment">// Sorts by all order criteria defined. According to the JavaScript</span>
<a name="l2429"><span class="linenum">2429</span></a>  <span class="comment">// spec ([ECMA] Section 11.8.5), the compare operators compare strings</span>
<a name="l2430"><span class="linenum">2430</span></a>  <span class="comment">// as strings and numbers as numbers.</span>
<a name="l2431"><span class="linenum">2431</span></a>  <span class="comment">//</span>
<a name="l2432"><span class="linenum">2432</span></a>  <span class="comment">// NOTE: In browsers which do not follow the spec, this breaks only in</span>
<a name="l2433"><span class="linenum">2433</span></a>  <span class="comment">// the case that numbers should be sorted as strings, which is very</span>
<a name="l2434"><span class="linenum">2434</span></a>  <span class="comment">// uncommon.</span>
<a name="l2435"><span class="linenum">2435</span></a>  function <a class="function" onClick="logFunction('xpathSortByKey')" href="../../_functions/xpathsortbykey.html" onMouseOver="funcPopup(event,'xpathsortbykey')">xpathSortByKey</a>(v1, v2) {
<a name="l2436"><span class="linenum">2436</span></a>  <span class="comment">  // NOTE: Sort key vectors of different length never occur in</span>
<a name="l2437"><span class="linenum">2437</span></a>  <span class="comment">  // xsltSort.</span>
<a name="l2438"><span class="linenum">2438</span></a>  
<a name="l2439"><span class="linenum">2439</span></a>    for (var i = 0; i &lt; v1.key.length; ++i) {
<a name="l2440"><span class="linenum">2440</span></a>      var o = v1.key[i].order == 'descending' ? -1 : 1;
<a name="l2441"><span class="linenum">2441</span></a>      if (v1.key[i].value &gt; v2.key[i].value) {
<a name="l2442"><span class="linenum">2442</span></a>        return +1 * o;
<a name="l2443"><span class="linenum">2443</span></a>      } else if (v1.key[i].value &lt; v2.key[i].value) {
<a name="l2444"><span class="linenum">2444</span></a>        return -1 * o;
<a name="l2445"><span class="linenum">2445</span></a>      }
<a name="l2446"><span class="linenum">2446</span></a>    }
<a name="l2447"><span class="linenum">2447</span></a>  
<a name="l2448"><span class="linenum">2448</span></a>    return 0;
<a name="l2449"><span class="linenum">2449</span></a>  }
<a name="l2450"><span class="linenum">2450</span></a>  
<a name="l2451"><span class="linenum">2451</span></a>  
<a name="l2452"><span class="linenum">2452</span></a>  <span class="comment">// Parses and then evaluates the given XPath expression in the given</span>
<a name="l2453"><span class="linenum">2453</span></a>  <span class="comment">// input context. Notice that parsed xpath expressions are cached.</span>
<a name="l2454"><span class="linenum">2454</span></a>  function <a class="function" onClick="logFunction('xpathEval')" href="../../_functions/xpatheval.html" onMouseOver="funcPopup(event,'xpatheval')">xpathEval</a>(select, context) {
<a name="l2455"><span class="linenum">2455</span></a>    var expr = <a class="function" onClick="logFunction('xpathParse')" href="../../_functions/xpathparse.html" onMouseOver="funcPopup(event,'xpathparse')">xpathParse</a>(select);
<a name="l2456"><span class="linenum">2456</span></a>    var ret = expr.evaluate(context);
<a name="l2457"><span class="linenum">2457</span></a>    return ret;
<a name="l2458"><span class="linenum">2458</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'makeunaryminusexpr': ['makeunaryminusexpr', '', [['DTS/DTSassets','xpath.js',1856]], 0],
'push_': ['push_', '', [['DTS/DTSassets','xpath.js',2317]], 3],
'numberexpr': ['numberexpr', '', [['DTS/DTSassets','xpath.js',1661]], 2],
'makevariablereference': ['makevariablereference', '', [['DTS/DTSassets','xpath.js',1874]], 0],
'makeprimaryexpr': ['makeprimaryexpr', '', [['DTS/DTSassets','xpath.js',1814]], 0],
'nodetestany': ['nodetestany', '', [['DTS/DTSassets','xpath.js',1014]], 0],
'xpathparse': ['xpathparse', '', [['DTS/DTSassets','xpath.js',332]], 3],
'xsltlog': ['xsltlog', '', [['DTS/DTSassets','xpath.js',184]], 0],
'makepredicateexpr': ['makepredicateexpr', '', [['DTS/DTSassets','xpath.js',1810]], 0],
'tokenexpr': ['tokenexpr', '', [['DTS/DTSassets','xpath.js',853]], 1],
'makeliteralexpr': ['makeliteralexpr', '', [['DTS/DTSassets','xpath.js',1864]], 0],
'makeargumentexpr': ['makeargumentexpr', '', [['DTS/DTSassets','xpath.js',1831]], 0],
'makepathexpr1': ['makepathexpr1', '', [['DTS/DTSassets','xpath.js',1839]], 0],
'filterexpr': ['filterexpr', '', [['DTS/DTSassets','xpath.js',1458]], 1],
'makestepexpr1': ['makestepexpr1', '', [['DTS/DTSassets','xpath.js',1735]], 0],
'getattribute': ['getattribute', '', [['DTS/openflashcharts/actionscript','Css.as',56]], 333],
'exprcontext': ['exprcontext', '', [['DTS/DTSassets','xpath.js',663]], 3],
'makepathexpr2': ['makepathexpr2', '', [['DTS/DTSassets','xpath.js',1843]], 0],
'makefilterexpr': ['makefilterexpr', '', [['DTS/DTSassets','xpath.js',1848]], 0],
'xpathgrammarprecedence': ['xpathgrammarprecedence', '', [['DTS/DTSassets','xpath.js',592]], 2],
'mapexec': ['mapexec', '', [['DTS/DTSassets','xpath.js',218]], 1],
'nodetesttext': ['nodetesttext', '', [['DTS/DTSassets','xpath.js',1030]], 0],
'xpathsortbykey': ['xpathsortbykey', '', [['DTS/DTSassets','xpath.js',2435]], 0],
'nodetestcomment': ['nodetestcomment', '', [['DTS/DTSassets','xpath.js',1036]], 0],
'removefromarray': ['removefromarray', '', [['DTS/DTSassets','xpath.js',246]], 0],
'stringvalue': ['stringvalue', '', [['DTS/DTSassets','xpath.js',748]], 8],
'xpathlog': ['xpathlog', '', [['DTS/DTSassets','xpath.js',183]], 14],
'makenodetestexpr2': ['makenodetestexpr2', '', [['DTS/DTSassets','xpath.js',1777]], 0],
'makefunctioncallexpr2': ['makefunctioncallexpr2', '', [['DTS/DTSassets','xpath.js',1822]], 0],
'makenodetestexpr1': ['makenodetestexpr1', '', [['DTS/DTSassets','xpath.js',1773]], 0],
'xmlvalue': ['xmlvalue', '', [['DTS/DTSassets','xpath.js',267]], 7],
'makenodetestexpr5': ['makenodetestexpr5', '', [['DTS/DTSassets','xpath.js',1802]], 0],
'binaryexpr': ['binaryexpr', '', [['DTS/DTSassets','xpath.js',1487]], 1],
'xpathsort': ['xpathsort', '', [['DTS/DTSassets','xpath.js',2384]], 0],
'nodetestelementorattribute': ['nodetestelementorattribute', '', [['DTS/DTSassets','xpath.js',1022]], 0],
'booleanvalue': ['booleanvalue', '', [['DTS/DTSassets','xpath.js',769]], 24],
'makebinaryexpr': ['makebinaryexpr', '', [['DTS/DTSassets','xpath.js',1860]], 0],
'copyarray': ['copyarray', '', [['DTS/DTSassets','xpath.js',258]], 2],
'mapexpr': ['mapexpr', '', [['DTS/DTSassets','xpath.js',226]], 2],
'xpathdomeval': ['xpathdomeval', '', [['DTS/DTSassets','xpath.js',2376]], 0],
'nodetestnc': ['nodetestnc', '', [['DTS/DTSassets','xpath.js',1052]], 1],
'xpathparseinit': ['xpathparseinit', '', [['DTS/DTSassets','xpath.js',2276]], 1],
'xpatheval': ['xpatheval', '', [['DTS/DTSassets','xpath.js',2454]], 0],
'assert': ['assert', '', [['DTS/DTSassets','xpath.js',188]], 0],
'xpathstep': ['xpathstep', '', [['DTS/DTSassets','xpath.js',892]], 2],
'makelocationexpr7': ['makelocationexpr7', '', [['DTS/DTSassets','xpath.js',1730]], 0],
'xpathmatchstack': ['xpathmatchstack', '', [['DTS/DTSassets','xpath.js',516]], 1],
'xpathcollectdescendants': ['xpathcollectdescendants', '', [['DTS/DTSassets','xpath.js',2359]], 3],
'makelocationexpr3': ['makelocationexpr3', '', [['DTS/DTSassets','xpath.js',1705]], 0],
'numbervalue': ['numbervalue', '', [['DTS/DTSassets','xpath.js',790]], 24],
'clone': ['clone', 'Clones this property info and returns the new PropertyInfoObj ', [['DTS/openflashcharts/actionscript/caurina/transitions','PropertyInfoObj.as',39],['DTS/openflashcharts/actionscript/caurina/transitions','TweenListObj.as',76]], 51],
'makelocationexpr6': ['makelocationexpr6', '', [['DTS/DTSassets','xpath.js',1725]], 0],
'makeabbrevstep': ['makeabbrevstep', '', [['DTS/DTSassets','xpath.js',1760]], 7],
'stacktostring': ['stacktostring', '', [['DTS/DTSassets','xpath.js',618]], 3],
'literalexpr': ['literalexpr', '', [['DTS/DTSassets','xpath.js',1653]], 1],
'variableexpr': ['variableexpr', '', [['DTS/DTSassets','xpath.js',1669]], 2],
'stepexpr': ['stepexpr', '', [['DTS/DTSassets','xpath.js',906]], 9],
'xpathtokenprecedence': ['xpathtokenprecedence', '', [['DTS/DTSassets','xpath.js',588]], 2],
'nodetestname': ['nodetestname', '', [['DTS/DTSassets','xpath.js',1062]], 4],
'passexpr': ['passexpr', '', [['DTS/DTSassets','xpath.js',1690]], 0],
'maketokenexpr': ['maketokenexpr', '', [['DTS/DTSassets','xpath.js',1686]], 1],
'functioncallexpr': ['functioncallexpr', '', [['DTS/DTSassets','xpath.js',1087]], 2],
'makenodetestexpr3': ['makenodetestexpr3', '', [['DTS/DTSassets','xpath.js',1781]], 0],
'xpathreduce': ['xpathreduce', '', [['DTS/DTSassets','xpath.js',461]], 1],
'nodetestpi': ['nodetestpi', '', [['DTS/DTSassets','xpath.js',1042]], 2],
'makesimpleexpr': ['makesimpleexpr', '', [['DTS/DTSassets','xpath.js',1880]], 1],
'pathexpr': ['pathexpr', '', [['DTS/DTSassets','xpath.js',1441]], 2],
'unionexpr': ['unionexpr', '', [['DTS/DTSassets','xpath.js',1416]], 1],
'unaryminusexpr': ['unaryminusexpr', '', [['DTS/DTSassets','xpath.js',1479]], 1],
'makelocationexpr2': ['makelocationexpr2', '', [['DTS/DTSassets','xpath.js',1699]], 0],
'stringsplit': ['stringsplit', '', [['DTS/DTSassets','xpath.js',197]], 1],
'makeunionexpr': ['makeunionexpr', '', [['DTS/DTSassets','xpath.js',1835]], 0],
'locationexpr': ['locationexpr', '', [['DTS/DTSassets','xpath.js',861]], 6],
'makenodetestexpr4': ['makenodetestexpr4', '', [['DTS/DTSassets','xpath.js',1785]], 0],
'makesimpleexpr2': ['makesimpleexpr2', '', [['DTS/DTSassets','xpath.js',1900]], 1],
'reverseinplace': ['reverseinplace', '', [['DTS/DTSassets','xpath.js',235]], 2],
'xpathcollectdescendantsreverse': ['xpathcollectdescendantsreverse', '', [['DTS/DTSassets','xpath.js',2366]], 1],
'xsltlogxml': ['xsltlogxml', '', [['DTS/DTSassets','xpath.js',185]], 0],
'makestepexpr2': ['makestepexpr2', '', [['DTS/DTSassets','xpath.js',1739]], 0],
'makestepexpr4': ['makestepexpr4', '', [['DTS/DTSassets','xpath.js',1747]], 0],
'predicateexpr': ['predicateexpr', '', [['DTS/DTSassets','xpath.js',1071]], 1],
'makelocationexpr5': ['makelocationexpr5', '', [['DTS/DTSassets','xpath.js',1719]], 0],
'makenumberexpr': ['makenumberexpr', '', [['DTS/DTSassets','xpath.js',1870]], 0],
'makestepexpr5': ['makestepexpr5', '', [['DTS/DTSassets','xpath.js',1751]], 0],
'makestepexpr6': ['makestepexpr6', '', [['DTS/DTSassets','xpath.js',1755]], 0],
'makefunctioncallexpr1': ['makefunctioncallexpr1', '', [['DTS/DTSassets','xpath.js',1818]], 0],
'xpathcachelookup': ['xpathcachelookup', '', [['DTS/DTSassets','xpath.js',457]], 1],
'cmp': ['cmp', '', [['DTS/includes/fullcalendar','fullcalendar.js',1815]], 9],
'nodesetvalue': ['nodesetvalue', '', [['DTS/DTSassets','xpath.js',811]], 18],
'makelocationexpr4': ['makelocationexpr4', '', [['DTS/DTSassets','xpath.js',1712]], 0],
'makelocationexpr1': ['makelocationexpr1', '', [['DTS/DTSassets','xpath.js',1694]], 0],
'makestepexpr3': ['makestepexpr3', '', [['DTS/DTSassets','xpath.js',1743]], 0],
'assert': ['assert', '', [], 0],
'floor': ['floor', '', [], 83],
'max': ['max', '', [], 231],
'substr': ['substr', '', [], 478],
'split': ['split', '', [], 301],
'exec': ['exec', '', [], 128],
'name': ['name', '', [], 18],
'ceil': ['ceil', '', [], 200],
'round': ['round', '', [], 364],
'sort': ['sort', '', [], 50]};
CLASS_DATA={
};
CONST_DATA={
};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Mon May  5 14:14:03 2014</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
